<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alert Management - AIRIS-MON 통합 알림 관리</title>
    <script src="/components/common-layout.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left h1 {
            color: #333;
            font-size: 32px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 15px;
            font-weight: 700;
        }

        .header-left h1 .icon {
            font-size: 36px;
        }

        .subtitle {
            color: #666;
            font-size: 16px;
            font-weight: 500;
        }

        .header-right {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .status-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
        }

        .status-active {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        /* Alert Overview Cards */
        .alert-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 35px;
        }

        .overview-card {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .overview-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--accent-color);
        }

        .overview-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .overview-card.critical {
            --accent-color: #ef4444;
        }

        .overview-card.warning {
            --accent-color: #f59e0b;
        }

        .overview-card.info {
            --accent-color: #3b82f6;
        }

        .overview-card.success {
            --accent-color: #10b981;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-icon {
            font-size: 28px;
        }

        .card-value {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--accent-color);
        }

        .card-label {
            color: #666;
            font-size: 14px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .card-trend {
            font-size: 12px;
            color: #10b981;
            display: flex;
            align-items: center;
            gap: 4px;
            margin-top: 8px;
        }

        /* Main Content Grid */
        .main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .content-section {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f5f9;
        }

        .section-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* Alert List */
        .alert-item {
            display: flex;
            align-items: center;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
            background: #f8fafc;
        }

        .alert-item:hover {
            background: #f1f5f9;
            transform: translateX(5px);
        }

        .alert-item.critical {
            border-left-color: #ef4444;
            background: #fef2f2;
        }

        .alert-item.warning {
            border-left-color: #f59e0b;
            background: #fefbeb;
        }

        .alert-item.info {
            border-left-color: #3b82f6;
            background: #eff6ff;
        }

        .alert-item.resolved {
            border-left-color: #10b981;
            background: #f0fdf4;
            opacity: 0.7;
        }

        .alert-icon {
            font-size: 24px;
            margin-right: 15px;
            width: 40px;
            text-align: center;
        }

        .alert-content {
            flex: 1;
        }

        .alert-title {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 5px;
            color: #333;
        }

        .alert-description {
            color: #666;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .alert-meta {
            display: flex;
            gap: 20px;
            font-size: 12px;
            color: #888;
        }

        .alert-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .btn-resolve {
            background: #10b981;
            color: white;
        }

        .btn-escalate {
            background: #f59e0b;
            color: white;
        }

        .btn-ignore {
            background: #6b7280;
            color: white;
        }

        .btn-send {
            background: #3b82f6;
            color: white;
        }

        /* Quick Actions Panel */
        .quick-actions {
            display: grid;
            gap: 15px;
        }

        .action-card {
            background: #f8fafc;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .action-card:hover {
            background: #f1f5f9;
            border-color: #3b82f6;
            transform: translateY(-2px);
        }

        .action-icon {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .action-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
        }

        .action-description {
            font-size: 12px;
            color: #666;
        }

        /* Filter and Search */
        .filter-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            align-items: center;
            flex-wrap: wrap;
        }

        .search-input {
            flex: 1;
            min-width: 200px;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .filter-select {
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 14px;
            background: white;
            cursor: pointer;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 35px;
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.3);
            animation: slideInUp 0.3s ease;
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f1f5f9;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 600;
            color: #333;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 32px;
            cursor: pointer;
            color: #666;
            padding: 5px;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: #f3f4f6;
            color: #333;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
            font-size: 14px;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e5e7eb;
        }

        .btn-cancel {
            background: #f3f4f6;
            color: #4b5563;
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-cancel:hover {
            background: #e5e7eb;
        }

        .btn-save {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-save:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
        }

        .toggle-switch {
            position: relative;
            width: 55px;
            height: 28px;
            background: #e5e7eb;
            border-radius: 28px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-switch.active {
            background: #3b82f6;
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .toggle-switch.active::after {
            left: 29px;
        }

        .config-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .config-item:hover {
            background: #f9fafb;
            border-color: #3b82f6;
        }

        .floating-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            border: none;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .floating-button:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 35px rgba(59, 130, 246, 0.4);
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .alert-overview {
                grid-template-columns: 1fr;
            }

            .filter-bar {
                flex-direction: column;
            }

            .search-input {
                min-width: 100%;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .modal-content {
                width: 95%;
                padding: 25px;
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideInUp {
            from { 
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }
            to { 
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .notification-settings {
            display: grid;
            gap: 20px;
            margin-top: 20px;
        }

        .provider-card {
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .provider-card.active {
            border-color: #3b82f6;
            background: #eff6ff;
        }

        .provider-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .provider-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="airis-content-wrapper">
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <h1>
                    <span class="icon">🚨</span>
                    Alert Management
                </h1>
                <p class="subtitle">통합 알림 관리 및 대응 시스템</p>
            </div>
            <div class="header-right">
                <div class="status-badge status-active">
                    <span>●</span> 실시간 모니터링 활성
                </div>
                <button class="btn btn-primary" onclick="openNotificationSettings()">
                    ⚙️ 알림 설정
                </button>
                <button class="btn btn-success" onclick="refreshAlerts()">
                    🔄 새로고침
                </button>
            </div>
        </div>

        <!-- Alert Overview -->
        <div class="alert-overview">
            <div class="overview-card critical">
                <div class="card-header">
                    <div class="card-icon">🔥</div>
                </div>
                <div class="card-value" id="criticalCount">3</div>
                <div class="card-label">위험 알림</div>
                <div class="card-trend">
                    <span>📈</span> +2 지난 시간
                </div>
            </div>

            <div class="overview-card warning">
                <div class="card-header">
                    <div class="card-icon">⚠️</div>
                </div>
                <div class="card-value" id="warningCount">8</div>
                <div class="card-label">경고 알림</div>
                <div class="card-trend">
                    <span>📊</span> +5 지난 시간
                </div>
            </div>

            <div class="overview-card info">
                <div class="card-header">
                    <div class="card-icon">ℹ️</div>
                </div>
                <div class="card-value" id="infoCount">12</div>
                <div class="card-label">정보 알림</div>
                <div class="card-trend">
                    <span>📉</span> -3 지난 시간
                </div>
            </div>

            <div class="overview-card success">
                <div class="card-header">
                    <div class="card-icon">✅</div>
                </div>
                <div class="card-value" id="resolvedCount">47</div>
                <div class="card-label">해결된 알림</div>
                <div class="card-trend">
                    <span>🎯</span> 오늘 총 해결
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Alert List -->
            <div class="content-section">
                <div class="section-header">
                    <h3 class="section-title">
                        <span>📋</span>
                        실시간 알림 목록
                    </h3>
                    <div>
                        <button class="btn btn-warning btn-small" onclick="bulkAction('escalate')">
                            📢 일괄 에스컬레이션
                        </button>
                        <button class="btn btn-success btn-small" onclick="bulkAction('resolve')">
                            ✅ 일괄 해결
                        </button>
                    </div>
                </div>

                <!-- Filter Bar -->
                <div class="filter-bar">
                    <input type="text" class="search-input" placeholder="알림 검색..." id="alertSearch" onkeyup="filterAlerts()">
                    <select class="filter-select" id="severityFilter" onchange="filterAlerts()">
                        <option value="">모든 심각도</option>
                        <option value="critical">위험</option>
                        <option value="warning">경고</option>
                        <option value="info">정보</option>
                    </select>
                    <select class="filter-select" id="statusFilter" onchange="filterAlerts()">
                        <option value="">모든 상태</option>
                        <option value="active">활성</option>
                        <option value="resolved">해결됨</option>
                        <option value="ignored">무시됨</option>
                    </select>
                </div>

                <!-- Alert Items -->
                <div id="alertList">
                    <!-- Alerts will be populated here -->
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="content-section">
                <div class="section-header">
                    <h3 class="section-title">
                        <span>⚡</span>
                        빠른 작업
                    </h3>
                </div>

                <div class="quick-actions">
                    <div class="action-card" onclick="openCreateAlert()">
                        <div class="action-icon">➕</div>
                        <div class="action-title">수동 알림 생성</div>
                        <div class="action-description">사용자 정의 알림을 생성합니다</div>
                    </div>

                    <div class="action-card" onclick="openNotificationSettings()">
                        <div class="action-icon">📧</div>
                        <div class="action-title">메일/SMS 설정</div>
                        <div class="action-description">알림 전송 방법을 설정합니다</div>
                    </div>

                    <div class="action-card" onclick="openEscalationRules()">
                        <div class="action-icon">📈</div>
                        <div class="action-title">에스컬레이션 규칙</div>
                        <div class="action-description">알림 에스컬레이션 규칙을 관리합니다</div>
                    </div>

                    <div class="action-card" onclick="openAlertTemplates()">
                        <div class="action-icon">📝</div>
                        <div class="action-title">알림 템플릿</div>
                        <div class="action-description">알림 메시지 템플릿을 관리합니다</div>
                    </div>

                    <div class="action-card" onclick="viewAlertHistory()">
                        <div class="action-icon">📊</div>
                        <div class="action-title">알림 히스토리</div>
                        <div class="action-description">과거 알림 기록을 조회합니다</div>
                    </div>

                    <div class="action-card" onclick="openMaintenanceMode()">
                        <div class="action-icon">🔧</div>
                        <div class="action-title">점검 모드</div>
                        <div class="action-description">시스템 점검 중 알림을 일시 중단</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Action Button -->
    <button class="floating-button" onclick="openQuickResponse()" title="빠른 대응">
        ⚡
    </button>

    <!-- Modals -->
    <!-- Create Alert Modal -->
    <div id="createAlertModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <span>➕</span>
                    수동 알림 생성
                </h3>
                <button class="close-btn" onclick="closeModal('createAlertModal')">&times;</button>
            </div>
            
            <form id="createAlertForm">
                <div class="form-group">
                    <label class="form-label">알림 제목</label>
                    <input type="text" class="form-input" id="alertTitle" placeholder="알림 제목을 입력하세요" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">알림 내용</label>
                    <textarea class="form-textarea" id="alertDescription" placeholder="상세한 알림 내용을 입력하세요" required></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">심각도</label>
                        <select class="form-select" id="alertSeverity" required>
                            <option value="info">정보</option>
                            <option value="warning">경고</option>
                            <option value="critical">위험</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">소스</label>
                        <select class="form-select" id="alertSource" required>
                            <option value="manual">수동</option>
                            <option value="database">데이터베이스</option>
                            <option value="application">애플리케이션</option>
                            <option value="infrastructure">인프라</option>
                            <option value="network">네트워크</option>
                            <option value="security">보안</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">담당자</label>
                        <select class="form-select" id="alertAssignee">
                            <option value="">미할당</option>
                            <option value="admin">관리자</option>
                            <option value="devops">DevOps</option>
                            <option value="developer">개발자</option>
                            <option value="security">보안팀</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">영향받는 시스템</label>
                        <input type="text" class="form-input" id="alertAffected" placeholder="예: database, api (쉼표로 구분)">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">즉시 알림 전송</label>
                    <div style="display: flex; gap: 10px; align-items: center; margin-top: 8px;">
                        <label><input type="checkbox" id="notifyEmail"> 이메일</label>
                        <label><input type="checkbox" id="notifySMS"> SMS</label>
                        <label><input type="checkbox" id="notifySlack"> Slack</label>
                        <label><input type="checkbox" id="notifyTeams"> Teams</label>
                    </div>
                </div>
            </form>
            
            <div class="modal-actions">
                <button class="btn-cancel" onclick="closeModal('createAlertModal')">취소</button>
                <button class="btn-save" onclick="createNewAlert()">알림 생성</button>
            </div>
        </div>
    </div>

    <!-- Alert History Modal -->
    <div id="alertHistoryModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h3 class="modal-title">
                    <span>📊</span>
                    알림 히스토리
                </h3>
                <button class="close-btn" onclick="closeModal('alertHistoryModal')">&times;</button>
            </div>
            
            <div class="filter-bar" style="margin-bottom: 20px;">
                <input type="date" class="form-input" id="historyStartDate" style="flex: none; width: 160px;">
                <input type="date" class="form-input" id="historyEndDate" style="flex: none; width: 160px;">
                <select class="filter-select" id="historySeverityFilter">
                    <option value="">모든 심각도</option>
                    <option value="critical">위험</option>
                    <option value="warning">경고</option>
                    <option value="info">정보</option>
                </select>
                <button class="btn btn-primary btn-small" onclick="loadAlertHistory()">🔍 조회</button>
            </div>
            
            <div id="alertHistoryList" style="max-height: 400px; overflow-y: auto;">
                <!-- History will be populated here -->
            </div>
            
            <div class="modal-actions">
                <button class="btn-cancel" onclick="closeModal('alertHistoryModal')">닫기</button>
                <button class="btn btn-primary" onclick="exportAlertHistory()">📥 내보내기</button>
            </div>
        </div>
    </div>

    <!-- Escalation Rules Modal -->
    <div id="escalationRulesModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3 class="modal-title">
                    <span>📈</span>
                    에스컬레이션 규칙 관리
                </h3>
                <button class="close-btn" onclick="closeModal('escalationRulesModal')">&times;</button>
            </div>
            
            <div id="escalationRulesList">
                <!-- Rules will be populated here -->
            </div>
            
            <div class="modal-actions">
                <button class="btn-cancel" onclick="closeModal('escalationRulesModal')">닫기</button>
                <button class="btn btn-primary" onclick="addEscalationRule()">➕ 새 규칙 추가</button>
            </div>
        </div>
    </div>

    <!-- Add Escalation Rule Modal -->
    <div id="addEscalationRuleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <span>➕</span>
                    에스컬레이션 규칙 추가
                </h3>
                <button class="close-btn" onclick="closeModal('addEscalationRuleModal')">&times;</button>
            </div>
            
            <form id="escalationRuleForm">
                <div class="form-group">
                    <label class="form-label">규칙 이름</label>
                    <input type="text" class="form-input" id="ruleName" placeholder="예: 위험 알림 즉시 에스컬레이션" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">대상 심각도</label>
                        <select class="form-select" id="ruleSeverity" required>
                            <option value="critical">위험</option>
                            <option value="warning">경고</option>
                            <option value="info">정보</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">에스컬레이션 지연 시간</label>
                        <select class="form-select" id="ruleDelay" required>
                            <option value="0">즉시</option>
                            <option value="300">5분</option>
                            <option value="900">15분</option>
                            <option value="1800">30분</option>
                            <option value="3600">1시간</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">알림 채널</label>
                    <div style="display: flex; gap: 15px; margin-top: 8px;">
                        <label><input type="checkbox" id="ruleEmail"> 이메일</label>
                        <label><input type="checkbox" id="ruleSMS"> SMS</label>
                        <label><input type="checkbox" id="ruleSlack"> Slack</label>
                        <label><input type="checkbox" id="ruleTeams"> Teams</label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">수신자 목록</label>
                    <textarea class="form-textarea" id="ruleRecipients" placeholder="이메일 주소나 전화번호를 줄별로 입력하세요"></textarea>
                </div>
            </form>
            
            <div class="modal-actions">
                <button class="btn-cancel" onclick="closeModal('addEscalationRuleModal')">취소</button>
                <button class="btn-save" onclick="saveEscalationRule()">규칙 저장</button>
            </div>
        </div>
    </div>

    <!-- Alert Templates Modal -->
    <div id="alertTemplatesModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3 class="modal-title">
                    <span>📝</span>
                    알림 템플릿 관리
                </h3>
                <button class="close-btn" onclick="closeModal('alertTemplatesModal')">&times;</button>
            </div>
            
            <div id="alertTemplatesList">
                <!-- Templates will be populated here -->
            </div>
            
            <div class="modal-actions">
                <button class="btn-cancel" onclick="closeModal('alertTemplatesModal')">닫기</button>
                <button class="btn btn-primary" onclick="addAlertTemplate()">➕ 새 템플릿 추가</button>
            </div>
        </div>
    </div>

    <!-- Add Template Modal -->
    <div id="addTemplateModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <span>➕</span>
                    알림 템플릿 추가
                </h3>
                <button class="close-btn" onclick="closeModal('addTemplateModal')">&times;</button>
            </div>
            
            <form id="templateForm">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">템플릿 이름</label>
                        <input type="text" class="form-input" id="templateName" placeholder="예: 위험 알림 템플릿" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">템플릿 타입</label>
                        <select class="form-select" id="templateType" required>
                            <option value="critical">위험</option>
                            <option value="warning">경고</option>
                            <option value="info">정보</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">제목 템플릿</label>
                    <input type="text" class="form-input" id="templateSubject" placeholder="[{{severity}}] {{title}}" required>
                    <small style="color: #666; font-size: 12px;">사용 가능한 변수: {{title}}, {{severity}}, {{source}}, {{timestamp}}</small>
                </div>
                
                <div class="form-group">
                    <label class="form-label">본문 템플릿</label>
                    <textarea class="form-textarea" id="templateBody" placeholder="알림이 발생했습니다.\n\n제목: {{title}}\n내용: {{description}}\n시간: {{timestamp}}" required></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">사용 채널</label>
                    <div style="display: flex; gap: 15px; margin-top: 8px;">
                        <label><input type="checkbox" id="templateEmail" checked> 이메일</label>
                        <label><input type="checkbox" id="templateSMS"> SMS</label>
                        <label><input type="checkbox" id="templateSlack"> Slack</label>
                        <label><input type="checkbox" id="templateTeams"> Teams</label>
                    </div>
                </div>
            </form>
            
            <div class="modal-actions">
                <button class="btn-cancel" onclick="closeModal('addTemplateModal')">취소</button>
                <button class="btn-save" onclick="saveAlertTemplate()">템플릿 저장</button>
            </div>
        </div>
    </div>

    <!-- Maintenance Mode Modal -->
    <div id="maintenanceModeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <span>🔧</span>
                    점검 모드 설정
                </h3>
                <button class="close-btn" onclick="closeModal('maintenanceModeModal')">&times;</button>
            </div>
            
            <div style="padding: 20px; background: #fef3c7; border-radius: 8px; margin-bottom: 20px;">
                <p style="color: #92400e; font-weight: 600;">⚠️ 점검 모드 활성화 시 모든 알림이 일시 중단됩니다.</p>
            </div>
            
            <form id="maintenanceForm">
                <div class="form-group">
                    <label class="form-label">점검 기간</label>
                    <div class="form-row">
                        <input type="datetime-local" class="form-input" id="maintenanceStart" required>
                        <input type="datetime-local" class="form-input" id="maintenanceEnd" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">점검 사유</label>
                    <textarea class="form-textarea" id="maintenanceReason" placeholder="예: 시스템 업그레이드 및 보안 패치 적용" required></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">영향받는 시스템</label>
                    <div style="display: flex; gap: 15px; margin-top: 8px; flex-wrap: wrap;">
                        <label><input type="checkbox" id="maintainDatabase"> 데이터베이스</label>
                        <label><input type="checkbox" id="maintainApplication"> 애플리케이션</label>
                        <label><input type="checkbox" id="maintainInfrastructure"> 인프라</label>
                        <label><input type="checkbox" id="maintainNetwork"> 네트워크</label>
                        <label><input type="checkbox" id="maintainSecurity"> 보안</label>
                    </div>
                </div>
                
                <div class="config-item">
                    <div>
                        <div style="font-weight: 500;">긴급 알림 허용</div>
                        <div style="font-size: 12px; color: #666;">위험 수준의 알림은 점검 중에도 전송</div>
                    </div>
                    <div class="toggle-switch active" id="allowCriticalToggle" onclick="toggleMaintenanceOption(this)"></div>
                </div>
            </form>
            
            <div class="modal-actions">
                <button class="btn-cancel" onclick="closeModal('maintenanceModeModal')">취소</button>
                <button class="btn btn-warning" onclick="activateMaintenanceMode()">🔧 점검 모드 활성화</button>
            </div>
        </div>
    </div>

    <!-- Quick Response Modal -->
    <div id="quickResponseModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <span>⚡</span>
                    빠른 대응 패널
                </h3>
                <button class="close-btn" onclick="closeModal('quickResponseModal')">&times;</button>
            </div>
            
            <div class="quick-actions" style="margin-bottom: 20px;">
                <div class="action-card" onclick="quickResolveAll()">
                    <div class="action-icon">✅</div>
                    <div class="action-title">모든 경고 해결</div>
                    <div class="action-description">모든 경고 수준 알림을 일괄 해결</div>
                </div>
                
                <div class="action-card" onclick="quickEscalateAll()">
                    <div class="action-icon">📢</div>
                    <div class="action-title">위험 알림 에스컬레이션</div>
                    <div class="action-description">모든 위험 알림을 관리자에게 전달</div>
                </div>
                
                <div class="action-card" onclick="quickNotifyTeam()">
                    <div class="action-icon">👥</div>
                    <div class="action-title">팀 긴급 알림</div>
                    <div class="action-description">전체 팀에게 상황 브리핑 전송</div>
                </div>
                
                <div class="action-card" onclick="quickSilenceAll()">
                    <div class="action-icon">🔇</div>
                    <div class="action-title">일시 알림 중단</div>
                    <div class="action-description">1시간 동안 모든 알림 중단</div>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">긴급 메시지</label>
                <textarea class="form-textarea" id="quickMessage" placeholder="팀에게 전달할 긴급 메시지를 입력하세요"></textarea>
            </div>
            
            <div class="modal-actions">
                <button class="btn-cancel" onclick="closeModal('quickResponseModal')">닫기</button>
                <button class="btn btn-danger" onclick="executeQuickResponse()">⚡ 즉시 실행</button>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Alert data structure
        const alertsData = [
            {
                id: 'alert-001',
                title: 'DB 서버 연결 실패',
                description: 'DB Master 서버(10.0.3.10)에서 연결 시간 초과 발생',
                severity: 'critical',
                status: 'active',
                timestamp: new Date(Date.now() - 300000).toISOString(),
                source: 'database',
                assignee: '',
                notificationsSent: ['email', 'sms'],
                escalationLevel: 1
            },
            {
                id: 'alert-002',
                title: 'WAS 서버 메모리 사용률 높음',
                description: 'WAS-APP-01 서버 메모리 사용률이 85%를 초과했습니다',
                severity: 'warning',
                status: 'active',
                timestamp: new Date(Date.now() - 600000).toISOString(),
                source: 'application',
                assignee: '',
                notificationsSent: ['email'],
                escalationLevel: 0
            },
            {
                id: 'alert-003',
                title: 'API 응답 시간 지연',
                description: '결제 API 평균 응답 시간이 3초를 초과했습니다',
                severity: 'warning',
                status: 'active',
                timestamp: new Date(Date.now() - 900000).toISOString(),
                source: 'api',
                assignee: 'admin',
                notificationsSent: ['email'],
                escalationLevel: 1
            },
            {
                id: 'alert-004',
                title: '네트워크 대역폭 사용률 증가',
                description: '코어 스위치 대역폭 사용률이 90%에 근접했습니다',
                severity: 'critical',
                status: 'active',
                timestamp: new Date(Date.now() - 120000).toISOString(),
                source: 'network',
                assignee: '',
                notificationsSent: ['email', 'sms', 'slack'],
                escalationLevel: 2
            },
            {
                id: 'alert-005',
                title: '디스크 공간 부족',
                description: '/var/log 디렉토리 디스크 사용률이 95%를 초과했습니다',
                severity: 'critical',
                status: 'active',
                timestamp: new Date(Date.now() - 1800000).toISOString(),
                source: 'infrastructure',
                assignee: 'devops',
                notificationsSent: ['email', 'sms'],
                escalationLevel: 1
            },
            {
                id: 'alert-006',
                title: '로그인 실패 증가',
                description: '지난 10분간 로그인 실패 횟수가 100회를 초과했습니다',
                severity: 'warning',
                status: 'active',
                timestamp: new Date(Date.now() - 420000).toISOString(),
                source: 'security',
                assignee: '',
                notificationsSent: ['email'],
                escalationLevel: 0
            }
        ];

        let filteredAlerts = [...alertsData];

        // Initialize page
        function initializeAlertManagement() {
            populateAlertList();
            updateOverviewCards();
            startRealTimeUpdates();
        }

        function populateAlertList() {
            const container = document.getElementById('alertList');
            
            if (filteredAlerts.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <div style="font-size: 48px; margin-bottom: 20px;">📭</div>
                        <div style="font-size: 18px; font-weight: 600; margin-bottom: 10px;">조건에 맞는 알림이 없습니다</div>
                        <div style="font-size: 14px;">필터를 조정하거나 새로고침을 시도해보세요</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = filteredAlerts.map(alert => `
                <div class="alert-item ${alert.severity} ${alert.status}" data-alert-id="${alert.id}">
                    <div class="alert-icon">${getSeverityIcon(alert.severity)}</div>
                    <div class="alert-content">
                        <div class="alert-title">${alert.title}</div>
                        <div class="alert-description">${alert.description}</div>
                        <div class="alert-meta">
                            <span>⏰ ${formatTime(alert.timestamp)}</span>
                            <span>📍 ${alert.source}</span>
                            <span>👤 ${alert.assignee || '미할당'}</span>
                            <span>📢 ${alert.escalationLevel}단계</span>
                            <span>📧 ${alert.notificationsSent.join(', ')}</span>
                        </div>
                    </div>
                    <div class="alert-actions">
                        <input type="checkbox" class="alert-checkbox" value="${alert.id}" onchange="updateBulkActions()">
                        <button class="btn-small btn-resolve" onclick="resolveAlert('${alert.id}')" title="이 알림을 해결 처리합니다">해결</button>
                        <button class="btn-small btn-escalate" onclick="escalateAlert('${alert.id}')" title="상위 단계로 에스컬레이션합니다">에스컬레이션</button>
                        <button class="btn-small btn-send" onclick="sendNotification('${alert.id}')" title="수동으로 알림을 전송합니다">알림 전송</button>
                        <button class="btn-small btn-ignore" onclick="ignoreAlert('${alert.id}')" title="이 알림을 무시 처리합니다">무시</button>
                        <button class="btn-small btn-history" onclick="showAlertHistory('${alert.id}')" title="알림 히스토리를 확인합니다" style="background: #6b7280; color: white;">히스토리</button>
                    </div>
                </div>
            `).join('');
        }

        function getSeverityIcon(severity) {
            const icons = {
                'critical': '🔥',
                'warning': '⚠️',
                'info': 'ℹ️'
            };
            return icons[severity] || 'ℹ️';
        }

        function formatTime(timestamp) {
            const now = new Date();
            const alertTime = new Date(timestamp);
            const diffMinutes = Math.floor((now - alertTime) / 60000);
            
            if (diffMinutes < 1) return '방금 전';
            if (diffMinutes < 60) return `${diffMinutes}분 전`;
            if (diffMinutes < 1440) return `${Math.floor(diffMinutes / 60)}시간 전`;
            return `${Math.floor(diffMinutes / 1440)}일 전`;
        }

        function updateOverviewCards() {
            const critical = alertsData.filter(a => a.severity === 'critical' && a.status === 'active').length;
            const warning = alertsData.filter(a => a.severity === 'warning' && a.status === 'active').length;
            const info = alertsData.filter(a => a.severity === 'info' && a.status === 'active').length;
            const resolved = alertsData.filter(a => a.status === 'resolved').length;

            document.getElementById('criticalCount').textContent = critical;
            document.getElementById('warningCount').textContent = warning;
            document.getElementById('infoCount').textContent = info;
            document.getElementById('resolvedCount').textContent = resolved;
        }

        function filterAlerts() {
            const searchTerm = document.getElementById('alertSearch').value.toLowerCase();
            const severityFilter = document.getElementById('severityFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;

            filteredAlerts = alertsData.filter(alert => {
                const matchesSearch = alert.title.toLowerCase().includes(searchTerm) || 
                                    alert.description.toLowerCase().includes(searchTerm);
                const matchesSeverity = !severityFilter || alert.severity === severityFilter;
                const matchesStatus = !statusFilter || alert.status === statusFilter;

                return matchesSearch && matchesSeverity && matchesStatus;
            });

            populateAlertList();
        }

        function refreshAlerts() {
            showNotification('알림 목록을 새로고침하고 있습니다...', 'info');
            
            setTimeout(() => {
                // Simulate new alerts
                const newAlert = {
                    id: `alert-${Date.now()}`,
                    title: '새로운 시스템 알림',
                    description: '자동 생성된 테스트 알림입니다',
                    severity: 'info',
                    status: 'active',
                    timestamp: new Date().toISOString(),
                    source: 'system',
                    assignee: '',
                    notificationsSent: [],
                    escalationLevel: 0
                };
                
                alertsData.unshift(newAlert);
                filteredAlerts = [...alertsData];
                populateAlertList();
                updateOverviewCards();
                
                showNotification('알림 목록이 새로고침되었습니다', 'success');
            }, 1000);
        }

        // Alert actions
        function resolveAlert(alertId) {
            const alert = alertsData.find(a => a.id === alertId);
            if (!alert) return;
            
            showModal('알림 해결', `
                <div style="margin-bottom: 20px;">
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h4 style="margin-bottom: 10px; color: #333;">해결할 알림</h4>
                        <div style="font-weight: 600; color: #${alert.severity === 'critical' ? 'dc2626' : alert.severity === 'warning' ? 'ea580c' : '2563eb'};">
                            ${getSeverityIcon(alert.severity)} ${alert.title}
                        </div>
                        <div style="font-size: 14px; color: #666; margin-top: 5px;">${alert.description}</div>
                    </div>
                    <form id="resolveForm">
                        <div class="form-group">
                            <label class="form-label">해결 사유</label>
                            <select class="form-select" id="resolveReason" required>
                                <option value="">해결 사유를 선택하세요</option>
                                <option value="fixed">문제 수정 완료</option>
                                <option value="false-positive">오탐지 (정상 상황)</option>
                                <option value="maintenance">예정된 점검</option>
                                <option value="duplicate">중복 알림</option>
                                <option value="other">기타</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">해결 상세 내용</label>
                            <textarea class="form-textarea" id="resolveNotes" rows="4" placeholder="해결 과정이나 추가 정보를 입력하세요..." required></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">해결자</label>
                            <input type="text" class="form-input" id="resolvedBy" placeholder="이름 또는 이메일" value="현재 사용자" required>
                        </div>
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 8px; font-size: 14px;">
                                <input type="checkbox" id="notifyResolution"> 해결 알림 전송 (관련자에게 해결 사실 통지)
                            </label>
                        </div>
                    </form>
                </div>
            `, () => {
                const form = document.getElementById('resolveForm');
                if (form.checkValidity()) {
                    const resolveData = {
                        reason: document.getElementById('resolveReason').value,
                        notes: document.getElementById('resolveNotes').value,
                        resolvedBy: document.getElementById('resolvedBy').value,
                        notifyResolution: document.getElementById('notifyResolution').checked,
                        timestamp: new Date().toISOString()
                    };
                    
                    closeModal();
                    performResolveAlert(alertId, resolveData);
                } else {
                    showNotification('모든 필드를 입력해주세요', 'warning');
                }
            });
        }
        
        function performResolveAlert(alertId, resolveData) {
            showNotification('알림을 해결하고 있습니다...', 'info');
            
            // API 호출 시뮬레이션
            fetch(`/api/alerts/${alertId}/resolve`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(resolveData)
            })
            .then(response => {
                if (response.ok) {
                    const alert = alertsData.find(a => a.id === alertId);
                    if (alert) {
                        alert.status = 'resolved';
                        alert.resolvedAt = resolveData.timestamp;
                        alert.resolvedBy = resolveData.resolvedBy;
                        alert.resolution = resolveData;
                        
                        // 해결 알림 전송
                        if (resolveData.notifyResolution) {
                            setTimeout(() => {
                                showNotification('해결 알림을 관련자에게 전송했습니다', 'info');
                            }, 1000);
                        }
                        
                        populateAlertList();
                        updateOverviewCards();
                        showNotification(`"${alert.title}" 알림이 성공적으로 해결되었습니다`, 'success');
                        
                        // 해결 로그 기록
                        addAlertLog(alertId, 'resolved', `해결됨: ${resolveData.reason} - ${resolveData.notes}`, resolveData.resolvedBy);
                    }
                } else {
                    throw new Error('서버 오류');
                }
            })
            .catch(error => {
                console.error('Resolve error:', error);
                // 로컬 업데이트로 폴백
                const alert = alertsData.find(a => a.id === alertId);
                if (alert) {
                    alert.status = 'resolved';
                    alert.resolvedAt = resolveData.timestamp;
                    alert.resolvedBy = resolveData.resolvedBy;
                    alert.resolution = resolveData;
                    populateAlertList();
                    updateOverviewCards();
                    showNotification('알림이 로컬에서 해결되었습니다 (서버 연결 실패)', 'warning');
                }
            });
        }

        function escalateAlert(alertId) {
            const alert = alertsData.find(a => a.id === alertId);
            if (!alert) return;
            
            const currentLevel = alert.escalationLevel || 1;
            const maxLevel = 3;
            
            if (currentLevel >= maxLevel) {
                showNotification('이미 최대 에스컬레이션 단계입니다', 'warning');
                return;
            }
            
            showModal('알림 에스컬레이션', `
                <div style="margin-bottom: 20px;">
                    <div style="background: #fef3c7; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #f59e0b;">
                        <h4 style="margin-bottom: 10px; color: #92400e;">에스컬레이션할 알림</h4>
                        <div style="font-weight: 600; color: #${alert.severity === 'critical' ? 'dc2626' : alert.severity === 'warning' ? 'ea580c' : '2563eb'};">
                            ${getSeverityIcon(alert.severity)} ${alert.title}
                        </div>
                        <div style="font-size: 14px; color: #666; margin-top: 5px;">${alert.description}</div>
                        <div style="font-size: 14px; color: #92400e; margin-top: 10px;">
                            현재 단계: ${currentLevel}단계 → ${currentLevel + 1}단계로 에스컬레이션
                        </div>
                    </div>
                    <form id="escalateForm">
                        <div class="form-group">
                            <label class="form-label">에스캬레이션 대상</label>
                            <select class="form-select" id="escalateTarget" required>
                                <option value="">에스캬레이션 대상을 선택하세요</option>
                                <option value="team-lead">팀 리더</option>
                                <option value="manager">관리자</option>
                                <option value="senior-engineer">시니어 엔지니어</option>
                                <option value="on-call">당직자</option>
                                <option value="emergency-team">비상 대응팀</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">에스컬레이션 사유</label>
                            <select class="form-select" id="escalateReason" required>
                                <option value="">에스캬레이션 사유를 선택하세요</option>
                                <option value="no-response">초기 대응 없음</option>
                                <option value="complex-issue">복잡한 문제로 전문가 필요</option>
                                <option value="high-impact">높은 비즈니스 영향</option>
                                <option value="time-critical">시간 중요 사안</option>
                                <option value="resource-needed">추가 리소스 필요</option>
                                <option value="policy-required">정책 결정 필요</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">에스컬레이션 메시지</label>
                            <textarea class="form-textarea" id="escalateMessage" rows="4" placeholder="에스컬레이션 상황과 필요한 조치를 상세히 설명해주세요..." required></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">우선순위</label>
                            <select class="form-select" id="escalatePriority">
                                <option value="normal">일반</option>
                                <option value="high">높음</option>
                                <option value="urgent">긴급</option>
                                <option value="critical">위급</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 8px; font-size: 14px;">
                                <input type="checkbox" id="escalateImmediate" checked> 즉시 알림 전송
                            </label>
                        </div>
                    </form>
                </div>
            `, () => {
                const form = document.getElementById('escalateForm');
                if (form.checkValidity()) {
                    const escalateData = {
                        target: document.getElementById('escalateTarget').value,
                        reason: document.getElementById('escalateReason').value,
                        message: document.getElementById('escalateMessage').value,
                        priority: document.getElementById('escalatePriority').value,
                        immediate: document.getElementById('escalateImmediate').checked,
                        fromLevel: currentLevel,
                        toLevel: currentLevel + 1,
                        timestamp: new Date().toISOString(),
                        escalatedBy: '현재 사용자'
                    };
                    
                    closeModal();
                    performEscalateAlert(alertId, escalateData);
                } else {
                    showNotification('모든 필드를 입력해주세요', 'warning');
                }
            });
        }
        
        function performEscalateAlert(alertId, escalateData) {
            showNotification(`알림을 ${escalateData.toLevel}단계로 에스컬레이션하고 있습니다...`, 'info');
            
            // API 호출 시뮬레이션
            fetch(`/api/alerts/${alertId}/escalate`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(escalateData)
            })
            .then(response => {
                if (response.ok) {
                    const alert = alertsData.find(a => a.id === alertId);
                    if (alert) {
                        alert.escalationLevel = escalateData.toLevel;
                        alert.lastEscalation = escalateData;
                        
                        // 에스컍레이션 알림 전송
                        if (escalateData.immediate) {
                            setTimeout(() => {
                                showNotification(`${escalateData.target}에게 에스컍레이션 알림을 전송했습니다`, 'info');
                            }, 1000);
                        }
                        
                        populateAlertList();
                        showNotification(`"${alert.title}" 알림이 ${escalateData.toLevel}단계로 에스컍레이션되었습니다`, 'warning');
                        
                        // 에스컽레이션 로그 기록
                        addAlertLog(alertId, 'escalated', `${escalateData.fromLevel}단계에서 ${escalateData.toLevel}단계로 에스컽레이션: ${escalateData.reason}`, escalateData.escalatedBy);
                    }
                } else {
                    throw new Error('서버 오류');
                }
            })
            .catch(error => {
                console.error('Escalate error:', error);
                // 로컬 업데이트로 폴백
                const alert = alertsData.find(a => a.id === alertId);
                if (alert) {
                    alert.escalationLevel = escalateData.toLevel;
                    alert.lastEscalation = escalateData;
                    populateAlertList();
                    showNotification('에스컼레이션이 로컬에서 완료되었습니다 (서버 연결 실패)', 'warning');
                }
            });
        }

        function ignoreAlert(alertId) {
            const alert = alertsData.find(a => a.id === alertId);
            if (!alert) return;
            
            showModal('알림 무시', `
                <div style="margin-bottom: 20px;">
                    <div style="background: #fef2f2; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #ef4444;">
                        <h4 style="margin-bottom: 10px; color: #dc2626;">무시할 알림</h4>
                        <div style="font-weight: 600; color: #${alert.severity === 'critical' ? 'dc2626' : alert.severity === 'warning' ? 'ea580c' : '2563eb'};">
                            ${getSeverityIcon(alert.severity)} ${alert.title}
                        </div>
                        <div style="font-size: 14px; color: #666; margin-top: 5px;">${alert.description}</div>
                        <div style="background: #fee2e2; padding: 8px; border-radius: 6px; margin-top: 10px; font-size: 12px; color: #dc2626;">
                            ⚠️ 무시된 알림은 더 이상 알림을 발생시키지 않으며, 대시보드에서 숨겨집니다.
                        </div>
                    </div>
                    <form id="ignoreForm">
                        <div class="form-group">
                            <label class="form-label">무시 사유</label>
                            <select class="form-select" id="ignoreReason" required>
                                <option value="">무시 사유를 선택하세요</option>
                                <option value="false-positive">오탐지 (정상 상황)</option>
                                <option value="known-issue">알려진 문제 (수정 예정)</option>
                                <option value="low-priority">낮은 우선순위</option>
                                <option value="duplicate">중복 알림</option>
                                <option value="maintenance">예정된 유지보수</option>
                                <option value="temporary">일시적 상황</option>
                                <option value="not-applicable">해당 없음</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">무시 상세 내용</label>
                            <textarea class="form-textarea" id="ignoreNotes" rows="3" placeholder="무시 사유에 대한 상세 설명을 입력하세요..." required></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">무시 기간</label>
                            <select class="form-select" id="ignoreDuration">
                                <option value="permanent">영구 무시</option>
                                <option value="1hour">1시간</option>
                                <option value="4hours">4시간</option>
                                <option value="1day">1일</option>
                                <option value="1week">1주</option>
                                <option value="1month">1개월</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">무시자</label>
                            <input type="text" class="form-input" id="ignoredBy" placeholder="이름 또는 이메일" value="현재 사용자" required>
                        </div>
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 8px; font-size: 14px;">
                                <input type="checkbox" id="notifyIgnore"> 무시 알림 전송 (관련자에게 무시 사실 통지)
                            </label>
                        </div>
                    </form>
                </div>
            `, () => {
                const form = document.getElementById('ignoreForm');
                if (form.checkValidity()) {
                    const ignoreData = {
                        reason: document.getElementById('ignoreReason').value,
                        notes: document.getElementById('ignoreNotes').value,
                        duration: document.getElementById('ignoreDuration').value,
                        ignoredBy: document.getElementById('ignoredBy').value,
                        notifyIgnore: document.getElementById('notifyIgnore').checked,
                        timestamp: new Date().toISOString()
                    };
                    
                    // 무시 기간 계산
                    if (ignoreData.duration !== 'permanent') {
                        const durations = {
                            '1hour': 60 * 60 * 1000,
                            '4hours': 4 * 60 * 60 * 1000,
                            '1day': 24 * 60 * 60 * 1000,
                            '1week': 7 * 24 * 60 * 60 * 1000,
                            '1month': 30 * 24 * 60 * 60 * 1000
                        };
                        ignoreData.ignoreUntil = new Date(Date.now() + durations[ignoreData.duration]).toISOString();
                    }
                    
                    closeModal();
                    performIgnoreAlert(alertId, ignoreData);
                } else {
                    showNotification('모든 필드를 입력해주세요', 'warning');
                }
            });
        }
        
        function performIgnoreAlert(alertId, ignoreData) {
            showNotification('알림을 무시 처리하고 있습니다...', 'info');
            
            // API 호출 시뮬레이션
            fetch(`/api/alerts/${alertId}/ignore`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(ignoreData)
            })
            .then(response => {
                if (response.ok) {
                    const alert = alertsData.find(a => a.id === alertId);
                    if (alert) {
                        alert.status = 'ignored';
                        alert.ignoredAt = ignoreData.timestamp;
                        alert.ignoredBy = ignoreData.ignoredBy;
                        alert.ignoreData = ignoreData;
                        
                        // 무시 알림 전송
                        if (ignoreData.notifyIgnore) {
                            setTimeout(() => {
                                showNotification('무시 알림을 관련자에게 전송했습니다', 'info');
                            }, 1000);
                        }
                        
                        populateAlertList();
                        updateOverviewCards();
                        
                        const durationText = ignoreData.duration === 'permanent' ? '영구적으로' : `${ignoreData.duration}간`;
                        showNotification(`"${alert.title}" 알림이 ${durationText} 무시되었습니다`, 'info');
                        
                        // 무시 로그 기록
                        addAlertLog(alertId, 'ignored', `무시됨 (${ignoreData.duration}): ${ignoreData.reason} - ${ignoreData.notes}`, ignoreData.ignoredBy);
                    }
                } else {
                    throw new Error('서버 오류');
                }
            })
            .catch(error => {
                console.error('Ignore error:', error);
                // 로컬 업데이트로 폴백
                const alert = alertsData.find(a => a.id === alertId);
                if (alert) {
                    alert.status = 'ignored';
                    alert.ignoredAt = ignoreData.timestamp;
                    alert.ignoredBy = ignoreData.ignoredBy;
                    alert.ignoreData = ignoreData;
                    populateAlertList();
                    updateOverviewCards();
                    showNotification('알림이 로컬에서 무시되었습니다 (서버 연결 실패)', 'warning');
                }
            });
        }

        function sendNotification(alertId) {
            const alert = alertsData.find(a => a.id === alertId);
            if (!alert) return;
            
            showModal('알림 수동 전송', `
                <div style="margin-bottom: 20px;">
                    <div style="background: #eff6ff; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #3b82f6;">
                        <h4 style="margin-bottom: 10px; color: #1d4ed8;">전송할 알림</h4>
                        <div style="font-weight: 600; color: #${alert.severity === 'critical' ? 'dc2626' : alert.severity === 'warning' ? 'ea580c' : '2563eb'};">
                            ${getSeverityIcon(alert.severity)} ${alert.title}
                        </div>
                        <div style="font-size: 14px; color: #666; margin-top: 5px;">${alert.description}</div>
                        <div style="font-size: 12px; color: #1d4ed8; margin-top: 8px;">
                            이미 전송된 알림: ${alert.notificationsSent ? alert.notificationsSent.join(', ') : '없음'}
                        </div>
                    </div>
                    <form id="sendNotificationForm">
                        <div class="form-group">
                            <label class="form-label">전송 방법 선택</label>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 8px;">
                                <label style="display: flex; align-items: center; gap: 8px; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer;">
                                    <input type="checkbox" name="notificationMethods" value="email" checked>
                                    📧 이메일
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer;">
                                    <input type="checkbox" name="notificationMethods" value="sms">
                                    📱 SMS
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer;">
                                    <input type="checkbox" name="notificationMethods" value="slack">
                                    💬 Slack
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer;">
                                    <input type="checkbox" name="notificationMethods" value="teams">
                                    👥 Teams
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">수신자 그룹</label>
                            <select class="form-select" id="recipientGroup" required>
                                <option value="">수신자 그룹을 선택하세요</option>
                                <option value="assigned">담당자</option>
                                <option value="team">팀 전체</option>
                                <option value="managers">관리자들</option>
                                <option value="on-call">당직자</option>
                                <option value="stakeholders">이해관계자</option>
                                <option value="custom">사용자 지정</option>
                            </select>
                        </div>
                        <div class="form-group" id="customRecipientsGroup" style="display: none;">
                            <label class="form-label">사용자 지정 수신자</label>
                            <textarea class="form-textarea" id="customRecipients" rows="3" placeholder="이메일 주소나 전화번호를 줄바꿈으로 구분하여 입력"></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">메시지 템플릿</label>
                            <select class="form-select" id="messageTemplate">
                                <option value="default">기본 알림 템플릿</option>
                                <option value="urgent">긴급 알림 템플릿</option>
                                <option value="summary">요약 템플릿</option>
                                <option value="detailed">상세 템플릿</option>
                                <option value="custom">사용자 지정</option>
                            </select>
                        </div>
                        <div class="form-group" id="customMessageGroup" style="display: none;">
                            <label class="form-label">사용자 지정 메시지</label>
                            <textarea class="form-textarea" id="customMessage" rows="4" placeholder="전송할 메시지를 입력하세요..."></textarea>
                        </div>
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 8px; font-size: 14px;">
                                <input type="checkbox" id="sendImmediate" checked> 즉시 전송
                            </label>
                        </div>
                    </form>
                </div>
            `, () => {
                const form = document.getElementById('sendNotificationForm');
                const methods = Array.from(document.querySelectorAll('input[name="notificationMethods"]:checked')).map(cb => cb.value);
                const recipientGroup = document.getElementById('recipientGroup').value;
                
                if (methods.length === 0) {
                    showNotification('전송 방법을 선택해주세요', 'warning');
                    return;
                }
                
                if (!recipientGroup) {
                    showNotification('수신자 그룹을 선택해주세요', 'warning');
                    return;
                }
                
                const notificationData = {
                    methods: methods,
                    recipientGroup: recipientGroup,
                    customRecipients: document.getElementById('customRecipients')?.value || '',
                    messageTemplate: document.getElementById('messageTemplate').value,
                    customMessage: document.getElementById('customMessage')?.value || '',
                    immediate: document.getElementById('sendImmediate').checked,
                    timestamp: new Date().toISOString(),
                    sentBy: '현재 사용자'
                };
                
                closeModal();
                performSendNotification(alertId, notificationData);
            });
            
            // 동적 폼 처리
            document.getElementById('recipientGroup').addEventListener('change', function() {
                const customGroup = document.getElementById('customRecipientsGroup');
                if (this.value === 'custom') {
                    customGroup.style.display = 'block';
                } else {
                    customGroup.style.display = 'none';
                }
            });
            
            document.getElementById('messageTemplate').addEventListener('change', function() {
                const customMessageGroup = document.getElementById('customMessageGroup');
                if (this.value === 'custom') {
                    customMessageGroup.style.display = 'block';
                } else {
                    customMessageGroup.style.display = 'none';
                }
            });
        }
        
        function performSendNotification(alertId, notificationData) {
            showNotification(`${notificationData.methods.length}개 방법으로 알림을 전송하고 있습니다...`, 'info');
            
            // API 호출 시뮬레이션
            fetch(`/api/alerts/${alertId}/send-notification`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(notificationData)
            })
            .then(response => {
                if (response.ok) {
                    const alert = alertsData.find(a => a.id === alertId);
                    if (alert) {
                        // 전송된 알림 기록 추가
                        if (!alert.notificationsSent) alert.notificationsSent = [];
                        notificationData.methods.forEach(method => {
                            alert.notificationsSent.push(`manual-${method}`);
                        });
                        
                        populateAlertList();
                        showNotification(`알림이 ${notificationData.methods.join(', ')}로 성공적으로 전송되었습니다`, 'success');
                        
                        // 전송 로그 기록
                        addAlertLog(alertId, 'notification_sent', `수동 알림 전송: ${notificationData.methods.join(', ')} to ${notificationData.recipientGroup}`, notificationData.sentBy);
                    }
                } else {
                    throw new Error('서버 오류');
                }
            })
            .catch(error => {
                console.error('Send notification error:', error);
                // 로컬 업데이트로 폴백
                const alert = alertsData.find(a => a.id === alertId);
                if (alert) {
                    if (!alert.notificationsSent) alert.notificationsSent = [];
                    notificationData.methods.forEach(method => {
                        alert.notificationsSent.push(`manual-${method}`);
                    });
                    populateAlertList();
                    showNotification('알림이 로컬에서 전송되었습니다 (서버 연결 실패)', 'warning');
                }
            });
        }

        function bulkAction(action) {
            const checkedBoxes = document.querySelectorAll('.alert-checkbox:checked');
            const alertIds = Array.from(checkedBoxes).map(cb => cb.value);
            
            if (alertIds.length === 0) {
                showNotification('선택된 알림이 없습니다', 'warning');
                return;
            }

            if (action === 'resolve') {
                alertIds.forEach(id => resolveAlert(id));
                showNotification(`${alertIds.length}개 알림이 해결되었습니다`, 'success');
            } else if (action === 'escalate') {
                alertIds.forEach(id => escalateAlert(id));
                showNotification(`${alertIds.length}개 알림이 에스컬레이션되었습니다`, 'warning');
            }
            
            // Clear checkboxes
            checkedBoxes.forEach(cb => cb.checked = false);
        }

        function updateBulkActions() {
            const checkedCount = document.querySelectorAll('.alert-checkbox:checked').length;
            // Update UI to show selected count if needed
        }

        function startRealTimeUpdates() {
            setInterval(() => {
                updateOverviewCards();
                // Simulate real-time updates
                if (Math.random() > 0.95) {
                    refreshAlerts();
                }
            }, 30000); // Update every 30 seconds
        }

        // Global data for modals
        const escalationRules = [
            {
                id: 'rule-001',
                name: '위험 알림 즉시 에스컬레이션',
                severity: 'critical',
                delay: 0,
                channels: ['email', 'sms'],
                recipients: ['admin@company.com', '010-1234-5678'],
                enabled: true
            },
            {
                id: 'rule-002',
                name: '미해결 알림 재전송',
                severity: 'warning',
                delay: 1800,
                channels: ['email', 'slack'],
                recipients: ['devops-team@company.com'],
                enabled: true
            }
        ];

        const alertTemplates = [
            {
                id: 'template-001',
                name: '위험 알림 템플릿',
                type: 'critical',
                subject: '[CRITICAL] {{title}}',
                body: '긴급 알림이 발생했습니다.\n\n제목: {{title}}\n내용: {{description}}\n시간: {{timestamp}}\n\n즉시 확인이 필요합니다.',
                channels: ['email', 'sms']
            },
            {
                id: 'template-002',
                name: '경고 알림 템플릿',
                type: 'warning',
                subject: '[WARNING] {{title}}',
                body: '경고 알림입니다.\n\n제목: {{title}}\n내용: {{description}}\n시간: {{timestamp}}\n\n검토가 필요합니다.',
                channels: ['email']
            }
        ];

        // Modal functions
        function openCreateAlert() {
            document.getElementById('createAlertForm').reset();
            openModal('createAlertModal');
        }

        function createNewAlert() {
            const form = document.getElementById('createAlertForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const newAlert = {
                id: `alert-${Date.now()}`,
                title: document.getElementById('alertTitle').value,
                description: document.getElementById('alertDescription').value,
                severity: document.getElementById('alertSeverity').value,
                status: 'active',
                timestamp: new Date().toISOString(),
                source: document.getElementById('alertSource').value,
                assignee: document.getElementById('alertAssignee').value,
                notificationsSent: [],
                escalationLevel: 0,
                affected: document.getElementById('alertAffected').value.split(',').map(s => s.trim()).filter(s => s),
                autoResolve: false
            };

            // Check which notifications to send
            const notifyChannels = [];
            if (document.getElementById('notifyEmail').checked) notifyChannels.push('email');
            if (document.getElementById('notifySMS').checked) notifyChannels.push('sms');
            if (document.getElementById('notifySlack').checked) notifyChannels.push('slack');
            if (document.getElementById('notifyTeams').checked) notifyChannels.push('teams');

            newAlert.notificationsSent = notifyChannels;

            // Add to alerts data
            alertsData.unshift(newAlert);
            filteredAlerts = [...alertsData];
            populateAlertList();
            updateOverviewCards();

            closeModal('createAlertModal');
            
            if (notifyChannels.length > 0) {
                showNotification(`새 알림이 생성되고 ${notifyChannels.join(', ')} 채널로 전송되었습니다`, 'success');
            } else {
                showNotification('새 알림이 생성되었습니다', 'success');
            }
        }

        function openNotificationSettings() {
            showNotification('알림 설정 화면으로 이동합니다', 'info');
            window.location.href = '/notification-settings';
        }

        function openEscalationRules() {
            populateEscalationRules();
            openModal('escalationRulesModal');
        }

        function populateEscalationRules() {
            const container = document.getElementById('escalationRulesList');
            container.innerHTML = escalationRules.map(rule => `
                <div class="rule-item">
                    <div class="rule-header">
                        <div class="rule-title">${rule.name}</div>
                        <div class="rule-actions">
                            <div class="toggle-switch ${rule.enabled ? 'active' : ''}" onclick="toggleEscalationRule('${rule.id}')"></div>
                            <button class="btn-small btn-edit" onclick="editEscalationRule('${rule.id}')">수정</button>
                            <button class="btn-small btn-delete" onclick="deleteEscalationRule('${rule.id}')">삭제</button>
                        </div>
                    </div>
                    <div class="rule-conditions">
                        조건: 심각도가 '${getSeverityText(rule.severity)}'인 경우 → ${rule.delay === 0 ? '즉시' : `${rule.delay/60}분 후`} ${rule.channels.join(', ')} 전송
                    </div>
                    <div class="rule-targets">
                        ${rule.recipients.map(recipient => `<span class="target-badge">${getRecipientIcon(recipient)} ${recipient}</span>`).join('')}
                    </div>
                </div>
            `).join('');
        }

        function getSeverityText(severity) {
            const map = { 'critical': '위험', 'warning': '경고', 'info': '정보' };
            return map[severity] || severity;
        }

        function getRecipientIcon(recipient) {
            if (recipient.includes('@')) return '📧';
            if (recipient.startsWith('010') || recipient.startsWith('+')) return '📱';
            return '👤';
        }

        function addEscalationRule() {
            document.getElementById('escalationRuleForm').reset();
            openModal('addEscalationRuleModal');
        }

        function saveEscalationRule() {
            const form = document.getElementById('escalationRuleForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const channels = [];
            if (document.getElementById('ruleEmail').checked) channels.push('email');
            if (document.getElementById('ruleSMS').checked) channels.push('sms');
            if (document.getElementById('ruleSlack').checked) channels.push('slack');
            if (document.getElementById('ruleTeams').checked) channels.push('teams');

            const newRule = {
                id: `rule-${Date.now()}`,
                name: document.getElementById('ruleName').value,
                severity: document.getElementById('ruleSeverity').value,
                delay: parseInt(document.getElementById('ruleDelay').value),
                channels: channels,
                recipients: document.getElementById('ruleRecipients').value.split('\n').filter(r => r.trim()),
                enabled: true
            };

            escalationRules.push(newRule);
            populateEscalationRules();
            closeModal('addEscalationRuleModal');
            showNotification('에스컬레이션 규칙이 추가되었습니다', 'success');
        }

        function toggleEscalationRule(ruleId) {
            const rule = escalationRules.find(r => r.id === ruleId);
            if (rule) {
                rule.enabled = !rule.enabled;
                populateEscalationRules();
                showNotification(`에스컬레이션 규칙이 ${rule.enabled ? '활성화' : '비활성화'}되었습니다`, 'info');
            }
        }

        function editEscalationRule(ruleId) {
            showNotification(`규칙 ${ruleId} 편집 기능을 구현 중입니다`, 'info');
        }

        function deleteEscalationRule(ruleId) {
            if (confirm('이 에스컬레이션 규칙을 삭제하시겠습니까?')) {
                const index = escalationRules.findIndex(r => r.id === ruleId);
                if (index !== -1) {
                    escalationRules.splice(index, 1);
                    populateEscalationRules();
                    showNotification('에스컬레이션 규칙이 삭제되었습니다', 'success');
                }
            }
        }

        function openAlertTemplates() {
            populateAlertTemplates();
            openModal('alertTemplatesModal');
        }

        function populateAlertTemplates() {
            const container = document.getElementById('alertTemplatesList');
            container.innerHTML = alertTemplates.map(template => `
                <div class="template-item">
                    <div class="template-header">
                        <div class="template-title">${template.name}</div>
                        <div class="rule-actions">
                            <button class="btn-small btn-edit" onclick="editAlertTemplate('${template.id}')">수정</button>
                            <button class="btn-small btn-delete" onclick="deleteAlertTemplate('${template.id}')">삭제</button>
                        </div>
                    </div>
                    <div style="margin-bottom: 10px;">
                        <strong>제목:</strong> ${template.subject}<br>
                        <strong>채널:</strong> ${template.channels.map(c => getChannelIcon(c) + ' ' + c).join(', ')}
                    </div>
                    <div class="template-preview">
${template.body}
                    </div>
                </div>
            `).join('');
        }

        function getChannelIcon(channel) {
            const icons = { 'email': '📧', 'sms': '📱', 'slack': '💬', 'teams': '👥' };
            return icons[channel] || '📢';
        }

        function addAlertTemplate() {
            document.getElementById('templateForm').reset();
            document.getElementById('templateEmail').checked = true;
            openModal('addTemplateModal');
        }

        function saveAlertTemplate() {
            const form = document.getElementById('templateForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const channels = [];
            if (document.getElementById('templateEmail').checked) channels.push('email');
            if (document.getElementById('templateSMS').checked) channels.push('sms');
            if (document.getElementById('templateSlack').checked) channels.push('slack');
            if (document.getElementById('templateTeams').checked) channels.push('teams');

            const newTemplate = {
                id: `template-${Date.now()}`,
                name: document.getElementById('templateName').value,
                type: document.getElementById('templateType').value,
                subject: document.getElementById('templateSubject').value,
                body: document.getElementById('templateBody').value,
                channels: channels
            };

            alertTemplates.push(newTemplate);
            populateAlertTemplates();
            closeModal('addTemplateModal');
            showNotification('알림 템플릿이 추가되었습니다', 'success');
        }

        function editAlertTemplate(templateId) {
            showNotification(`템플릿 ${templateId} 편집 기능을 구현 중입니다`, 'info');
        }

        function deleteAlertTemplate(templateId) {
            if (confirm('이 알림 템플릿을 삭제하시겠습니까?')) {
                const index = alertTemplates.findIndex(t => t.id === templateId);
                if (index !== -1) {
                    alertTemplates.splice(index, 1);
                    populateAlertTemplates();
                    showNotification('알림 템플릿이 삭제되었습니다', 'success');
                }
            }
        }

        function viewAlertHistory() {
            // Set default date range (last 7 days)
            const today = new Date();
            const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
            
            document.getElementById('historyStartDate').value = weekAgo.toISOString().split('T')[0];
            document.getElementById('historyEndDate').value = today.toISOString().split('T')[0];
            
            loadAlertHistory();
            openModal('alertHistoryModal');
        }

        function loadAlertHistory() {
            const startDate = document.getElementById('historyStartDate').value;
            const endDate = document.getElementById('historyEndDate').value;
            const severityFilter = document.getElementById('historySeverityFilter').value;

            showNotification('알림 히스토리를 로딩하고 있습니다...', 'info');

            // Simulate API call
            setTimeout(() => {
                const history = Array.from({ length: 20 }, (_, i) => {
                    const severity = ['critical', 'warning', 'info'][Math.floor(Math.random() * 3)];
                    return {
                        id: `history-${i + 1}`,
                        title: `과거 알림 ${i + 1}`,
                        severity: severity,
                        status: 'resolved',
                        createdAt: new Date(Date.now() - Math.random() * 7 * 24 * 60 * 60 * 1000).toISOString(),
                        resolvedAt: new Date(Date.now() - Math.random() * 6 * 24 * 60 * 60 * 1000).toISOString(),
                        resolution: Math.random() > 0.5 ? '자동 해결' : '수동 해결',
                        resolvedBy: Math.random() > 0.5 ? 'system' : 'admin'
                    };
                }).filter(item => !severityFilter || item.severity === severityFilter);

                const container = document.getElementById('alertHistoryList');
                container.innerHTML = history.map(item => `
                    <div class="alert-item ${item.severity} resolved" style="margin-bottom: 10px;">
                        <div class="alert-icon">${getSeverityIcon(item.severity)}</div>
                        <div class="alert-content">
                            <div class="alert-title">${item.title}</div>
                            <div class="alert-meta">
                                <span>⏰ 생성: ${formatTime(item.createdAt)}</span>
                                <span>✅ 해결: ${formatTime(item.resolvedAt)}</span>
                                <span>👤 ${item.resolvedBy}</span>
                                <span>📋 ${item.resolution}</span>
                            </div>
                        </div>
                    </div>
                `).join('');

                showNotification(`${history.length}개의 히스토리 항목을 로딩했습니다`, 'success');
            }, 1000);
        }

        function exportAlertHistory() {
            const historyData = {
                exportDate: new Date().toISOString(),
                period: {
                    start: document.getElementById('historyStartDate').value,
                    end: document.getElementById('historyEndDate').value
                },
                filter: document.getElementById('historySeverityFilter').value,
                data: Array.from(document.querySelectorAll('#alertHistoryList .alert-item')).map((item, i) => ({
                    id: `export-${i + 1}`,
                    title: item.querySelector('.alert-title').textContent,
                    severity: item.classList.contains('critical') ? 'critical' : item.classList.contains('warning') ? 'warning' : 'info',
                    exportedAt: new Date().toISOString()
                }))
            };

            downloadJson(historyData, `alert-history-${new Date().toISOString().split('T')[0]}.json`);
            showNotification('알림 히스토리가 내보내기되었습니다', 'success');
        }

        function openMaintenanceMode() {
            // Set default times (1 hour from now to 2 hours from now)
            const now = new Date();
            const startTime = new Date(now.getTime() + 60 * 60 * 1000);
            const endTime = new Date(now.getTime() + 2 * 60 * 60 * 1000);
            
            document.getElementById('maintenanceStart').value = startTime.toISOString().slice(0, 16);
            document.getElementById('maintenanceEnd').value = endTime.toISOString().slice(0, 16);
            
            openModal('maintenanceModeModal');
        }

        function toggleMaintenanceOption(toggle) {
            toggle.classList.toggle('active');
        }

        function activateMaintenanceMode() {
            const form = document.getElementById('maintenanceForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const maintenanceData = {
                startTime: document.getElementById('maintenanceStart').value,
                endTime: document.getElementById('maintenanceEnd').value,
                reason: document.getElementById('maintenanceReason').value,
                affectedSystems: [],
                allowCritical: document.getElementById('allowCriticalToggle').classList.contains('active')
            };

            // Collect affected systems
            if (document.getElementById('maintainDatabase').checked) maintenanceData.affectedSystems.push('database');
            if (document.getElementById('maintainApplication').checked) maintenanceData.affectedSystems.push('application');
            if (document.getElementById('maintainInfrastructure').checked) maintenanceData.affectedSystems.push('infrastructure');
            if (document.getElementById('maintainNetwork').checked) maintenanceData.affectedSystems.push('network');
            if (document.getElementById('maintainSecurity').checked) maintenanceData.affectedSystems.push('security');

            if (confirm('점검 모드를 활성화하시겠습니까? 설정된 시간 동안 알림이 제한됩니다.')) {
                closeModal('maintenanceModeModal');
                showNotification('점검 모드가 활성화되었습니다', 'warning');
                
                // Update header to show maintenance mode
                const statusBadge = document.querySelector('.status-badge');
                statusBadge.className = 'status-badge';
                statusBadge.style.background = 'linear-gradient(135deg, #f59e0b, #d97706)';
                statusBadge.innerHTML = '<span>🔧</span> 점검 모드 활성';
            }
        }

        function openQuickResponse() {
            openModal('quickResponseModal');
        }

        function quickResolveAll() {
            const warningAlerts = alertsData.filter(a => a.severity === 'warning' && a.status === 'active');
            showNotification(`${warningAlerts.length}개의 경고 알림을 해결 처리하고 있습니다...`, 'info');
            
            setTimeout(() => {
                warningAlerts.forEach(alert => alert.status = 'resolved');
                populateAlertList();
                updateOverviewCards();
                showNotification(`${warningAlerts.length}개의 경고 알림이 해결되었습니다`, 'success');
            }, 1500);
        }

        function quickEscalateAll() {
            const criticalAlerts = alertsData.filter(a => a.severity === 'critical' && a.status === 'active');
            showNotification(`${criticalAlerts.length}개의 위험 알림을 에스컬레이션하고 있습니다...`, 'warning');
            
            setTimeout(() => {
                criticalAlerts.forEach(alert => {
                    alert.escalationLevel = Math.min(alert.escalationLevel + 1, 3);
                    alert.assignee = 'admin';
                });
                populateAlertList();
                showNotification(`${criticalAlerts.length}개의 위험 알림이 에스컬레이션되었습니다`, 'warning');
            }, 1500);
        }

        function quickNotifyTeam() {
            const message = document.getElementById('quickMessage').value || '긴급 상황이 발생했습니다. 즉시 확인이 필요합니다.';
            showNotification('전체 팀에게 긴급 알림을 전송하고 있습니다...', 'info');
            
            setTimeout(() => {
                showNotification('전체 팀에게 긴급 알림이 전송되었습니다', 'success');
            }, 2000);
        }

        function quickSilenceAll() {
            if (confirm('1시간 동안 모든 알림을 중단하시겠습니까?')) {
                showNotification('1시간 동안 모든 알림이 중단됩니다', 'warning');
                
                // Update header to show silence mode
                setTimeout(() => {
                    const statusBadge = document.querySelector('.status-badge');
                    statusBadge.className = 'status-badge';
                    statusBadge.style.background = 'linear-gradient(135deg, #6b7280, #4b5563)';
                    statusBadge.innerHTML = '<span>🔇</span> 알림 중단 모드';
                }, 500);
            }
        }

        function executeQuickResponse() {
            const message = document.getElementById('quickMessage').value;
            if (message.trim()) {
                quickNotifyTeam();
            } else {
                showNotification('메시지를 입력해주세요', 'warning');
                return;
            }
            closeModal('quickResponseModal');
        }

        // Modal utility functions
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.add('show');
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('show');
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
            document.body.style.overflow = 'auto';
        }

        // Download utility function
        function downloadJson(data, filename) {
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Close modals when clicking outside
        window.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('show');
                setTimeout(() => {
                    e.target.style.display = 'none';
                }, 300);
                document.body.style.overflow = 'auto';
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                const openModal = document.querySelector('.modal.show');
                if (openModal) {
                    openModal.classList.remove('show');
                    setTimeout(() => {
                        openModal.style.display = 'none';
                    }, 300);
                    document.body.style.overflow = 'auto';
                }
            }
        });

        // Enhanced notification system with action tracking
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            const colors = {
                success: '#10b981',
                error: '#ef4444',
                warning: '#f59e0b',
                info: '#3b82f6'
            };

            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${colors[type] || colors.info};
                color: white;
                padding: 15px 25px;
                border-radius: 12px;
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
                z-index: 10001;
                font-size: 14px;
                font-weight: 600;
                max-width: 400px;
                animation: slideInRight 0.3s ease;
            `;

            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideInRight 0.3s ease reverse';
                setTimeout(() => notification.remove(), 300);
            }, 4000);
        }
        
        // Alert logging system
        let alertLogs = {}; // alertId -> array of log entries
        
        function addAlertLog(alertId, action, description, actor) {
            if (!alertLogs[alertId]) {
                alertLogs[alertId] = [];
            }
            
            const logEntry = {
                id: `log-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
                timestamp: new Date().toISOString(),
                action: action,
                description: description,
                actor: actor,
                metadata: {
                    userAgent: navigator.userAgent,
                    ip: 'xxx.xxx.xxx.xxx' // 실제 구현에서는 서버에서 처리
                }
            };
            
            alertLogs[alertId].unshift(logEntry); // 최신 로그가 맨 위에
            
            // 로그를 서버에 전송 (선택적)
            saveLogToServer(alertId, logEntry);
        }
        
        function saveLogToServer(alertId, logEntry) {
            fetch(`/api/alerts/${alertId}/logs`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(logEntry)
            })
            .catch(error => {
                console.error('Failed to save log to server:', error);
                // 로컬 스토리지에 백업
                const localLogs = JSON.parse(localStorage.getItem('alertLogs') || '{}');
                if (!localLogs[alertId]) localLogs[alertId] = [];
                localLogs[alertId].unshift(logEntry);
                localStorage.setItem('alertLogs', JSON.stringify(localLogs));
            });
        }
        
        function getAlertLogs(alertId) {
            return alertLogs[alertId] || [];
        }
        
        function showAlertHistory(alertId) {
            const alert = alertsData.find(a => a.id === alertId);
            const logs = getAlertLogs(alertId);
            
            if (!alert) return;
            
            const historyHTML = `
                <div style="margin-bottom: 20px;">
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h4 style="margin-bottom: 10px; color: #333;">알림 정보</h4>
                        <div style="font-weight: 600; color: #${alert.severity === 'critical' ? 'dc2626' : alert.severity === 'warning' ? 'ea580c' : '2563eb'};">
                            ${getSeverityIcon(alert.severity)} ${alert.title}
                        </div>
                        <div style="font-size: 14px; color: #666; margin-top: 5px;">${alert.description}</div>
                        <div style="font-size: 12px; color: #999; margin-top: 5px;">
                            생성시간: ${formatTime(alert.timestamp)} | 상태: ${alert.status} | 에스컬레이션: ${alert.escalationLevel || 1}단계
                        </div>
                    </div>
                    
                    <h4 style="margin-bottom: 15px; color: #333;">작업 히스토리</h4>
                    <div style="max-height: 400px; overflow-y: auto;">
                        ${logs.length > 0 ? logs.map(log => `
                            <div style="background: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 12px; margin-bottom: 10px;">
                                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px;">
                                    <span style="font-weight: 600; color: #333;">${getActionIcon(log.action)} ${getActionName(log.action)}</span>
                                    <span style="font-size: 12px; color: #666;">${formatTime(log.timestamp)}</span>
                                </div>
                                <div style="font-size: 14px; color: #555; margin-bottom: 6px;">${log.description}</div>
                                <div style="font-size: 12px; color: #999;">작업자: ${log.actor}</div>
                            </div>
                        `).join('') : `
                            <div style="text-align: center; padding: 40px; color: #999;">
                                아직 작업 히스토리가 없습니다.
                            </div>
                        `}
                    </div>
                </div>
            `;
            
            showModal('알림 히스토리', historyHTML, null, false);
        }
        
        function getActionIcon(action) {
            const icons = {
                'created': '📅',
                'resolved': '✅',
                'escalated': '📈',
                'ignored': '🙈',
                'notification_sent': '📧',
                'assigned': '👤',
                'commented': '💬',
                'updated': '✏️'
            };
            return icons[action] || '📌';
        }
        
        function getActionName(action) {
            const names = {
                'created': '알림 생성',
                'resolved': '해결 완료',
                'escalated': '에스컬레이션',
                'ignored': '무시 처리',
                'notification_sent': '알림 전송',
                'assigned': '담당자 지정',
                'commented': '댓글 작성',
                'updated': '알림 수정'
            };
            return names[action] || '기타 작업';
        }
        
        // Modal system for enhanced functionality
        function showModal(title, content, onConfirm = null, showCancel = true) {
            const existingModal = document.getElementById('alertModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            const modal = document.createElement('div');
            modal.id = 'alertModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.6);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                animation: fadeIn 0.3s ease;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: white;
                    border-radius: 16px;
                    padding: 30px;
                    max-width: 700px;
                    width: 90%;
                    max-height: 85vh;
                    overflow-y: auto;
                    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                    animation: slideInUp 0.3s ease;
                ">
                    <h3 style="margin: 0 0 20px 0; color: #333; font-size: 24px; font-weight: 600;">${title}</h3>
                    <div style="margin-bottom: 25px;">${content}</div>
                    <div style="display: flex; gap: 15px; justify-content: flex-end;">
                        ${showCancel ? '<button class="btn btn-secondary" onclick="closeModal()">취소</button>' : ''}
                        ${onConfirm ? '<button class="btn btn-primary" onclick="handleModalConfirm()">확인</button>' : ''}
                        ${!onConfirm && !showCancel ? '<button class="btn btn-primary" onclick="closeModal()">닫기</button>' : ''}
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Store confirm handler
            if (onConfirm) {
                window.currentModalConfirm = onConfirm;
            }
            
            // Close on background click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeModal();
                }
            });
        }
        
        function closeModal() {
            const modal = document.getElementById('alertModal');
            if (modal) {
                modal.style.animation = 'fadeIn 0.3s ease reverse';
                setTimeout(() => modal.remove(), 300);
            }
            window.currentModalConfirm = null;
        }
        
        function handleModalConfirm() {
            if (window.currentModalConfirm) {
                window.currentModalConfirm();
            }
        }

        // Add CSS for animations and modal styles
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }
            @keyframes slideInUp {
                from { transform: translateY(30px); opacity: 0; }
                to { transform: translateY(0); opacity: 1; }
            }
            .form-group {
                margin-bottom: 20px;
            }
            .form-label {
                display: block;
                margin-bottom: 8px;
                font-weight: 600;
                color: #374151;
                font-size: 14px;
            }
            .form-input, .form-select, .form-textarea {
                width: 100%;
                padding: 12px 16px;
                border: 2px solid #e5e7eb;
                border-radius: 10px;
                font-size: 14px;
                transition: all 0.3s ease;
                font-family: inherit;
            }
            .form-input:focus, .form-select:focus, .form-textarea:focus {
                outline: none;
                border-color: #3b82f6;
                box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            }
            .form-textarea {
                resize: vertical;
                min-height: 100px;
            }
            .btn-secondary {
                background: #f3f4f6;
                color: #4b5563;
                padding: 12px 24px;
                border: none;
                border-radius: 10px;
                font-size: 14px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
            }
            .btn-secondary:hover {
                background: #e5e7eb;
            }
            .btn-history {
                background: #6b7280 !important;
                color: white !important;
            }
            .btn-history:hover {
                background: #4b5563 !important;
            }
        `;
        document.head.appendChild(style);

        // Initialize on page load
        window.addEventListener('load', () => {
            initializeAlertManagement();
        });
    </script>
    </div>
</body>
</html>