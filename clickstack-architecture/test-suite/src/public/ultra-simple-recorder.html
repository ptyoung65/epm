<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì´ˆë‹¨ìˆœ DOM ë…¹í™”ê¸°</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f0f0f0;
        }
        
        .panel {
            background: white;
            padding: 30px;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 { 
            color: #333; 
            text-align: center;
        }
        
        .status {
            background: #e9ecef;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
        }
        
        .controls {
            text-align: center;
            margin: 30px 0;
        }
        
        .btn {
            font-size: 18px;
            padding: 15px 30px;
            margin: 10px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .btn-green {
            background: #28a745;
            color: white;
        }
        
        .btn-red {
            background: #dc3545;
            color: white;
        }
        
        .btn-blue {
            background: #007bff;
            color: white;
        }
        
        .btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        .test-area {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            border: 2px dashed #dee2e6;
            margin: 20px 0;
        }
        
        input, textarea {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 2px solid #ced4da;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .test-btn {
            padding: 15px 25px;
            background: #17a2b8;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        
        #debugArea {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="panel">
        <h1>ğŸ¬ ì´ˆë‹¨ìˆœ DOM ë…¹í™”ê¸°</h1>
        
        <div class="status" id="statusDisplay">
            ì‹œìŠ¤í…œ ë¡œë”© ì¤‘...
        </div>
        
        <div class="controls">
            <button class="btn btn-green" onclick="startRecordingTest()">ğŸ”´ ë…¹í™” ì‹œì‘</button>
            <button class="btn btn-red" onclick="stopRecordingTest()" disabled id="stopButton">â¹ï¸ ë…¹í™” ì¤‘ì§€</button>
            <button class="btn btn-blue" onclick="playRecordingTest()" disabled id="playButton">â–¶ï¸ ì¬ìƒí•˜ê¸°</button>
        </div>
    </div>
    
    <div class="panel test-area">
        <h2>ğŸ§ª í…ŒìŠ¤íŠ¸ ì˜ì—­</h2>
        
        <input type="text" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" id="nameField">
        <input type="email" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”" id="emailField">
        <textarea placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”" rows="3" id="messageField"></textarea>
        
        <div style="margin: 20px 0;">
            <button class="test-btn" onclick="testButtonClick('ë²„íŠ¼A')">í…ŒìŠ¤íŠ¸ ë²„íŠ¼ A</button>
            <button class="test-btn" onclick="testButtonClick('ë²„íŠ¼B')">í…ŒìŠ¤íŠ¸ ë²„íŠ¼ B</button>
            <button class="test-btn" onclick="changeColor()">ìƒ‰ìƒ ë³€ê²½</button>
        </div>
        
        <div style="background: #e3f2fd; padding: 20px; text-align: center; border-radius: 8px; cursor: pointer;" onclick="clickTestArea()">
            <h3>ğŸ¯ í´ë¦­ í…ŒìŠ¤íŠ¸ ì˜ì—­</h3>
            <p>ì—¬ê¸°ë¥¼ í´ë¦­í•´ë³´ì„¸ìš”</p>
        </div>
    </div>
    
    <div class="panel">
        <h3>ğŸ› ë””ë²„ê·¸ ë¡œê·¸</h3>
        <div id="debugArea">ì‹œìŠ¤í…œ ì‹œì‘...
</div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let isRecording = false;
        let recordedEvents = [];
        let sessionId = null;
        let startTime = null;
        
        // ë””ë²„ê·¸ ë¡œê·¸ í•¨ìˆ˜
        function addDebugLog(message) {
            const debugArea = document.getElementById('debugArea');
            const timestamp = new Date().toLocaleTimeString();
            debugArea.textContent += `[${timestamp}] ${message}\n`;
            debugArea.scrollTop = debugArea.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }
        
        // ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateStatus(message) {
            document.getElementById('statusDisplay').textContent = message;
            addDebugLog(`ìƒíƒœ ë³€ê²½: ${message}`);
        }
        
        // ë…¹í™” ì‹œì‘ í•¨ìˆ˜ (onclickìœ¼ë¡œ ì§ì ‘ í˜¸ì¶œ)
        function startRecordingTest() {
            addDebugLog('=== startRecordingTest í•¨ìˆ˜ í˜¸ì¶œë¨ ===');
            
            if (isRecording) {
                alert('ì´ë¯¸ ë…¹í™” ì¤‘ì…ë‹ˆë‹¤!');
                addDebugLog('ì´ë¯¸ ë…¹í™” ì¤‘ - ì¤‘ë‹¨');
                return;
            }
            
            try {
                // ê¸°ë³¸ ì´ˆê¸°í™”
                recordedEvents = [];
                sessionId = 'session_' + Date.now();
                startTime = Date.now();
                isRecording = true;
                
                addDebugLog(`ë…¹í™” ì´ˆê¸°í™” ì™„ë£Œ - ì„¸ì…˜: ${sessionId}`);
                
                // UI ì—…ë°ì´íŠ¸
                updateStatus(`ğŸ”´ ë…¹í™” ì¤‘ - ì„¸ì…˜: ${sessionId.substring(0, 20)}...`);
                document.getElementById('stopButton').disabled = false;
                document.getElementById('playButton').disabled = true;
                
                // ê¸°ë³¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ (rrweb ì—†ì´)
                setupEventListeners();
                
                addDebugLog('âœ… ë…¹í™” ì‹œì‘ ì„±ê³µ');
                alert('âœ… ë…¹í™”ê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤! ì•„ë˜ í…ŒìŠ¤íŠ¸ ì˜ì—­ì—ì„œ í´ë¦­ì´ë‚˜ ì…ë ¥ì„ í•´ë³´ì„¸ìš”.');
                
            } catch (error) {
                addDebugLog(`âŒ ë…¹í™” ì‹œì‘ ì‹¤íŒ¨: ${error.message}`);
                alert('âŒ ë…¹í™” ì‹œì‘ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
                resetRecording();
            }
        }
        
        // ë…¹í™” ì¤‘ì§€ í•¨ìˆ˜
        function stopRecordingTest() {
            addDebugLog('=== stopRecordingTest í•¨ìˆ˜ í˜¸ì¶œë¨ ===');
            
            if (!isRecording) {
                alert('ë…¹í™” ì¤‘ì´ ì•„ë‹™ë‹ˆë‹¤!');
                addDebugLog('ë…¹í™” ì¤‘ì´ ì•„ë‹˜');
                return;
            }
            
            try {
                isRecording = false;
                
                // UI ì—…ë°ì´íŠ¸
                updateStatus(`âœ… ë…¹í™” ì™„ë£Œ - ${recordedEvents.length}ê°œ ì´ë²¤íŠ¸ ìˆ˜ì§‘`);
                document.getElementById('stopButton').disabled = true;
                document.getElementById('playButton').disabled = false;
                
                // ì„¸ì…˜ ë°ì´í„° ìƒì„±
                const sessionData = {
                    id: sessionId,
                    startTime: startTime,
                    endTime: Date.now(),
                    duration: Date.now() - startTime,
                    events: recordedEvents,
                    eventCount: recordedEvents.length
                };
                
                // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
                localStorage.setItem(sessionId, JSON.stringify(sessionData));
                
                addDebugLog(`âœ… ë…¹í™” ì™„ë£Œ - ${recordedEvents.length}ê°œ ì´ë²¤íŠ¸ ì €ì¥`);
                alert(`âœ… ë…¹í™” ì™„ë£Œ! ${recordedEvents.length}ê°œì˜ ì´ë²¤íŠ¸ê°€ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                
            } catch (error) {
                addDebugLog(`âŒ ë…¹í™” ì¤‘ì§€ ì‹¤íŒ¨: ${error.message}`);
                alert('âŒ ë…¹í™” ì¤‘ì§€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }
        
        // ì¬ìƒ í•¨ìˆ˜
        function playRecordingTest() {
            addDebugLog('=== playRecordingTest í•¨ìˆ˜ í˜¸ì¶œë¨ ===');
            
            if (!sessionId || recordedEvents.length === 0) {
                alert('ì¬ìƒí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤!');
                addDebugLog('ì¬ìƒí•  ë°ì´í„° ì—†ìŒ');
                return;
            }
            
            // í”Œë ˆì´ì–´ í˜ì´ì§€ë¡œ ì´ë™
            const playerUrl = `ultra-simple-player.html?sessionId=${sessionId}`;
            addDebugLog(`í”Œë ˆì´ì–´ ì—´ê¸°: ${playerUrl}`);
            
            // ìƒˆ ì°½ìœ¼ë¡œ í”Œë ˆì´ì–´ ì—´ê¸°
            const playerWindow = window.open(playerUrl, '_blank', 'width=1200,height=800,scrollbars=yes,resizable=yes');
            
            if (!playerWindow) {
                alert('âš ï¸ íŒì—…ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì €ì—ì„œ íŒì—…ì„ í—ˆìš©í•´ì£¼ì„¸ìš”.');
                addDebugLog('âŒ íŒì—… ì°¨ë‹¨ë¨');
            } else {
                addDebugLog('âœ… í”Œë ˆì´ì–´ ì°½ ì—´ë¦¼');
            }
        }
        
        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • (rrweb ì—†ì´ ê¸°ë³¸ ì´ë²¤íŠ¸ ìˆ˜ì§‘)
        function setupEventListeners() {
            addDebugLog('ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì‹œì‘');
            
            // í´ë¦­ ì´ë²¤íŠ¸
            document.addEventListener('click', function(e) {
                if (isRecording) {
                    recordEvent('click', e.target, e.target.textContent || e.target.value || '');
                }
            });
            
            // ì…ë ¥ ì´ë²¤íŠ¸
            document.addEventListener('input', function(e) {
                if (isRecording) {
                    recordEvent('input', e.target, e.target.value);
                }
            });
            
            // ë³€ê²½ ì´ë²¤íŠ¸
            document.addEventListener('change', function(e) {
                if (isRecording) {
                    recordEvent('change', e.target, e.target.value);
                }
            });
            
            addDebugLog('ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì™„ë£Œ');
        }
        
        // ì´ë²¤íŠ¸ ê¸°ë¡ í•¨ìˆ˜
        function recordEvent(type, target, value) {
            const event = {
                type: type,
                timestamp: Date.now() - startTime,
                target: target.tagName + (target.id ? '#' + target.id : '') + (target.className ? '.' + target.className : ''),
                value: value ? value.substring(0, 50) : '',
                x: 0, // ê°„ë‹¨íˆ 0ìœ¼ë¡œ ì„¤ì •
                y: 0
            };
            
            recordedEvents.push(event);
            addDebugLog(`ì´ë²¤íŠ¸ ê¸°ë¡: ${type} on ${event.target} - "${event.value}"`);
            updateStatus(`ğŸ”´ ë…¹í™” ì¤‘ - ${recordedEvents.length}ê°œ ì´ë²¤íŠ¸ ìˆ˜ì§‘ë¨`);
        }
        
        // ë…¹í™” ë¦¬ì…‹
        function resetRecording() {
            isRecording = false;
            recordedEvents = [];
            sessionId = null;
            startTime = null;
            document.getElementById('stopButton').disabled = true;
            document.getElementById('playButton').disabled = true;
            updateStatus('ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ');
        }
        
        // í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë“¤
        function testButtonClick(buttonName) {
            addDebugLog(`${buttonName} í´ë¦­ë¨`);
        }
        
        function changeColor() {
            document.body.style.backgroundColor = `hsl(${Math.random() * 360}, 50%, 95%)`;
            addDebugLog('ë°°ê²½ìƒ‰ ë³€ê²½ë¨');
        }
        
        function clickTestArea() {
            const area = event.target;
            area.style.backgroundColor = `hsl(${Math.random() * 360}, 30%, 85%)`;
            addDebugLog('í´ë¦­ í…ŒìŠ¤íŠ¸ ì˜ì—­ í´ë¦­ë¨');
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ í›„ ì´ˆê¸°í™”
        window.addEventListener('load', function() {
            addDebugLog('í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
            updateStatus('âœ… ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ - ë…¹í™” ì‹œì‘ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”');
            addDebugLog('âœ… ëª¨ë“  ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ');
        });
        
        // ì¦‰ì‹œ ë¡œê·¸ ì‹œì‘
        addDebugLog('ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© ì™„ë£Œ');
    </script>
</body>
</html>