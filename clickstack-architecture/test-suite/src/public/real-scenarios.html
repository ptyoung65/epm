<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¬ ì‹¤ì œ í™”ë©´ ê¸°ë°˜ ì„¸ì…˜ ë¦¬í”Œë ˆì´ í…ŒìŠ¤íŠ¸</title>
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    
    <!-- rrweb ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ -->
    <script src="/rrweb.js"></script>
    <script>
        console.log('rrweb ë¡œë“œ ì²´í¬:', typeof rrweb);
        if (typeof rrweb === 'undefined') {
            console.log('rrweb ë¡œë“œ ì‹¤íŒ¨, ë‹¤ë¥¸ ë°©ë²• ì‹œë„...');
        } else {
            console.log('âœ… rrweb ì„±ê³µì ìœ¼ë¡œ ë¡œë“œë¨');
        }
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .header p {
            color: #7f8c8d;
            font-size: 1.1rem;
        }
        
        .scenarios-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(600px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .scenario-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        
        .scenario-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 50px rgba(0,0,0,0.15);
        }
        
        .scenario-title {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .scenario-description {
            color: #666;
            margin-bottom: 25px;
            line-height: 1.6;
        }
        
        .test-interface {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 2px dashed #e9ecef;
        }
        
        .test-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0056b3;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #1e7e34;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        
        .btn-warning:hover {
            background: #e0a800;
        }
        
        .recording-status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            z-index: 1000;
            display: none;
        }
        
        .recording-status.active {
            display: block;
            background: #dc3545;
            color: white;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #495057;
        }
        
        .form-control {
            width: 100%;
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #007bff;
        }
        
        .results-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
        }
        
        .session-info {
            background: #e7f3ff;
            border-left: 4px solid #007bff;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        
        .error-simulation {
            background: #fff5f5;
            border: 1px solid #fed7d7;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            color: #721c24;
        }
        
        .performance-meter {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .progress-bar {
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            transition: width 2s ease;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <div class="recording-status" id="recordingStatus">
        ğŸ”´ ì„¸ì…˜ ë…¹í™” ì¤‘... <span id="recordingTime">00:00</span>
    </div>

    <div class="container">
        <div class="header">
            <h1>ğŸ¬ ì‹¤ì œ í™”ë©´ ê¸°ë°˜ ì„¸ì…˜ ë¦¬í”Œë ˆì´ í…ŒìŠ¤íŠ¸</h1>
            <p>rrwebì„ ì‚¬ìš©í•œ ì‹¤ì œ DOM ìº¡ì²˜ ë° í”„ë¡œë•ì…˜ ë ˆë²¨ ì„¸ì…˜ ë¶„ì„</p>
        </div>

        <div class="scenarios-grid">
            <!-- ì‹œë‚˜ë¦¬ì˜¤ 1: E-commerce ê²°ì œ í”Œë¡œìš° -->
            <div class="scenario-card">
                <div class="scenario-title">
                    ğŸ›’ E-commerce ê²°ì œ í”Œë¡œìš°
                </div>
                <div class="scenario-description">
                    ì‹¤ì œ ì˜¨ë¼ì¸ ì‡¼í•‘ ê²°ì œ ê³¼ì •ì—ì„œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ë‹¤ì–‘í•œ ìƒí™©ì„ ì‹œë®¬ë ˆì´ì…˜í•©ë‹ˆë‹¤.
                </div>
                
                <div class="test-interface" data-scenario="ecommerce_checkout">
                    <div class="test-controls">
                        <button class="btn btn-primary" onclick="startScenario('ecommerce_checkout')">
                            ğŸ¬ ì‹œë‚˜ë¦¬ì˜¤ ì‹œì‘
                        </button>
                        <button class="btn btn-success" onclick="completeScenario('ecommerce_checkout')">
                            âœ… ì‹œë‚˜ë¦¬ì˜¤ ì™„ë£Œ
                        </button>
                    </div>
                    
                    <!-- ì‹¤ì œ ê²°ì œ í¼ -->
                    <div class="checkout-form">
                        <h4>ê²°ì œ ì •ë³´</h4>
                        <div class="form-group">
                            <label for="cardNumber">ì¹´ë“œ ë²ˆí˜¸</label>
                            <input type="text" id="cardNumber" class="form-control" 
                                   placeholder="1234-5678-9012-3456" maxlength="19">
                        </div>
                        <div class="form-group">
                            <label for="expiryDate">ë§Œë£Œì¼</label>
                            <input type="text" id="expiryDate" class="form-control" 
                                   placeholder="MM/YY" maxlength="5">
                        </div>
                        <div class="form-group">
                            <label for="cvv">CVV</label>
                            <input type="text" id="cvv" class="form-control" 
                                   placeholder="123" maxlength="4">
                        </div>
                        <button class="btn btn-success" onclick="processPayment()">
                            ğŸ’³ ê²°ì œ ì²˜ë¦¬ (â‚©50,000)
                        </button>
                        
                        <div class="error-simulation" id="paymentError" style="display: none;">
                            âŒ ê²°ì œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì¹´ë“œ ì •ë³´ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.
                        </div>
                    </div>
                </div>
            </div>

            <!-- ì‹œë‚˜ë¦¬ì˜¤ 2: SaaS ëŒ€ì‹œë³´ë“œ ìƒí˜¸ì‘ìš© -->
            <div class="scenario-card">
                <div class="scenario-title">
                    ğŸ“Š SaaS ëŒ€ì‹œë³´ë“œ ìƒí˜¸ì‘ìš©
                </div>
                <div class="scenario-description">
                    ë¹„ì¦ˆë‹ˆìŠ¤ ëŒ€ì‹œë³´ë“œì—ì„œì˜ ì°¨íŠ¸ ì¡°ì‘, í•„í„°ë§, ë°ì´í„° ë‚´ë³´ë‚´ê¸° ë“±ì˜ ë³µì¡í•œ ìƒí˜¸ì‘ìš©
                </div>
                
                <div class="test-interface" data-scenario="saas_dashboard">
                    <div class="test-controls">
                        <button class="btn btn-primary" onclick="startScenario('saas_dashboard')">
                            ğŸ¬ ì‹œë‚˜ë¦¬ì˜¤ ì‹œì‘
                        </button>
                        <button class="btn btn-warning" onclick="loadDashboardData()">
                            ğŸ“Š ëŒ€ì‹œë³´ë“œ ë¡œë“œ
                        </button>
                        <button class="btn btn-success" onclick="completeScenario('saas_dashboard')">
                            âœ… ì‹œë‚˜ë¦¬ì˜¤ ì™„ë£Œ
                        </button>
                    </div>
                    
                    <!-- ëŒ€ì‹œë³´ë“œ ì»¨íŠ¸ë¡¤ -->
                    <div class="dashboard-controls">
                        <h4>ë¹„ì¦ˆë‹ˆìŠ¤ ë©”íŠ¸ë¦­</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 15px 0;">
                            <div class="metric-card" style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 2em; font-weight: bold; color: #28a745;">â‚©2.4M</div>
                                <div style="color: #666;">ì´ë²ˆ ë‹¬ ë§¤ì¶œ</div>
                            </div>
                            <div class="metric-card" style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 2em; font-weight: bold; color: #007bff;">1,234</div>
                                <div style="color: #666;">í™œì„± ì‚¬ìš©ì</div>
                            </div>
                        </div>
                        
                        <div class="performance-meter">
                            <h5>ì°¨íŠ¸ ë¡œë”© ì„±ëŠ¥</h5>
                            <div class="progress-bar">
                                <div class="progress-fill" id="chartProgress" style="width: 0%;"></div>
                            </div>
                            <small id="loadingStatus">ëŒ€ê¸° ì¤‘...</small>
                        </div>
                        
                        <button class="btn btn-warning" onclick="simulateSlowChart()">
                            ğŸŒ ëŠë¦° ì°¨íŠ¸ ë¡œë”© ì‹œë®¬ë ˆì´ì…˜
                        </button>
                    </div>
                </div>
            </div>

            <!-- ì‹œë‚˜ë¦¬ì˜¤ 3: í¼ ê²€ì¦ ë° ì‚¬ìš©ì í”¼ë“œë°± -->
            <div class="scenario-card">
                <div class="scenario-title">
                    ğŸ“ í¼ ê²€ì¦ ë° ì‚¬ìš©ì í”¼ë“œë°±
                </div>
                <div class="scenario-description">
                    ë³µì¡í•œ í¼ ì…ë ¥, ì‹¤ì‹œê°„ ê²€ì¦, ì—ëŸ¬ ì²˜ë¦¬ ë° ì‚¬ìš©ì í”¼ë“œë°± ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
                </div>
                
                <div class="test-interface" data-scenario="form_validation">
                    <div class="test-controls">
                        <button class="btn btn-primary" onclick="startScenario('form_validation')">
                            ğŸ¬ ì‹œë‚˜ë¦¬ì˜¤ ì‹œì‘
                        </button>
                        <button class="btn btn-danger" onclick="triggerValidationErrors()">
                            âŒ ê²€ì¦ ì˜¤ë¥˜ ë°œìƒ
                        </button>
                        <button class="btn btn-success" onclick="completeScenario('form_validation')">
                            âœ… ì‹œë‚˜ë¦¬ì˜¤ ì™„ë£Œ
                        </button>
                    </div>
                    
                    <!-- ì‚¬ìš©ì ë“±ë¡ í¼ -->
                    <div class="registration-form">
                        <h4>ì‚¬ìš©ì ë“±ë¡</h4>
                        <div class="form-group">
                            <label for="username">ì‚¬ìš©ìëª…</label>
                            <input type="text" id="username" class="form-control" 
                                   placeholder="ì˜ë¬¸, ìˆ«ì 3-20ì" onchange="validateUsername(this)">
                            <div class="validation-message" id="usernameError"></div>
                        </div>
                        <div class="form-group">
                            <label for="email">ì´ë©”ì¼</label>
                            <input type="email" id="email" class="form-control" 
                                   placeholder="example@domain.com" onchange="validateEmail(this)">
                            <div class="validation-message" id="emailError"></div>
                        </div>
                        <div class="form-group">
                            <label for="password">ë¹„ë°€ë²ˆí˜¸</label>
                            <input type="password" id="password" class="form-control" 
                                   placeholder="8ì ì´ìƒ, íŠ¹ìˆ˜ë¬¸ì í¬í•¨" onchange="validatePassword(this)">
                            <div class="validation-message" id="passwordError"></div>
                        </div>
                        <button class="btn btn-primary" onclick="submitRegistration()">
                            ğŸ‘¤ ê³„ì • ìƒì„±
                        </button>
                    </div>
                </div>
            </div>

            <!-- ì‹œë‚˜ë¦¬ì˜¤ 4: ëª¨ë°”ì¼ ë°˜ì‘í˜• ìƒí˜¸ì‘ìš© -->
            <div class="scenario-card">
                <div class="scenario-title">
                    ğŸ“± ëª¨ë°”ì¼ ë°˜ì‘í˜• ìƒí˜¸ì‘ìš©
                </div>
                <div class="scenario-description">
                    í„°ì¹˜ ì œìŠ¤ì²˜, ìŠ¤ì™€ì´í”„, ë°˜ì‘í˜• ë ˆì´ì•„ì›ƒ ë³€í™” ë“± ëª¨ë°”ì¼ íŠ¹í™” ìƒí˜¸ì‘ìš© í…ŒìŠ¤íŠ¸
                </div>
                
                <div class="test-interface" data-scenario="mobile_responsive">
                    <div class="test-controls">
                        <button class="btn btn-primary" onclick="startScenario('mobile_responsive')">
                            ğŸ¬ ì‹œë‚˜ë¦¬ì˜¤ ì‹œì‘
                        </button>
                        <button class="btn btn-warning" onclick="toggleMobileView()">
                            ğŸ“± ëª¨ë°”ì¼ ë·° ì „í™˜
                        </button>
                        <button class="btn btn-success" onclick="completeScenario('mobile_responsive')">
                            âœ… ì‹œë‚˜ë¦¬ì˜¤ ì™„ë£Œ
                        </button>
                    </div>
                    
                    <!-- ë°˜ì‘í˜• ì»¨í…ì¸  -->
                    <div class="responsive-content" id="responsiveContent">
                        <h4>ë°˜ì‘í˜• ì¹´ë“œ ë ˆì´ì•„ì›ƒ</h4>
                        <div class="cards-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 15px 0;">
                            <div class="card" style="background: #e3f2fd; padding: 20px; border-radius: 8px; text-align: center; cursor: pointer;" onclick="selectCard(1)">
                                <div style="font-size: 2em; margin-bottom: 10px;">ğŸ¯</div>
                                <div>ëª©í‘œ ê´€ë¦¬</div>
                            </div>
                            <div class="card" style="background: #f3e5f5; padding: 20px; border-radius: 8px; text-align: center; cursor: pointer;" onclick="selectCard(2)">
                                <div style="font-size: 2em; margin-bottom: 10px;">ğŸ“ˆ</div>
                                <div>ì„±ê³¼ ë¶„ì„</div>
                            </div>
                            <div class="card" style="background: #e8f5e8; padding: 20px; border-radius: 8px; text-align: center; cursor: pointer;" onclick="selectCard(3)">
                                <div style="font-size: 2em; margin-bottom: 10px;">âš™ï¸</div>
                                <div>ì‹œìŠ¤í…œ ì„¤ì •</div>
                            </div>
                        </div>
                        
                        <div class="mobile-menu" style="display: none;">
                            <button class="btn btn-primary" style="width: 100%; margin: 5px 0;">ğŸ  í™ˆ</button>
                            <button class="btn btn-primary" style="width: 100%; margin: 5px 0;">ğŸ“Š ëŒ€ì‹œë³´ë“œ</button>
                            <button class="btn btn-primary" style="width: 100%; margin: 5px 0;">ğŸ‘¤ í”„ë¡œí•„</button>
                            <button class="btn btn-primary" style="width: 100%; margin: 5px 0;">âš™ï¸ ì„¤ì •</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ë…¹í™” ê²°ê³¼ ì„¹ì…˜ -->
        <div class="results-section">
            <h2>ğŸ¬ ë…¹í™”ëœ ì„¸ì…˜ ì •ë³´</h2>
            <div id="sessionResults">
                <p>ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì‹œì‘í•˜ë©´ ì„¸ì…˜ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
            </div>
            
            <div class="test-controls" style="margin-top: 20px;">
                <button class="btn btn-success" onclick="viewRecordedSession()">
                    ğŸ‘€ ë…¹í™”ëœ ì„¸ì…˜ ë³´ê¸°
                </button>
                <button class="btn btn-warning" onclick="downloadSessionData()">
                    ğŸ’¾ ì„¸ì…˜ ë°ì´í„° ë‹¤ìš´ë¡œë“œ
                </button>
                <button class="btn btn-danger" onclick="clearAllSessions()">
                    ğŸ—‘ï¸ ëª¨ë“  ì„¸ì…˜ ì‚­ì œ
                </button>
            </div>
        </div>
    </div>

    <script>
        // rrweb ë…¹í™” ê´€ë ¨ ë³€ìˆ˜
        let currentRecording = null;
        let currentSessionId = null;
        let recordingStartTime = null;
        let recordingTimer = null;
        
        // ì„¸ì…˜ ì‹œì‘ í•¨ìˆ˜
        async function startScenario(scenarioType) {
            try {
                // ì´ì „ ë…¹í™”ê°€ ìˆë‹¤ë©´ ì¤‘ì§€
                if (currentRecording) {
                    currentRecording();
                    currentRecording = null;
                }
                
                // ìƒˆ ì„¸ì…˜ ì‹œì‘
                const response = await fetch('/api/session-replay/start-session', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        scenario: scenarioType,
                        userAgent: navigator.userAgent,
                        viewport: {
                            width: window.innerWidth,
                            height: window.innerHeight
                        }
                    })
                });
                
                const result = await response.json();
                if (result.success) {
                    currentSessionId = result.sessionId;
                    
                    // rrweb ê°€ìš©ì„± í™•ì¸ ë° í´ë°±
                    if (typeof rrweb !== 'undefined') {
                        console.log('âœ… rrweb ë¼ì´ë¸ŒëŸ¬ë¦¬ í™•ì¸ë¨:', rrweb);
                        
                        // rrweb ë…¹í™” ì‹œì‘
                        currentRecording = rrweb.record({
                            emit(event) {
                                console.log('ğŸ“¡ rrweb ì´ë²¤íŠ¸ ë°œìƒ:', event.type, event);
                                
                                // ì´ë²¤íŠ¸ë¥¼ ì„œë²„ë¡œ ì „ì†¡
                                fetch('/api/session-replay/add-event', {
                                    method: 'POST',
                                    headers: { 'Content-Type': 'application/json' },
                                    body: JSON.stringify({
                                        sessionId: currentSessionId,
                                        event: event
                                    })
                                }).then(response => {
                                    if (response.ok) {
                                        console.log('âœ… ì´ë²¤íŠ¸ ì „ì†¡ ì„±ê³µ');
                                    } else {
                                        console.error('âŒ ì´ë²¤íŠ¸ ì „ì†¡ ì‹¤íŒ¨:', response.status);
                                    }
                                }).catch(error => {
                                    console.error('âŒ ì´ë²¤íŠ¸ ì „ì†¡ ì˜¤ë¥˜:', error);
                                });
                            },
                            recordCanvas: true,
                            collectFonts: true,
                            plugins: []
                        });
                        
                        console.log('âœ… rrweb ë…¹í™” ì‹œì‘ë¨:', currentRecording);
                    } else {
                        console.warn('âš ï¸ rrwebë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê¸°ë³¸ ì´ë²¤íŠ¸ ìº¡ì²˜ë¡œ ëŒ€ì²´í•©ë‹ˆë‹¤.');
                        
                        // ê¸°ë³¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
                        currentRecording = setupBasicRecording(currentSessionId);
                        console.log('âœ… ê¸°ë³¸ ì´ë²¤íŠ¸ ë…¹í™” ì‹œì‘ë¨');
                    }
                    
                    // ë…¹í™” ìƒíƒœ í‘œì‹œ
                    showRecordingStatus(scenarioType);
                    updateSessionInfo(scenarioType, currentSessionId);
                    
                    console.log(`âœ… ì„¸ì…˜ ë…¹í™” ì‹œì‘: ${scenarioType} (${currentSessionId})`);
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                console.error('ì„¸ì…˜ ì‹œì‘ ì‹¤íŒ¨:', error);
                alert('ì„¸ì…˜ì„ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + error.message);
            }
        }
        
        // ì„¸ì…˜ ì™„ë£Œ í•¨ìˆ˜
        async function completeScenario(scenarioType) {
            if (!currentSessionId) {
                alert('ì§„í–‰ ì¤‘ì¸ ì„¸ì…˜ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            try {
                // ë…¹í™” ì¤‘ì§€
                if (currentRecording) {
                    currentRecording();
                    currentRecording = null;
                }
                
                // ì„¸ì…˜ ì¢…ë£Œ
                const response = await fetch('/api/session-replay/end-session', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        sessionId: currentSessionId,
                        endReason: 'user_completed'
                    })
                });
                
                const result = await response.json();
                if (result.success) {
                    hideRecordingStatus();
                    updateSessionResults(result.session);
                    
                    console.log(`âœ… ì„¸ì…˜ ì™„ë£Œ: ${scenarioType} (${currentSessionId})`);
                    currentSessionId = null;
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                console.error('ì„¸ì…˜ ì™„ë£Œ ì‹¤íŒ¨:', error);
                alert('ì„¸ì…˜ì„ ì™„ë£Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + error.message);
            }
        }
        
        // ë…¹í™” ìƒíƒœ í‘œì‹œ
        function showRecordingStatus(scenarioType) {
            const status = document.getElementById('recordingStatus');
            status.classList.add('active');
            
            recordingStartTime = Date.now();
            recordingTimer = setInterval(() => {
                const elapsed = Math.floor((Date.now() - recordingStartTime) / 1000);
                const minutes = Math.floor(elapsed / 60).toString().padStart(2, '0');
                const seconds = (elapsed % 60).toString().padStart(2, '0');
                document.getElementById('recordingTime').textContent = `${minutes}:${seconds}`;
            }, 1000);
        }
        
        // ë…¹í™” ìƒíƒœ ìˆ¨ê¸°ê¸°
        function hideRecordingStatus() {
            document.getElementById('recordingStatus').classList.remove('active');
            if (recordingTimer) {
                clearInterval(recordingTimer);
                recordingTimer = null;
            }
        }
        
        // ì„¸ì…˜ ì •ë³´ ì—…ë°ì´íŠ¸
        function updateSessionInfo(scenarioType, sessionId) {
            const results = document.getElementById('sessionResults');
            results.innerHTML = `
                <div class="session-info">
                    <h4>í˜„ì¬ ì§„í–‰ ì¤‘ì¸ ì„¸ì…˜</h4>
                    <p><strong>ì‹œë‚˜ë¦¬ì˜¤:</strong> ${getScenarioName(scenarioType)}</p>
                    <p><strong>ì„¸ì…˜ ID:</strong> ${sessionId}</p>
                    <p><strong>ì‹œì‘ ì‹œê°„:</strong> ${new Date().toLocaleString()}</p>
                    <p><strong>ìƒíƒœ:</strong> ğŸ”´ ë…¹í™” ì¤‘</p>
                </div>
            `;
        }
        
        // ì„¸ì…˜ ê²°ê³¼ ì—…ë°ì´íŠ¸
        function updateSessionResults(session) {
            const results = document.getElementById('sessionResults');
            results.innerHTML = `
                <div class="session-info">
                    <h4>ì™„ë£Œëœ ì„¸ì…˜</h4>
                    <p><strong>ì‹œë‚˜ë¦¬ì˜¤:</strong> ${getScenarioName(session.scenario)}</p>
                    <p><strong>ì„¸ì…˜ ID:</strong> ${session.id}</p>
                    <p><strong>ì‹œì‘ ì‹œê°„:</strong> ${new Date(session.startTime).toLocaleString()}</p>
                    <p><strong>ì¢…ë£Œ ì‹œê°„:</strong> ${new Date(session.endTime).toLocaleString()}</p>
                    <p><strong>ì†Œìš” ì‹œê°„:</strong> ${Math.floor(session.duration / 1000)}ì´ˆ</p>
                    <p><strong>ì´ë²¤íŠ¸ ìˆ˜:</strong> ${session.events.length}ê°œ</p>
                    <p><strong>ìƒíƒœ:</strong> âœ… ì™„ë£Œ</p>
                </div>
            `;
        }
        
        // ì‹œë‚˜ë¦¬ì˜¤ ì´ë¦„ ë°˜í™˜
        function getScenarioName(type) {
            const names = {
                'ecommerce_checkout': 'ğŸ›’ E-commerce ê²°ì œ í”Œë¡œìš°',
                'saas_dashboard': 'ğŸ“Š SaaS ëŒ€ì‹œë³´ë“œ ìƒí˜¸ì‘ìš©',
                'form_validation': 'ğŸ“ í¼ ê²€ì¦ ë° ì‚¬ìš©ì í”¼ë“œë°±',
                'mobile_responsive': 'ğŸ“± ëª¨ë°”ì¼ ë°˜ì‘í˜• ìƒí˜¸ì‘ìš©'
            };
            return names[type] || type;
        }
        
        // ë…¹í™”ëœ ì„¸ì…˜ ë³´ê¸°
        function viewRecordedSession() {
            if (!currentSessionId) {
                alert('ì§„í–‰ ì¤‘ì¸ ì„¸ì…˜ì´ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì™„ë£Œí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            window.open(`/real-replay-player?session=${currentSessionId}`, '_blank');
        }
        
        // ì‹œë‚˜ë¦¬ì˜¤ë³„ ìƒí˜¸ì‘ìš© í•¨ìˆ˜ë“¤
        
        // ê²°ì œ ì²˜ë¦¬
        function processPayment() {
            const cardNumber = document.getElementById('cardNumber').value;
            const expiryDate = document.getElementById('expiryDate').value;
            const cvv = document.getElementById('cvv').value;
            
            // ê²°ì œ ì˜¤ë¥˜ ì‹œë®¬ë ˆì´ì…˜
            if (!cardNumber || !expiryDate || !cvv) {
                document.getElementById('paymentError').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('paymentError').style.display = 'none';
                }, 3000);
            } else {
                alert('ê²°ì œê°€ ì„±ê³µì ìœ¼ë¡œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ’³âœ…');
            }
        }
        
        // ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë“œ
        function loadDashboardData() {
            document.getElementById('loadingStatus').textContent = 'ë°ì´í„° ë¡œë”© ì¤‘...';
            document.getElementById('chartProgress').style.width = '0%';
            
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 20;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);
                    document.getElementById('loadingStatus').textContent = 'ë¡œë”© ì™„ë£Œ!';
                }
                document.getElementById('chartProgress').style.width = progress + '%';
            }, 300);
        }
        
        // ëŠë¦° ì°¨íŠ¸ ë¡œë”© ì‹œë®¬ë ˆì´ì…˜
        function simulateSlowChart() {
            document.getElementById('loadingStatus').textContent = 'ëŠë¦° ì°¨íŠ¸ ë¡œë”© ì¤‘... ğŸŒ';
            document.getElementById('chartProgress').style.width = '0%';
            
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 5; // ë§¤ìš° ì²œì²œíˆ
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);
                    document.getElementById('loadingStatus').textContent = 'ë¡œë”© ì™„ë£Œ (ëŠë¦¼ ê°ì§€ë¨)';
                }
                document.getElementById('chartProgress').style.width = progress + '%';
            }, 800);
        }
        
        // í¼ ê²€ì¦ í•¨ìˆ˜ë“¤
        function validateUsername(input) {
            const error = document.getElementById('usernameError');
            if (input.value.length < 3) {
                error.textContent = 'ì‚¬ìš©ìëª…ì€ 3ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.';
                error.style.color = '#dc3545';
                input.style.borderColor = '#dc3545';
            } else {
                error.textContent = 'âœ… ì‚¬ìš© ê°€ëŠ¥í•œ ì‚¬ìš©ìëª…ì…ë‹ˆë‹¤.';
                error.style.color = '#28a745';
                input.style.borderColor = '#28a745';
            }
        }
        
        function validateEmail(input) {
            const error = document.getElementById('emailError');
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(input.value)) {
                error.textContent = 'ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.';
                error.style.color = '#dc3545';
                input.style.borderColor = '#dc3545';
            } else {
                error.textContent = 'âœ… ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì…ë‹ˆë‹¤.';
                error.style.color = '#28a745';
                input.style.borderColor = '#28a745';
            }
        }
        
        function validatePassword(input) {
            const error = document.getElementById('passwordError');
            const hasSpecial = /[!@#$%^&*(),.?":{}|<>]/.test(input.value);
            if (input.value.length < 8 || !hasSpecial) {
                error.textContent = '8ì ì´ìƒ, íŠ¹ìˆ˜ë¬¸ìë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.';
                error.style.color = '#dc3545';
                input.style.borderColor = '#dc3545';
            } else {
                error.textContent = 'âœ… ê°•ë ¥í•œ ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤.';
                error.style.color = '#28a745';
                input.style.borderColor = '#28a745';
            }
        }
        
        function triggerValidationErrors() {
            // ê°•ì œë¡œ ëª¨ë“  í•„ë“œì— ì˜¤ë¥˜ í‘œì‹œ
            const inputs = ['username', 'email', 'password'];
            inputs.forEach(id => {
                const input = document.getElementById(id);
                input.value = '';
                input.dispatchEvent(new Event('change'));
            });
        }
        
        function submitRegistration() {
            alert('ì‚¬ìš©ì ë“±ë¡ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‘¤âœ…');
        }
        
        // ëª¨ë°”ì¼ ë·° í† ê¸€
        function toggleMobileView() {
            const content = document.getElementById('responsiveContent');
            const mobileMenu = content.querySelector('.mobile-menu');
            const cardsGrid = content.querySelector('.cards-grid');
            
            if (mobileMenu.style.display === 'none') {
                mobileMenu.style.display = 'block';
                cardsGrid.style.gridTemplateColumns = '1fr';
                content.style.maxWidth = '400px';
                content.style.margin = '0 auto';
            } else {
                mobileMenu.style.display = 'none';
                cardsGrid.style.gridTemplateColumns = 'repeat(auto-fit, minmax(200px, 1fr))';
                content.style.maxWidth = '';
                content.style.margin = '';
            }
        }
        
        function selectCard(cardNumber) {
            alert(`ì¹´ë“œ ${cardNumber} ì„ íƒë¨! ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.`);
        }
        
        // ì„¸ì…˜ ë°ì´í„° ë‹¤ìš´ë¡œë“œ
        async function downloadSessionData() {
            if (!currentSessionId) {
                alert('ë‹¤ìš´ë¡œë“œí•  ì„¸ì…˜ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            try {
                const response = await fetch(`/api/session-replay/session/${currentSessionId}`);
                const data = await response.json();
                
                if (data.success) {
                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `session_${currentSessionId}.json`;
                    a.click();
                    URL.revokeObjectURL(url);
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                console.error('ì„¸ì…˜ ë°ì´í„° ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨:', error);
                alert('ì„¸ì…˜ ë°ì´í„°ë¥¼ ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + error.message);
            }
        }
        
        // ëª¨ë“  ì„¸ì…˜ ì‚­ì œ
        async function clearAllSessions() {
            if (confirm('ëª¨ë“  ì„¸ì…˜ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                try {
                    const response = await fetch('/api/session-replay/clear-all', { method: 'DELETE' });
                    const result = await response.json();
                    
                    if (result.success) {
                        alert('ëª¨ë“  ì„¸ì…˜ ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                        document.getElementById('sessionResults').innerHTML = '<p>ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì‹œì‘í•˜ë©´ ì„¸ì…˜ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>';
                    } else {
                        throw new Error(result.error);
                    }
                } catch (error) {
                    console.error('ì„¸ì…˜ ì‚­ì œ ì‹¤íŒ¨:', error);
                    alert('ì„¸ì…˜ì„ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + error.message);
                }
            }
        }
        
        // ê¸°ë³¸ ì´ë²¤íŠ¸ ìº¡ì²˜ ì‹œìŠ¤í…œ (rrweb í´ë°±)
        function setupBasicRecording(sessionId) {
            let eventCount = 0;
            const startTime = Date.now();
            
            // í˜ì´ì§€ ë¡œë“œ ì´ë²¤íŠ¸
            addBasicEvent(sessionId, {
                type: 'page_load',
                timestamp: Date.now() - startTime,
                url: window.location.href,
                title: document.title,
                viewport: {
                    width: window.innerWidth,
                    height: window.innerHeight
                }
            });
            
            // í´ë¦­ ì´ë²¤íŠ¸
            const clickHandler = (e) => {
                const rect = e.target.getBoundingClientRect();
                addBasicEvent(sessionId, {
                    type: 'click',
                    timestamp: Date.now() - startTime,
                    x: e.clientX,
                    y: e.clientY,
                    element: {
                        tagName: e.target.tagName,
                        id: e.target.id,
                        className: e.target.className,
                        textContent: e.target.textContent?.slice(0, 50)
                    },
                    boundingRect: {
                        left: rect.left,
                        top: rect.top,
                        width: rect.width,
                        height: rect.height
                    }
                });
            };
            
            // ì…ë ¥ ì´ë²¤íŠ¸
            const inputHandler = (e) => {
                if (e.target.type === 'password') return; // ë¹„ë°€ë²ˆí˜¸ëŠ” ê¸°ë¡í•˜ì§€ ì•ŠìŒ
                
                addBasicEvent(sessionId, {
                    type: 'input',
                    timestamp: Date.now() - startTime,
                    element: {
                        tagName: e.target.tagName,
                        id: e.target.id,
                        type: e.target.type
                    },
                    value: e.target.value.replace(/./g, '*'), // ì…ë ¥ê°’ ë§ˆìŠ¤í‚¹
                    valueLength: e.target.value.length
                });
            };
            
            // ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸
            const scrollHandler = () => {
                addBasicEvent(sessionId, {
                    type: 'scroll',
                    timestamp: Date.now() - startTime,
                    scrollX: window.scrollX,
                    scrollY: window.scrollY
                });
            };
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
            document.addEventListener('click', clickHandler);
            document.addEventListener('input', inputHandler);
            document.addEventListener('change', inputHandler);
            window.addEventListener('scroll', scrollHandler);
            
            // ì •ë¦¬ í•¨ìˆ˜ ë°˜í™˜
            return function cleanup() {
                document.removeEventListener('click', clickHandler);
                document.removeEventListener('input', inputHandler);
                document.removeEventListener('change', inputHandler);
                window.removeEventListener('scroll', scrollHandler);
            };
        }
        
        // ê¸°ë³¸ ì´ë²¤íŠ¸ ì „ì†¡ í•¨ìˆ˜
        function addBasicEvent(sessionId, event) {
            fetch('/api/session-replay/add-event', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    sessionId: sessionId,
                    ...event
                })
            }).then(response => {
                if (response.ok) {
                    console.log('âœ… ê¸°ë³¸ ì´ë²¤íŠ¸ ì „ì†¡ ì„±ê³µ:', event.type);
                } else {
                    console.error('âŒ ê¸°ë³¸ ì´ë²¤íŠ¸ ì „ì†¡ ì‹¤íŒ¨:', response.status);
                }
            }).catch(error => {
                console.error('âŒ ê¸°ë³¸ ì´ë²¤íŠ¸ ì „ì†¡ ì˜¤ë¥˜:', error);
            });
        }
        
        // í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ í˜„ì¬ ì„¸ì…˜ ìë™ ì™„ë£Œ
        window.addEventListener('beforeunload', () => {
            if (currentSessionId && currentRecording) {
                navigator.sendBeacon('/api/session-replay/end-session', JSON.stringify({
                    sessionId: currentSessionId,
                    endReason: 'page_unload'
                }));
            }
        });
    </script>
</body>
</html>