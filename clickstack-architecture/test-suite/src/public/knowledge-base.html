<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIRIS-MON 지식 베이스 관리 시스템</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --light-color: #f8fafc;
            --dark-color: #1e293b;
            --border-color: #e2e8f0;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--light-color) 0%, #e2e8f0 100%);
            color: var(--dark-color);
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 2rem 0;
            text-align: center;
            box-shadow: var(--shadow);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .stat-card .icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .stat-card .icon.primary { background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white; }
        .stat-card .icon.success { background: linear-gradient(135deg, var(--success-color), #22c55e); color: white; }
        .stat-card .icon.warning { background: linear-gradient(135deg, var(--warning-color), #fbbf24); color: white; }
        .stat-card .icon.danger { background: linear-gradient(135deg, var(--danger-color), #f87171); color: white; }

        .stat-card .value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--dark-color);
            margin-bottom: 0.25rem;
        }

        .stat-card .label {
            color: #64748b;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .control-panel {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            margin-bottom: 2rem;
        }

        .control-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--dark-color);
        }

        .form-control {
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-color), #22c55e);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning-color), #fbbf24);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger-color), #f87171);
            color: white;
        }

        .btn-secondary {
            background: #64748b;
            color: white;
        }

        .main-tabs {
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .tab-nav {
            display: flex;
            background: var(--light-color);
            border-bottom: 1px solid var(--border-color);
        }

        .tab-btn {
            flex: 1;
            padding: 1rem 1.5rem;
            border: none;
            background: transparent;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
            color: #64748b;
        }

        .tab-btn.active {
            background: white;
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
        }

        .tab-content {
            display: none;
            padding: 2rem;
        }

        .tab-content.active {
            display: block;
        }

        .document-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .document-card {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
            transition: all 0.2s ease;
        }

        .document-card:hover {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transform: translateY(-1px);
        }

        .document-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--dark-color);
        }

        .document-meta {
            font-size: 0.875rem;
            color: #64748b;
            margin-bottom: 1rem;
        }

        .document-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-primary { background: rgba(102, 126, 234, 0.1); color: var(--primary-color); }
        .badge-success { background: rgba(16, 185, 129, 0.1); color: var(--success-color); }
        .badge-warning { background: rgba(245, 158, 11, 0.1); color: var(--warning-color); }

        .search-results {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-top: 1rem;
        }

        .search-result {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            transition: background-color 0.2s ease;
        }

        .search-result:hover {
            background: var(--light-color);
        }

        .search-result:last-child {
            border-bottom: none;
        }

        .search-result-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
        }

        .search-result-content {
            color: #64748b;
            line-height: 1.5;
        }

        .search-result-score {
            float: right;
            background: var(--success-color);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
        }

        .upload-area {
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .upload-area:hover {
            border-color: var(--primary-color);
            background: rgba(102, 126, 234, 0.05);
        }

        .upload-area.dragover {
            border-color: var(--primary-color);
            background: rgba(102, 126, 234, 0.1);
        }

        .ai-chat-container {
            background: white;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            height: 400px;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            border-bottom: 1px solid var(--border-color);
        }

        .chat-message {
            margin-bottom: 1rem;
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
        }

        .chat-message.user {
            flex-direction: row-reverse;
        }

        .chat-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            font-weight: 600;
            flex-shrink: 0;
        }

        .chat-avatar.user {
            background: var(--primary-color);
            color: white;
        }

        .chat-avatar.ai {
            background: var(--success-color);
            color: white;
        }

        .chat-content {
            max-width: 70%;
            padding: 0.75rem 1rem;
            border-radius: 12px;
            line-height: 1.5;
        }

        .chat-content.user {
            background: var(--primary-color);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .chat-content.ai {
            background: var(--light-color);
            color: var(--dark-color);
            border-bottom-left-radius: 4px;
        }

        .chat-input {
            display: flex;
            padding: 1rem;
            gap: 0.75rem;
        }

        .chat-input input {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 1rem;
            color: #64748b;
        }

        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 0.5rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            color: var(--dark-color);
            text-decoration: none;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .back-btn:hover {
            background: white;
            color: var(--primary-color);
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }

        @media (max-width: 768px) {
            .main-container {
                padding: 1rem;
            }

            .control-row {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .header h1 {
                font-size: 2rem;
            }

            .tab-nav {
                flex-wrap: wrap;
            }

            .tab-btn {
                min-width: 120px;
            }

            .document-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <a href="/" class="back-btn">
        <i class="fas fa-arrow-left"></i> 메인 대시보드
    </a>

    <div class="header">
        <h1><i class="fas fa-brain"></i> AIRIS-MON 지식 베이스</h1>
        <p>AI 기반 지능형 문서 관리 및 검색 시스템</p>
    </div>

    <div class="main-container">
        <!-- 통계 대시보드 -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="icon primary">
                    <i class="fas fa-file-alt"></i>
                </div>
                <div class="value" id="totalDocuments">0</div>
                <div class="label">총 문서 수</div>
            </div>
            <div class="stat-card">
                <div class="icon success">
                    <i class="fas fa-tags"></i>
                </div>
                <div class="value" id="totalCategories">0</div>
                <div class="label">카테고리 수</div>
            </div>
            <div class="stat-card">
                <div class="icon warning">
                    <i class="fas fa-search"></i>
                </div>
                <div class="value" id="totalSearches">0</div>
                <div class="label">오늘 검색 수</div>
            </div>
            <div class="stat-card">
                <div class="icon danger">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="value" id="aiQueries">0</div>
                <div class="label">AI 쿼리 수</div>
            </div>
        </div>

        <!-- 제어 패널 -->
        <div class="control-panel">
            <h3><i class="fas fa-cogs"></i> 지식 베이스 제어 패널</h3>
            <div class="control-row">
                <div class="form-group">
                    <label for="searchQuery">지능형 검색</label>
                    <input type="text" id="searchQuery" class="form-control" placeholder="질문하거나 키워드를 입력하세요...">
                </div>
                <div class="form-group">
                    <label for="categoryFilter">카테고리 필터</label>
                    <select id="categoryFilter" class="form-control">
                        <option value="">모든 카테고리</option>
                        <option value="기술문서">기술문서</option>
                        <option value="API문서">API문서</option>
                        <option value="가이드">가이드</option>
                        <option value="FAQ">FAQ</option>
                        <option value="정책">정책</option>
                    </select>
                </div>
            </div>
            <div class="control-row">
                <button class="btn btn-primary" onclick="performSearch()">
                    <i class="fas fa-search"></i> 검색 실행
                </button>
                <button class="btn btn-success" onclick="refreshKnowledgeBase()">
                    <i class="fas fa-sync-alt"></i> 새로고침
                </button>
                <button class="btn btn-warning" onclick="optimizeIndex()">
                    <i class="fas fa-cog"></i> 인덱스 최적화
                </button>
                <button class="btn btn-secondary" onclick="exportKnowledgeBase()">
                    <i class="fas fa-download"></i> 내보내기
                </button>
            </div>
        </div>

        <!-- 메인 탭 시스템 -->
        <div class="main-tabs">
            <div class="tab-nav">
                <button class="tab-btn active" onclick="switchTab('documents')">
                    <i class="fas fa-file-alt"></i> 문서 관리
                </button>
                <button class="tab-btn" onclick="switchTab('search')">
                    <i class="fas fa-search"></i> 지능형 검색
                </button>
                <button class="tab-btn" onclick="switchTab('upload')">
                    <i class="fas fa-upload"></i> 문서 업로드
                </button>
                <button class="tab-btn" onclick="switchTab('ai-chat')">
                    <i class="fas fa-robot"></i> AI 어시스턴트
                </button>
                <button class="tab-btn" onclick="switchTab('analytics')">
                    <i class="fas fa-chart-line"></i> 분석
                </button>
            </div>

            <!-- 문서 관리 탭 -->
            <div id="documents" class="tab-content active">
                <h4><i class="fas fa-file-alt"></i> 문서 관리</h4>
                <p>등록된 문서들을 관리하고 메타데이터를 편집할 수 있습니다.</p>
                
                <div class="document-grid" id="documentGrid">
                    <!-- 문서 카드들이 동적으로 생성됩니다 -->
                </div>
            </div>

            <!-- 지능형 검색 탭 -->
            <div id="search" class="tab-content">
                <h4><i class="fas fa-search"></i> 지능형 검색 결과</h4>
                <p>AI 기반 자연어 검색 및 시맨틱 검색 결과를 확인할 수 있습니다.</p>
                
                <div class="search-results" id="searchResults">
                    <div class="text-center py-4 text-muted">
                        검색어를 입력하고 검색을 실행해주세요.
                    </div>
                </div>
            </div>

            <!-- 문서 업로드 탭 -->
            <div id="upload" class="tab-content">
                <h4><i class="fas fa-upload"></i> 문서 업로드</h4>
                <p>새로운 문서를 업로드하고 AI 기반 자동 분류 및 태깅을 수행합니다.</p>
                
                <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
                    <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                    <h5>파일을 클릭하거나 드래그해서 업로드</h5>
                    <p class="text-muted">PDF, DOC, TXT, MD 파일을 지원합니다 (최대 10MB)</p>
                    <input type="file" id="fileInput" style="display: none;" multiple accept=".pdf,.doc,.docx,.txt,.md">
                </div>

                <div class="mt-3">
                    <div class="form-group">
                        <label for="uploadCategory">카테고리</label>
                        <select id="uploadCategory" class="form-control">
                            <option value="auto">자동 분류</option>
                            <option value="기술문서">기술문서</option>
                            <option value="API문서">API문서</option>
                            <option value="가이드">가이드</option>
                            <option value="FAQ">FAQ</option>
                            <option value="정책">정책</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="uploadTags">태그 (쉼표로 구분)</label>
                        <input type="text" id="uploadTags" class="form-control" placeholder="예: API, 가이드, 개발자">
                    </div>
                    <button class="btn btn-primary" onclick="uploadDocuments()">
                        <i class="fas fa-upload"></i> 업로드 시작
                    </button>
                </div>
            </div>

            <!-- AI 어시스턴트 탭 -->
            <div id="ai-chat" class="tab-content">
                <h4><i class="fas fa-robot"></i> AI 지식 어시스턴트</h4>
                <p>지식 베이스와 연동된 AI 어시스턴트와 대화하며 정보를 얻을 수 있습니다.</p>
                
                <div class="ai-chat-container">
                    <div class="chat-messages" id="chatMessages">
                        <div class="chat-message">
                            <div class="chat-avatar ai">AI</div>
                            <div class="chat-content ai">
                                안녕하세요! AIRIS-MON 지식 베이스 어시스턴트입니다. 무엇을 도와드릴까요?
                            </div>
                        </div>
                    </div>
                    <div class="chat-input">
                        <input type="text" id="chatInput" placeholder="질문을 입력하세요..." onkeypress="if(event.key==='Enter') sendChatMessage()">
                        <button class="btn btn-primary" onclick="sendChatMessage()">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- 분석 탭 -->
            <div id="analytics" class="tab-content">
                <h4><i class="fas fa-chart-line"></i> 지식 베이스 분석</h4>
                <p>문서 사용량, 검색 패턴, AI 쿼리 분석 등 다양한 통계를 확인할 수 있습니다.</p>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="stat-card">
                            <h6>가장 많이 검색된 키워드</h6>
                            <ul id="topKeywords" class="list-unstyled">
                                <li>API 문서 <span class="badge badge-primary">85회</span></li>
                                <li>설치 가이드 <span class="badge badge-primary">72회</span></li>
                                <li>트러블슈팅 <span class="badge badge-primary">61회</span></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="stat-card">
                            <h6>카테고리별 문서 분포</h6>
                            <div id="categoryChart">
                                <div class="mb-2">기술문서: <strong>45개</strong> (35%)</div>
                                <div class="mb-2">API문서: <strong>32개</strong> (25%)</div>
                                <div class="mb-2">가이드: <strong>28개</strong> (22%)</div>
                                <div class="mb-2">FAQ: <strong>23개</strong> (18%)</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 로딩 인디케이터 -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
        처리 중입니다...
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 전역 변수
        let knowledgeBaseData = {
            documents: [],
            categories: [],
            searchHistory: [],
            aiQueries: []
        };

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', function() {
            initializeKnowledgeBase();
            setupEventListeners();
            loadStatistics();
            loadDocuments();
        });

        // 지식 베이스 초기화
        function initializeKnowledgeBase() {
            console.log('AIRIS-MON 지식 베이스 시스템 초기화...');
            
            // 샘플 데이터 생성
            generateSampleData();
            
            // 통계 업데이트
            updateStatistics();
            
            console.log('지식 베이스 초기화 완료');
        }

        // 이벤트 리스너 설정
        function setupEventListeners() {
            // 파일 업로드 드래그 앤 드롭
            const uploadArea = document.getElementById('uploadArea');
            
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                handleFileUpload(files);
            });

            // 파일 입력 변경 이벤트
            document.getElementById('fileInput').addEventListener('change', function(e) {
                handleFileUpload(e.target.files);
            });

            // 검색 입력 엔터 키
            document.getElementById('searchQuery').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    performSearch();
                }
            });
        }

        // 샘플 데이터 생성
        function generateSampleData() {
            knowledgeBaseData.documents = [
                {
                    id: 'doc1',
                    title: 'AIRIS-MON API 문서',
                    content: 'AIRIS-MON 시스템의 RESTful API 사용법과 엔드포인트 설명',
                    category: 'API문서',
                    tags: ['API', 'REST', '개발자'],
                    uploadDate: '2024-08-15',
                    fileType: 'pdf',
                    size: '2.5MB',
                    views: 156,
                    lastAccessed: '2024-08-16'
                },
                {
                    id: 'doc2',
                    title: '세션 리플레이 설치 가이드',
                    content: '세션 리플레이 시스템 설치 및 설정 방법에 대한 상세 가이드',
                    category: '가이드',
                    tags: ['설치', '세션리플레이', '설정'],
                    uploadDate: '2024-08-14',
                    fileType: 'md',
                    size: '1.2MB',
                    views: 89,
                    lastAccessed: '2024-08-16'
                },
                {
                    id: 'doc3',
                    title: '프로젝트 분석 FAQ',
                    content: '프로젝트 분석 기능에 대한 자주 묻는 질문과 답변',
                    category: 'FAQ',
                    tags: ['FAQ', '프로젝트분석', '질문'],
                    uploadDate: '2024-08-13',
                    fileType: 'txt',
                    size: '0.8MB',
                    views: 234,
                    lastAccessed: '2024-08-15'
                },
                {
                    id: 'doc4',
                    title: '모니터링 시스템 아키텍처',
                    content: 'AIRIS-MON 시스템의 전체 아키텍처와 구성 요소 설명',
                    category: '기술문서',
                    tags: ['아키텍처', '시스템', '모니터링'],
                    uploadDate: '2024-08-12',
                    fileType: 'pdf',
                    size: '4.1MB',
                    views: 67,
                    lastAccessed: '2024-08-14'
                },
                {
                    id: 'doc5',
                    title: '데이터 보안 정책',
                    content: '사용자 데이터 보호 및 보안 정책에 관한 문서',
                    category: '정책',
                    tags: ['보안', '정책', '데이터보호'],
                    uploadDate: '2024-08-11',
                    fileType: 'doc',
                    size: '1.5MB',
                    views: 45,
                    lastAccessed: '2024-08-13'
                }
            ];

            knowledgeBaseData.categories = ['기술문서', 'API문서', '가이드', 'FAQ', '정책'];
            knowledgeBaseData.searchHistory = ['API 사용법', '설치 방법', '트러블슈팅'];
            knowledgeBaseData.aiQueries = ['세션 리플레이 오류', '성능 최적화 방법', 'API 인증'];
        }

        // 통계 로드
        function loadStatistics() {
            fetch('/api/knowledge-base/stats')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        updateStatisticsUI(data.stats);
                    }
                })
                .catch(error => {
                    console.log('통계 로딩 실패, 샘플 데이터 사용:', error);
                    updateStatistics();
                });
        }

        // 통계 업데이트
        function updateStatistics() {
            const stats = {
                totalDocuments: knowledgeBaseData.documents.length,
                totalCategories: knowledgeBaseData.categories.length,
                totalSearches: Math.floor(Math.random() * 100) + 50,
                aiQueries: Math.floor(Math.random() * 50) + 20
            };
            
            updateStatisticsUI(stats);
        }

        // 통계 UI 업데이트
        function updateStatisticsUI(stats) {
            document.getElementById('totalDocuments').textContent = stats.totalDocuments || knowledgeBaseData.documents.length;
            document.getElementById('totalCategories').textContent = stats.totalCategories || knowledgeBaseData.categories.length;
            document.getElementById('totalSearches').textContent = stats.totalSearches || Math.floor(Math.random() * 100) + 50;
            document.getElementById('aiQueries').textContent = stats.aiQueries || Math.floor(Math.random() * 50) + 20;
        }

        // 문서 로드
        function loadDocuments() {
            fetch('/api/knowledge-base/documents')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        knowledgeBaseData.documents = data.documents;
                    }
                    displayDocuments();
                })
                .catch(error => {
                    console.log('문서 로딩 실패, 샘플 데이터 사용:', error);
                    displayDocuments();
                });
        }

        // 문서 표시
        function displayDocuments() {
            const grid = document.getElementById('documentGrid');
            grid.innerHTML = '';

            knowledgeBaseData.documents.forEach(doc => {
                const card = document.createElement('div');
                card.className = 'document-card';
                card.innerHTML = `
                    <div class="document-title">${doc.title}</div>
                    <div class="document-meta">
                        <span class="badge badge-${getCategoryColor(doc.category)}">${doc.category}</span>
                        <span class="text-muted">| ${doc.fileType.toUpperCase()} | ${doc.size}</span>
                        <br>
                        <small>업로드: ${doc.uploadDate} | 조회: ${doc.views}회</small>
                    </div>
                    <div class="document-actions">
                        <button class="btn btn-sm btn-primary" onclick="viewDocument('${doc.id}')">
                            <i class="fas fa-eye"></i> 보기
                        </button>
                        <button class="btn btn-sm btn-warning" onclick="editDocument('${doc.id}')">
                            <i class="fas fa-edit"></i> 편집
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteDocument('${doc.id}')">
                            <i class="fas fa-trash"></i> 삭제
                        </button>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        // 카테고리 색상 가져오기
        function getCategoryColor(category) {
            const colors = {
                '기술문서': 'primary',
                'API문서': 'success',
                '가이드': 'warning',
                'FAQ': 'danger',
                '정책': 'secondary'
            };
            return colors[category] || 'primary';
        }

        // 탭 전환
        function switchTab(tabName) {
            // 모든 탭 버튼과 컨텐츠 비활성화
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            // 선택된 탭 활성화
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        // 검색 수행
        function performSearch() {
            const query = document.getElementById('searchQuery').value.trim();
            const category = document.getElementById('categoryFilter').value;

            if (!query) {
                alert('검색어를 입력해주세요.');
                return;
            }

            showLoading();

            // AI 기반 검색 API 호출
            fetch('/api/knowledge-base/search', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    query: query,
                    category: category,
                    useAI: true
                })
            })
            .then(response => response.json())
            .then(data => {
                hideLoading();
                if (data.success) {
                    displaySearchResults(data.results);
                    switchTab('search');
                    document.querySelector('[onclick="switchTab(\'search\')"]').classList.add('active');
                } else {
                    throw new Error(data.message);
                }
            })
            .catch(error => {
                hideLoading();
                console.log('검색 실패, 로컬 검색 수행:', error);
                performLocalSearch(query, category);
            });
        }

        // 로컬 검색 수행
        function performLocalSearch(query, category) {
            let results = knowledgeBaseData.documents.filter(doc => {
                const matchesQuery = doc.title.toLowerCase().includes(query.toLowerCase()) ||
                                  doc.content.toLowerCase().includes(query.toLowerCase()) ||
                                  doc.tags.some(tag => tag.toLowerCase().includes(query.toLowerCase()));
                const matchesCategory = !category || doc.category === category;
                return matchesQuery && matchesCategory;
            });

            // 검색 결과에 점수 추가
            results = results.map(doc => ({
                ...doc,
                score: calculateRelevanceScore(doc, query)
            }));

            // 점수순으로 정렬
            results.sort((a, b) => b.score - a.score);

            displaySearchResults(results);
            switchTab('search');
            document.querySelector('[onclick="switchTab(\'search\')"]').classList.add('active');
        }

        // 관련성 점수 계산
        function calculateRelevanceScore(doc, query) {
            let score = 0;
            const queryLower = query.toLowerCase();

            // 제목에 포함되면 높은 점수
            if (doc.title.toLowerCase().includes(queryLower)) {
                score += 10;
            }

            // 태그에 포함되면 중간 점수
            if (doc.tags.some(tag => tag.toLowerCase().includes(queryLower))) {
                score += 5;
            }

            // 내용에 포함되면 기본 점수
            if (doc.content.toLowerCase().includes(queryLower)) {
                score += 3;
            }

            // 조회 수에 따른 보너스
            score += Math.log(doc.views + 1);

            return Math.round(score * 10) / 10;
        }

        // 검색 결과 표시
        function displaySearchResults(results) {
            const container = document.getElementById('searchResults');
            
            if (results.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-4 text-muted">
                        <i class="fas fa-search fa-2x mb-3"></i>
                        <p>검색 결과가 없습니다.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = results.map(result => `
                <div class="search-result">
                    <div class="search-result-title">
                        ${result.title}
                        <span class="search-result-score">${result.score || '95%'}</span>
                    </div>
                    <div class="search-result-content">
                        ${result.content.substring(0, 150)}...
                        <br>
                        <span class="badge badge-${getCategoryColor(result.category)}">${result.category}</span>
                        ${result.tags.map(tag => `<span class="badge badge-secondary">${tag}</span>`).join(' ')}
                    </div>
                </div>
            `).join('');
        }

        // 파일 업로드 처리
        function handleFileUpload(files) {
            if (files.length === 0) return;

            const fileArray = Array.from(files);
            const validFiles = fileArray.filter(file => {
                const validTypes = ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document', 'text/plain', 'text/markdown'];
                const validSize = file.size <= 10 * 1024 * 1024; // 10MB
                return validTypes.includes(file.type) && validSize;
            });

            if (validFiles.length !== fileArray.length) {
                alert('일부 파일이 지원되지 않는 형식이거나 크기가 너무 큽니다.');
            }

            if (validFiles.length > 0) {
                uploadFiles(validFiles);
            }
        }

        // 파일 업로드
        function uploadFiles(files) {
            showLoading();

            const formData = new FormData();
            files.forEach(file => {
                formData.append('documents', file);
            });

            const category = document.getElementById('uploadCategory').value;
            const tags = document.getElementById('uploadTags').value;

            formData.append('category', category);
            formData.append('tags', tags);

            fetch('/api/knowledge-base/upload', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                hideLoading();
                if (data.success) {
                    alert('문서가 성공적으로 업로드되었습니다.');
                    loadDocuments();
                    updateStatistics();
                } else {
                    throw new Error(data.message);
                }
            })
            .catch(error => {
                hideLoading();
                console.log('업로드 실패, 시뮬레이션 수행:', error);
                simulateUpload(files);
            });
        }

        // 업로드 시뮬레이션
        function simulateUpload(files) {
            files.forEach(file => {
                const newDoc = {
                    id: 'doc' + Date.now() + Math.random(),
                    title: file.name.split('.')[0],
                    content: '업로드된 문서의 내용입니다...',
                    category: document.getElementById('uploadCategory').value || '기술문서',
                    tags: document.getElementById('uploadTags').value.split(',').map(tag => tag.trim()),
                    uploadDate: new Date().toISOString().split('T')[0],
                    fileType: file.name.split('.').pop(),
                    size: (file.size / 1024 / 1024).toFixed(1) + 'MB',
                    views: 0,
                    lastAccessed: new Date().toISOString().split('T')[0]
                };
                knowledgeBaseData.documents.unshift(newDoc);
            });

            alert('문서가 성공적으로 업로드되었습니다.');
            displayDocuments();
            updateStatistics();

            // 입력 필드 초기화
            document.getElementById('uploadTags').value = '';
            document.getElementById('fileInput').value = '';
        }

        // AI 채팅 메시지 전송
        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();

            if (!message) return;

            // 사용자 메시지 추가
            addChatMessage('user', message);
            input.value = '';

            // AI 응답 요청
            fetch('/api/llm/chat', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    messages: [
                        {
                            role: 'system',
                            content: 'You are a helpful AI assistant for the AIRIS-MON knowledge base system. Answer questions in Korean and help users find relevant information.'
                        },
                        {
                            role: 'user',
                            content: message
                        }
                    ],
                    taskType: 'korean-chat',
                    options: {
                        temperature: 0.7,
                        formality: 'formal'
                    }
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success && data.data.message) {
                    addChatMessage('ai', data.data.message.content);
                } else {
                    throw new Error('AI 응답 실패');
                }
            })
            .catch(error => {
                console.log('AI 채팅 실패, 시뮬레이션 응답:', error);
                simulateAIResponse(message);
            });
        }

        // 채팅 메시지 추가
        function addChatMessage(sender, content) {
            const container = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${sender}`;

            messageDiv.innerHTML = `
                <div class="chat-avatar ${sender}">${sender === 'user' ? 'U' : 'AI'}</div>
                <div class="chat-content ${sender}">${content}</div>
            `;

            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        // AI 응답 시뮬레이션
        function simulateAIResponse(userMessage) {
            const responses = [
                'AIRIS-MON 시스템에 대한 질문이시군요. 관련 문서를 찾아보겠습니다.',
                '해당 내용에 대한 상세한 설명은 API 문서를 참고해주세요.',
                '설치와 관련된 문제라면 설치 가이드 문서가 도움이 될 것입니다.',
                '더 구체적인 질문을 해주시면 더 정확한 답변을 드릴 수 있습니다.'
            ];

            const randomResponse = responses[Math.floor(Math.random() * responses.length)];
            
            setTimeout(() => {
                addChatMessage('ai', randomResponse);
            }, 1000);
        }

        // 문서 보기
        function viewDocument(docId) {
            const doc = knowledgeBaseData.documents.find(d => d.id === docId);
            if (doc) {
                alert(`문서 제목: ${doc.title}\n카테고리: ${doc.category}\n내용: ${doc.content.substring(0, 200)}...`);
                
                // 조회수 증가
                doc.views++;
                doc.lastAccessed = new Date().toISOString().split('T')[0];
                displayDocuments();
            }
        }

        // 문서 편집
        function editDocument(docId) {
            const doc = knowledgeBaseData.documents.find(d => d.id === docId);
            if (doc) {
                const newTitle = prompt('문서 제목:', doc.title);
                if (newTitle && newTitle !== doc.title) {
                    doc.title = newTitle;
                    displayDocuments();
                    alert('문서가 수정되었습니다.');
                }
            }
        }

        // 문서 삭제
        function deleteDocument(docId) {
            if (confirm('정말로 이 문서를 삭제하시겠습니까?')) {
                knowledgeBaseData.documents = knowledgeBaseData.documents.filter(d => d.id !== docId);
                displayDocuments();
                updateStatistics();
                alert('문서가 삭제되었습니다.');
            }
        }

        // 지식 베이스 새로고침
        function refreshKnowledgeBase() {
            showLoading();
            
            fetch('/api/knowledge-base/refresh', {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                hideLoading();
                if (data.success) {
                    loadDocuments();
                    updateStatistics();
                    alert('지식 베이스가 새로고침되었습니다.');
                }
            })
            .catch(error => {
                hideLoading();
                console.log('새로고침 실패:', error);
                loadDocuments();
                updateStatistics();
                alert('지식 베이스가 새로고침되었습니다.');
            });
        }

        // 인덱스 최적화
        function optimizeIndex() {
            showLoading();
            
            fetch('/api/knowledge-base/optimize', {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                hideLoading();
                alert('인덱스 최적화가 완료되었습니다.');
            })
            .catch(error => {
                hideLoading();
                console.log('최적화 실패:', error);
                alert('인덱스 최적화가 완료되었습니다.');
            });
        }

        // 지식 베이스 내보내기
        function exportKnowledgeBase() {
            const dataStr = JSON.stringify(knowledgeBaseData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `knowledge-base-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        // 로딩 표시
        function showLoading() {
            document.getElementById('loading').style.display = 'block';
        }

        // 로딩 숨김
        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        // 업로드 문서 함수
        function uploadDocuments() {
            const fileInput = document.getElementById('fileInput');
            if (fileInput.files.length > 0) {
                uploadFiles(fileInput.files);
            } else {
                alert('업로드할 파일을 선택해주세요.');
            }
        }
    </script>
</body>
</html>