<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹œìŠ¤í…œ ì„¤ì¹˜ ê´€ë¦¬ - AIRIS-MON</title>
    <script src="components/common-layout.js"></script>
    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-tertiary: #e9ecef;
            --border-color: #dee2e6;
            --text-primary: #212529;
            --text-secondary: #6c757d;
            --accent-blue: #0d6efd;
            --accent-green: #198754;
            --accent-yellow: #ffc107;
            --accent-red: #dc3545;
            --accent-purple: #6f42c1;
        }

        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
        }

        .installation-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            margin: 0 auto;
            max-width: 1400px;
            padding: 0 20px;
            background: var(--bg-primary);
        }

        .installation-header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .header-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0 0 10px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header-subtitle {
            color: var(--text-secondary);
            font-size: 14px;
            margin: 0;
        }

        .installation-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            flex: 1;
            margin-bottom: 20px;
        }

        .installation-panel {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .panel-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .panel-description {
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.5;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-label {
            font-weight: 500;
            color: var(--text-primary);
            font-size: 14px;
        }

        .form-input {
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 14px;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: border-color 0.2s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.1);
        }

        .form-select {
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 14px;
            background: var(--bg-primary);
            color: var(--text-primary);
            cursor: pointer;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 0;
        }

        .checkbox-input {
            width: 16px;
            height: 16px;
            accent-color: var(--accent-blue);
        }

        .system-requirements {
            background: var(--bg-tertiary);
            border-radius: 6px;
            padding: 15px;
            font-size: 13px;
        }

        .requirement-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .requirement-item:last-child {
            border-bottom: none;
        }

        .requirement-status {
            font-weight: 500;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
        }

        .status-pass {
            background: rgba(25, 135, 84, 0.1);
            color: var(--accent-green);
        }

        .status-fail {
            background: rgba(220, 53, 69, 0.1);
            color: var(--accent-red);
        }

        .status-warning {
            background: rgba(255, 193, 7, 0.1);
            color: var(--accent-yellow);
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: auto;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--accent-blue);
            color: white;
        }

        .btn-primary:hover {
            background: #0b5ed7;
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--border-color);
        }

        .btn-success {
            background: var(--accent-green);
            color: white;
        }

        .btn-success:hover {
            background: #157347;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .progress-container {
            margin-top: 20px;
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: var(--bg-tertiary);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
            width: 0%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: 500;
        }

        .log-output {
            background: #1a1a1a;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            padding: 15px;
            border-radius: 4px;
            height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
            border: 1px solid var(--border-color);
        }

        .installation-steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .step-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 15px;
            text-align: center;
            position: relative;
        }

        .step-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin: 0 auto 10px;
            font-size: 14px;
        }

        .step-number.active {
            background: var(--accent-blue);
            color: white;
        }

        .step-number.completed {
            background: var(--accent-green);
            color: white;
        }

        .step-title {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
            margin: 0;
        }

        .step-description {
            font-size: 11px;
            color: var(--text-secondary);
            margin: 5px 0 0 0;
        }

        @media (max-width: 768px) {
            .installation-grid {
                grid-template-columns: 1fr;
            }
            
            .installation-steps {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }

        .status-online {
            background: var(--accent-green);
            animation: pulse 2s infinite;
        }

        .status-offline {
            background: var(--accent-red);
        }

        .status-unknown {
            background: var(--text-secondary);
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .installation-summary {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }

        .summary-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0 0 15px 0;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .summary-item:last-child {
            border-bottom: none;
        }

        .summary-label {
            font-weight: 500;
            color: var(--text-primary);
        }

        .summary-value {
            color: var(--text-secondary);
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="installation-container">
        <!-- í—¤ë” -->
        <div class="installation-header">
            <h1 class="header-title">
                <span>ğŸ–¥ï¸</span>
                AIRIS-MON ì‹œìŠ¤í…œ ì„¤ì¹˜ ê´€ë¦¬
            </h1>
            <p class="header-subtitle">Linux ì„œë²„ í™˜ê²½ì—ì„œ AIRIS-MON í”Œë«í¼ì„ ìë™ìœ¼ë¡œ ì„¤ì¹˜í•˜ê³  êµ¬ì„±í•©ë‹ˆë‹¤</p>
        </div>

        <!-- ì„¤ì¹˜ ë‹¨ê³„ í‘œì‹œ -->
        <div class="installation-steps">
            <div class="step-card">
                <div class="step-number" id="step1">1</div>
                <div class="step-title">ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­ í™•ì¸</div>
                <div class="step-description">í•˜ë“œì›¨ì–´ ë° ì†Œí”„íŠ¸ì›¨ì–´ ê²€ì¦</div>
            </div>
            <div class="step-card">
                <div class="step-number" id="step2">2</div>
                <div class="step-title">ì˜ì¡´ì„± ì„¤ì¹˜</div>
                <div class="step-description">Node.js, Python, Git ì„¤ì¹˜</div>
            </div>
            <div class="step-card">
                <div class="step-number" id="step3">3</div>
                <div class="step-title">ì†ŒìŠ¤ ì½”ë“œ ë°°í¬</div>
                <div class="step-description">GitHubì—ì„œ ì½”ë“œ ë‹¤ìš´ë¡œë“œ</div>
            </div>
            <div class="step-card">
                <div class="step-number" id="step4">4</div>
                <div class="step-title">í™˜ê²½ êµ¬ì„±</div>
                <div class="step-description">ì„¤ì • íŒŒì¼ ë° ë°ì´í„°ë² ì´ìŠ¤</div>
            </div>
            <div class="step-card">
                <div class="step-number" id="step5">5</div>
                <div class="step-title">ì„œë¹„ìŠ¤ ë“±ë¡</div>
                <div class="step-description">systemd ì„œë¹„ìŠ¤ ìƒì„±</div>
            </div>
            <div class="step-card">
                <div class="step-number" id="step6">6</div>
                <div class="step-title">ì„¤ì¹˜ ì™„ë£Œ</div>
                <div class="step-description">ì„œë¹„ìŠ¤ ì‹œì‘ ë° ê²€ì¦</div>
            </div>
        </div>

        <!-- ë©”ì¸ ì„¤ì¹˜ íŒ¨ë„ -->
        <div class="installation-grid">
            <!-- ì™¼ìª½: ì„¤ì¹˜ ì„¤ì • -->
            <div class="installation-panel">
                <h2 class="panel-title">
                    <span>âš™ï¸</span>
                    ì„¤ì¹˜ ì„¤ì •
                </h2>
                <p class="panel-description">
                    AIRIS-MONì„ ì„¤ì¹˜í•  ì„œë²„ ì •ë³´ì™€ ì„¤ì¹˜ ì˜µì…˜ì„ ì„¤ì •í•˜ì„¸ìš”.
                </p>

                <div class="form-group">
                    <label class="form-label">ì„¤ì¹˜ ê²½ë¡œ</label>
                    <input type="text" class="form-input" id="installPath" value="/opt/airis-mon" placeholder="ì„¤ì¹˜í•  ë””ë ‰í† ë¦¬ ê²½ë¡œ">
                </div>

                <div class="form-group">
                    <label class="form-label">ì„œë¹„ìŠ¤ í¬íŠ¸</label>
                    <input type="number" class="form-input" id="servicePort" value="3100" placeholder="ì„œë¹„ìŠ¤ê°€ ì‚¬ìš©í•  í¬íŠ¸">
                </div>

                <div class="form-group">
                    <label class="form-label">ì‹¤í–‰ ì‚¬ìš©ì</label>
                    <input type="text" class="form-input" id="serviceUser" value="airis" placeholder="ì„œë¹„ìŠ¤ ì‹¤í–‰ ê³„ì •">
                </div>

                <div class="form-group">
                    <label class="form-label">Git Repository URL</label>
                    <input type="url" class="form-input" id="gitRepo" value="https://github.com/your-org/airis-mon.git" placeholder="ì†ŒìŠ¤ ì½”ë“œ ì €ì¥ì†Œ URL">
                </div>

                <div class="form-group">
                    <label class="form-label">ë¸Œëœì¹˜</label>
                    <select class="form-select" id="gitBranch">
                        <option value="main">main (ì•ˆì • ë²„ì „)</option>
                        <option value="develop">develop (ê°œë°œ ë²„ì „)</option>
                        <option value="release">release (ë¦´ë¦¬ìŠ¤ í›„ë³´)</option>
                    </select>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" class="checkbox-input" id="autoStart" checked>
                    <label class="form-label" for="autoStart">ì‹œìŠ¤í…œ ë¶€íŒ… ì‹œ ìë™ ì‹œì‘</label>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" class="checkbox-input" id="enableSsl">
                    <label class="form-label" for="enableSsl">SSL/TLS í™œì„±í™” (Let's Encrypt)</label>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" class="checkbox-input" id="installNginx">
                    <label class="form-label" for="installNginx">Nginx ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ ì„¤ì¹˜</label>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-secondary" onclick="checkRequirements()">
                        <span>ğŸ”</span>
                        ìš”êµ¬ì‚¬í•­ í™•ì¸
                    </button>
                    <button class="btn btn-primary" onclick="startInstallation()" id="installBtn">
                        <span>ğŸš€</span>
                        ì„¤ì¹˜ ì‹œì‘
                    </button>
                </div>
            </div>

            <!-- ì˜¤ë¥¸ìª½: ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­ ë° ìƒíƒœ -->
            <div class="installation-panel">
                <h2 class="panel-title">
                    <span>ğŸ“‹</span>
                    ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­
                </h2>
                <p class="panel-description">
                    í˜„ì¬ ì‹œìŠ¤í…œì´ AIRIS-MON ì„¤ì¹˜ ìš”êµ¬ì‚¬í•­ì„ ë§Œì¡±í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
                </p>

                <div class="system-requirements" id="systemRequirements">
                    <div class="requirement-item">
                        <span>ìš´ì˜ì²´ì œ</span>
                        <span class="requirement-status status-warning" id="osStatus">í™•ì¸ ì¤‘...</span>
                    </div>
                    <div class="requirement-item">
                        <span>ë©”ëª¨ë¦¬ (ìµœì†Œ 4GB)</span>
                        <span class="requirement-status status-warning" id="memoryStatus">í™•ì¸ ì¤‘...</span>
                    </div>
                    <div class="requirement-item">
                        <span>ë””ìŠ¤í¬ ê³µê°„ (ìµœì†Œ 10GB)</span>
                        <span class="requirement-status status-warning" id="diskStatus">í™•ì¸ ì¤‘...</span>
                    </div>
                    <div class="requirement-item">
                        <span>Node.js (v16+)</span>
                        <span class="requirement-status status-warning" id="nodeStatus">í™•ì¸ ì¤‘...</span>
                    </div>
                    <div class="requirement-item">
                        <span>Python (v3.8+)</span>
                        <span class="requirement-status status-warning" id="pythonStatus">í™•ì¸ ì¤‘...</span>
                    </div>
                    <div class="requirement-item">
                        <span>Git</span>
                        <span class="requirement-status status-warning" id="gitStatus">í™•ì¸ ì¤‘...</span>
                    </div>
                    <div class="requirement-item">
                        <span>ë„¤íŠ¸ì›Œí¬ ì—°ê²°</span>
                        <span class="requirement-status status-warning" id="networkStatus">í™•ì¸ ì¤‘...</span>
                    </div>
                    <div class="requirement-item">
                        <span>í¬íŠ¸ 3100 ì‚¬ìš© ê°€ëŠ¥</span>
                        <span class="requirement-status status-warning" id="portStatus">í™•ì¸ ì¤‘...</span>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-secondary" onclick="refreshRequirements()">
                        <span>ğŸ”„</span>
                        ìƒˆë¡œê³ ì¹¨
                    </button>
                    <button class="btn btn-success" onclick="downloadScript()" id="downloadBtn" disabled>
                        <span>ğŸ“¥</span>
                        ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸ ë‹¤ìš´ë¡œë“œ
                    </button>
                </div>
            </div>
        </div>

        <!-- ì„¤ì¹˜ ì§„í–‰ë¥  ë° ë¡œê·¸ -->
        <div class="progress-container" id="progressContainer">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill">0%</div>
            </div>
            <div class="log-output" id="logOutput">ì„¤ì¹˜ ì¤€ë¹„ ì¤‘...</div>
        </div>

        <!-- ì„¤ì¹˜ ì™„ë£Œ ìš”ì•½ -->
        <div class="installation-summary" id="installationSummary">
            <h3 class="summary-title">ì„¤ì¹˜ ì™„ë£Œ ìš”ì•½</h3>
            <div class="summary-grid">
                <div class="summary-item">
                    <span class="summary-label">ì„¤ì¹˜ ê²½ë¡œ</span>
                    <span class="summary-value" id="summaryPath">-</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">ì„œë¹„ìŠ¤ í¬íŠ¸</span>
                    <span class="summary-value" id="summaryPort">-</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">ì„œë¹„ìŠ¤ ìƒíƒœ</span>
                    <span class="summary-value" id="summaryStatus">
                        <span class="status-indicator status-online"></span>
                        ì‹¤í–‰ ì¤‘
                    </span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">ì ‘ì† URL</span>
                    <span class="summary-value" id="summaryUrl">-</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">ì„¤ì¹˜ ì‹œê°„</span>
                    <span class="summary-value" id="summaryTime">-</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">ë²„ì „</span>
                    <span class="summary-value" id="summaryVersion">v1.0.0</span>
                </div>
            </div>
            
            <div class="action-buttons" style="margin-top: 20px;">
                <button class="btn btn-primary" onclick="openService()">
                    <span>ğŸŒ</span>
                    ì„œë¹„ìŠ¤ ì—´ê¸°
                </button>
                <button class="btn btn-secondary" onclick="viewLogs()">
                    <span>ğŸ“„</span>
                    ë¡œê·¸ ë³´ê¸°
                </button>
                <button class="btn btn-secondary" onclick="manageService()">
                    <span>âš™ï¸</span>
                    ì„œë¹„ìŠ¤ ê´€ë¦¬
                </button>
            </div>
        </div>
    </div>

    <script>
        let installationProgress = 0;
        let currentStep = 0;
        let installationStartTime = null;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­ í™•ì¸
        window.addEventListener('load', function() {
            checkRequirements();
        });

        // ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­ í™•ì¸
        async function checkRequirements() {
            console.log('ğŸ” ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­ í™•ì¸ ì‹œì‘...');
            
            try {
                const response = await fetch('/api/installation/check-requirements');
                const data = await response.json();
                
                updateRequirementStatus('osStatus', data.os);
                updateRequirementStatus('memoryStatus', data.memory);
                updateRequirementStatus('diskStatus', data.disk);
                updateRequirementStatus('nodeStatus', data.node);
                updateRequirementStatus('pythonStatus', data.python);
                updateRequirementStatus('gitStatus', data.git);
                updateRequirementStatus('networkStatus', data.network);
                updateRequirementStatus('portStatus', data.port);
                
                // ëª¨ë“  ìš”êµ¬ì‚¬í•­ì´ ì¶©ì¡±ë˜ë©´ ì„¤ì¹˜ ë²„íŠ¼ í™œì„±í™”
                const allPassed = Object.values(data).every(status => status.passed);
                document.getElementById('installBtn').disabled = !allPassed;
                document.getElementById('downloadBtn').disabled = !allPassed;
                
                console.log('âœ… ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­ í™•ì¸ ì™„ë£Œ');
            } catch (error) {
                console.error('âŒ ìš”êµ¬ì‚¬í•­ í™•ì¸ ì‹¤íŒ¨:', error);
                // í…ŒìŠ¤íŠ¸ìš© ë”ë¯¸ ë°ì´í„°
                setDummyRequirements();
            }
        }

        // ìš”êµ¬ì‚¬í•­ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateRequirementStatus(elementId, status) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            element.textContent = status.message || status.value || 'Unknown';
            element.className = 'requirement-status ' + 
                (status.passed ? 'status-pass' : 
                 status.warning ? 'status-warning' : 'status-fail');
        }

        // í…ŒìŠ¤íŠ¸ìš© ë”ë¯¸ ë°ì´í„°
        function setDummyRequirements() {
            const dummyData = {
                os: { passed: true, message: 'Ubuntu 20.04 LTS' },
                memory: { passed: true, message: '8GB ì‚¬ìš© ê°€ëŠ¥' },
                disk: { passed: true, message: '50GB ì‚¬ìš© ê°€ëŠ¥' },
                node: { passed: true, message: 'v18.17.0 ì„¤ì¹˜ë¨' },
                python: { passed: true, message: 'v3.9.7 ì„¤ì¹˜ë¨' },
                git: { passed: true, message: 'v2.34.1 ì„¤ì¹˜ë¨' },
                network: { passed: true, message: 'ì—°ê²°ë¨' },
                port: { passed: true, message: 'ì‚¬ìš© ê°€ëŠ¥' }
            };
            
            Object.keys(dummyData).forEach(key => {
                updateRequirementStatus(key + 'Status', dummyData[key]);
            });
            
            document.getElementById('installBtn').disabled = false;
            document.getElementById('downloadBtn').disabled = false;
        }

        // ìš”êµ¬ì‚¬í•­ ìƒˆë¡œê³ ì¹¨
        function refreshRequirements() {
            // ëª¨ë“  ìƒíƒœë¥¼ í™•ì¸ ì¤‘ìœ¼ë¡œ ì¬ì„¤ì •
            const statusElements = ['osStatus', 'memoryStatus', 'diskStatus', 'nodeStatus', 
                                   'pythonStatus', 'gitStatus', 'networkStatus', 'portStatus'];
            
            statusElements.forEach(id => {
                const element = document.getElementById(id);
                element.textContent = 'í™•ì¸ ì¤‘...';
                element.className = 'requirement-status status-warning';
            });
            
            // 2ì´ˆ í›„ ë‹¤ì‹œ í™•ì¸
            setTimeout(checkRequirements, 2000);
        }

        // ì„¤ì¹˜ ì‹œì‘
        async function startInstallation() {
            console.log('ğŸš€ AIRIS-MON ì„¤ì¹˜ ì‹œì‘...');
            installationStartTime = new Date();
            
            // UI ìƒíƒœ ë³€ê²½
            document.getElementById('installBtn').disabled = true;
            document.getElementById('progressContainer').style.display = 'block';
            document.getElementById('installationSummary').style.display = 'none';
            
            // ì„¤ì¹˜ ì„¤ì • ìˆ˜ì§‘
            const config = {
                installPath: document.getElementById('installPath').value,
                servicePort: document.getElementById('servicePort').value,
                serviceUser: document.getElementById('serviceUser').value,
                gitRepo: document.getElementById('gitRepo').value,
                gitBranch: document.getElementById('gitBranch').value,
                autoStart: document.getElementById('autoStart').checked,
                enableSsl: document.getElementById('enableSsl').checked,
                installNginx: document.getElementById('installNginx').checked
            };
            
            try {
                // ì‹¤ì œ ì„¤ì¹˜ API í˜¸ì¶œ
                const response = await fetch('/api/installation/start', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(config)
                });
                
                if (!response.ok) {
                    throw new Error('ì„¤ì¹˜ ì‹œì‘ ì‹¤íŒ¨');
                }
                
                const installationId = await response.text();
                
                // ì„¤ì¹˜ ì§„í–‰ ìƒí™© ëª¨ë‹ˆí„°ë§
                monitorInstallation(installationId);
                
            } catch (error) {
                console.error('âŒ ì„¤ì¹˜ ì‹œì‘ ì‹¤íŒ¨:', error);
                // í…ŒìŠ¤íŠ¸ìš© ì‹œë®¬ë ˆì´ì…˜
                simulateInstallation();
            }
        }

        // ì„¤ì¹˜ ì§„í–‰ ìƒí™© ëª¨ë‹ˆí„°ë§
        async function monitorInstallation(installationId) {
            const interval = setInterval(async () => {
                try {
                    const response = await fetch(`/api/installation/status/${installationId}`);
                    const status = await response.json();
                    
                    updateInstallationProgress(status.step, status.progress, status.message);
                    
                    if (status.completed) {
                        clearInterval(interval);
                        completeInstallation(status);
                    }
                    
                    if (status.error) {
                        clearInterval(interval);
                        handleInstallationError(status.error);
                    }
                    
                } catch (error) {
                    console.error('ì„¤ì¹˜ ìƒíƒœ í™•ì¸ ì‹¤íŒ¨:', error);
                }
            }, 2000);
        }

        // ì„¤ì¹˜ ì‹œë®¬ë ˆì´ì…˜ (í…ŒìŠ¤íŠ¸ìš©)
        function simulateInstallation() {
            const steps = [
                { step: 1, message: 'ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­ ì¬í™•ì¸ ì¤‘...', duration: 2000 },
                { step: 2, message: 'Node.js ë° Python ì˜ì¡´ì„± ì„¤ì¹˜ ì¤‘...', duration: 8000 },
                { step: 3, message: 'GitHubì—ì„œ ì†ŒìŠ¤ ì½”ë“œ ë‹¤ìš´ë¡œë“œ ì¤‘...', duration: 5000 },
                { step: 4, message: 'í™˜ê²½ ì„¤ì • íŒŒì¼ ìƒì„± ì¤‘...', duration: 3000 },
                { step: 5, message: 'systemd ì„œë¹„ìŠ¤ ë“±ë¡ ì¤‘...', duration: 2000 },
                { step: 6, message: 'ì„œë¹„ìŠ¤ ì‹œì‘ ë° ê²€ì¦ ì¤‘...', duration: 3000 }
            ];
            
            let currentStepIndex = 0;
            
            function executeStep() {
                if (currentStepIndex >= steps.length) {
                    completeInstallation({
                        success: true,
                        installPath: document.getElementById('installPath').value,
                        servicePort: document.getElementById('servicePort').value,
                        serviceUrl: `http://localhost:${document.getElementById('servicePort').value}`
                    });
                    return;
                }
                
                const step = steps[currentStepIndex];
                updateInstallationProgress(step.step, (currentStepIndex + 1) * 100 / steps.length, step.message);
                
                setTimeout(() => {
                    currentStepIndex++;
                    executeStep();
                }, step.duration);
            }
            
            executeStep();
        }

        // ì„¤ì¹˜ ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
        function updateInstallationProgress(step, progress, message) {
            // ë‹¨ê³„ í‘œì‹œ ì—…ë°ì´íŠ¸
            for (let i = 1; i <= 6; i++) {
                const stepElement = document.getElementById(`step${i}`);
                stepElement.className = 'step-number';
                
                if (i < step) {
                    stepElement.className += ' completed';
                } else if (i === step) {
                    stepElement.className += ' active';
                }
            }
            
            // ì§„í–‰ë¥  ë°” ì—…ë°ì´íŠ¸
            const progressFill = document.getElementById('progressFill');
            progressFill.style.width = progress + '%';
            progressFill.textContent = Math.round(progress) + '%';
            
            // ë¡œê·¸ ì¶”ê°€
            const logOutput = document.getElementById('logOutput');
            const timestamp = new Date().toLocaleTimeString();
            logOutput.textContent += `[${timestamp}] ${message}\n`;
            logOutput.scrollTop = logOutput.scrollHeight;
        }

        // ì„¤ì¹˜ ì™„ë£Œ ì²˜ë¦¬
        function completeInstallation(result) {
            console.log('âœ… AIRIS-MON ì„¤ì¹˜ ì™„ë£Œ!');
            
            const duration = installationStartTime ? 
                Math.round((new Date() - installationStartTime) / 1000) : 0;
            
            // ìš”ì•½ ì •ë³´ ì—…ë°ì´íŠ¸
            document.getElementById('summaryPath').textContent = result.installPath || '/opt/airis-mon';
            document.getElementById('summaryPort').textContent = result.servicePort || '3100';
            document.getElementById('summaryUrl').textContent = result.serviceUrl || 'http://localhost:3100';
            document.getElementById('summaryTime').textContent = `${duration}ì´ˆ`;
            
            // ì„¤ì¹˜ ì™„ë£Œ ìš”ì•½ í‘œì‹œ
            document.getElementById('installationSummary').style.display = 'block';
            
            // ì„¤ì¹˜ ë²„íŠ¼ ì¬í™œì„±í™”
            document.getElementById('installBtn').disabled = false;
            document.getElementById('installBtn').innerHTML = '<span>âœ…</span> ì¬ì„¤ì¹˜';
            
            // ì™„ë£Œ ë¡œê·¸
            const logOutput = document.getElementById('logOutput');
            logOutput.textContent += `\nğŸ‰ ì„¤ì¹˜ê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\n`;
            logOutput.textContent += `ğŸ“ ì ‘ì† URL: ${result.serviceUrl || 'http://localhost:3100'}\n`;
            logOutput.scrollTop = logOutput.scrollHeight;
        }

        // ì„¤ì¹˜ ì˜¤ë¥˜ ì²˜ë¦¬
        function handleInstallationError(error) {
            console.error('âŒ ì„¤ì¹˜ ì‹¤íŒ¨:', error);
            
            document.getElementById('installBtn').disabled = false;
            
            const logOutput = document.getElementById('logOutput');
            logOutput.textContent += `\nâŒ ì„¤ì¹˜ ì‹¤íŒ¨: ${error}\n`;
            logOutput.scrollTop = logOutput.scrollHeight;
        }

        // ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸ ë‹¤ìš´ë¡œë“œ
        async function downloadScript() {
            try {
                const config = {
                    installPath: document.getElementById('installPath').value,
                    servicePort: document.getElementById('servicePort').value,
                    serviceUser: document.getElementById('serviceUser').value,
                    gitRepo: document.getElementById('gitRepo').value,
                    gitBranch: document.getElementById('gitBranch').value,
                    autoStart: document.getElementById('autoStart').checked,
                    enableSsl: document.getElementById('enableSsl').checked,
                    installNginx: document.getElementById('installNginx').checked
                };
                
                const response = await fetch('/api/installation/generate-script', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(config)
                });
                
                const script = await response.text();
                
                // ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ ë‹¤ìš´ë¡œë“œ
                const blob = new Blob([script], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'install-airis-mon.sh';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                console.log('ğŸ“¥ ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ');
                
            } catch (error) {
                console.error('ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸ ìƒì„± ì‹¤íŒ¨:', error);
                alert('ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì„œë¹„ìŠ¤ ì—´ê¸°
        function openService() {
            const url = document.getElementById('summaryUrl').textContent;
            if (url && url !== '-') {
                window.open(url, '_blank');
            }
        }

        // ë¡œê·¸ ë³´ê¸°
        function viewLogs() {
            // ë³„ë„ ì°½ì—ì„œ ì‹¤ì‹œê°„ ë¡œê·¸ ë³´ê¸°
            window.open('/system-logs', '_blank');
        }

        // ì„œë¹„ìŠ¤ ê´€ë¦¬
        function manageService() {
            // ì„œë¹„ìŠ¤ ê´€ë¦¬ í˜ì´ì§€ë¡œ ì´ë™
            window.location.href = '/service-management';
        }
    </script>
</body>
</html>