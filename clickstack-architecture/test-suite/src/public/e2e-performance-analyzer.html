<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIRIS-MON E2E ì„±ëŠ¥ ë¶„ì„ê¸°</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <script src="/components/common-layout.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            min-height: 100vh;
            color: #e2e8f0;
        }

        .header {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            padding: 1.5rem 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid #334155;
        }

        .header-content {
            max-width: 1600px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .header h1 {
            color: #f1f5f9;
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .header p {
            color: #94a3b8;
            font-size: 1rem;
        }

        .header-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #22c55e;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
        }

        .controls-panel {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid #334155;
            backdrop-filter: blur(10px);
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .control-group label {
            font-weight: 600;
            color: #f1f5f9;
            font-size: 0.9rem;
        }

        select, input {
            padding: 0.75rem;
            border: 1px solid #475569;
            border-radius: 8px;
            font-size: 0.9rem;
            background: rgba(15, 23, 42, 0.8);
            color: #e2e8f0;
            transition: border-color 0.3s ease;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .btn {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn.danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .btn.success {
            background: linear-gradient(135deg, #22c55e, #16a34a);
        }

        .metrics-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .metric-card {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid #334155;
            backdrop-filter: blur(10px);
            transition: transform 0.2s ease;
        }

        .metric-card:hover {
            transform: translateY(-2px);
        }

        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .metric-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .metric-icon {
            font-size: 1.5rem;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            color: #f1f5f9;
            margin-bottom: 0.5rem;
        }

        .metric-change {
            font-size: 0.8rem;
            font-weight: 600;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
        }

        .metric-change.positive {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }

        .metric-change.negative {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .chart-container {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid #334155;
            backdrop-filter: blur(10px);
        }

        .chart-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #f1f5f9;
            margin-bottom: 1rem;
            text-align: center;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .trace-timeline {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid #334155;
            backdrop-filter: blur(10px);
        }

        .trace-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .trace-filter {
            padding: 0.5rem 1rem;
            border: 1px solid #475569;
            border-radius: 20px;
            background: rgba(15, 23, 42, 0.8);
            color: #e2e8f0;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .trace-filter.active {
            background: rgba(59, 130, 246, 0.3);
            border-color: #3b82f6;
            color: #93c5fd;
        }

        .timeline-container {
            position: relative;
            height: 400px;
            overflow-x: auto;
            overflow-y: hidden;
        }

        .timeline-track {
            min-width: 1200px;
            height: 100%;
            position: relative;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(59, 130, 246, 0.05) 50%, 
                transparent 100%);
            border-radius: 8px;
        }

        .trace-item {
            position: absolute;
            height: 30px;
            background: linear-gradient(90deg, #3b82f6, #1d4ed8);
            border-radius: 4px;
            display: flex;
            align-items: center;
            padding: 0 0.5rem;
            font-size: 0.8rem;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .trace-item:hover {
            transform: scaleY(1.1);
            z-index: 10;
        }

        .trace-item.slow {
            background: linear-gradient(90deg, #f59e0b, #d97706);
        }

        .trace-item.error {
            background: linear-gradient(90deg, #ef4444, #dc2626);
        }

        .bottleneck-analysis {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .bottleneck-list {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid #334155;
            backdrop-filter: blur(10px);
        }

        .bottleneck-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border: 1px solid #475569;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            background: rgba(15, 23, 42, 0.5);
            transition: all 0.2s ease;
        }

        .bottleneck-item:hover {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }

        .bottleneck-info h4 {
            color: #f1f5f9;
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }

        .bottleneck-info p {
            color: #94a3b8;
            font-size: 0.8rem;
        }

        .bottleneck-impact {
            text-align: right;
        }

        .impact-score {
            font-size: 1.2rem;
            font-weight: 700;
            color: #ef4444;
            margin-bottom: 0.25rem;
        }

        .impact-label {
            font-size: 0.8rem;
            color: #94a3b8;
        }

        .recommendations {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid #334155;
            backdrop-filter: blur(10px);
        }

        .recommendation-item {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 1rem;
            border: 1px solid #475569;
            border-radius: 8px;
            margin-bottom: 1rem;
            background: rgba(15, 23, 42, 0.5);
        }

        .recommendation-icon {
            font-size: 1.5rem;
            margin-top: 0.25rem;
        }

        .recommendation-content h4 {
            color: #f1f5f9;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .recommendation-content p {
            color: #94a3b8;
            font-size: 0.8rem;
            line-height: 1.5;
        }

        .priority-high {
            border-left: 4px solid #ef4444;
        }

        .priority-medium {
            border-left: 4px solid #f59e0b;
        }

        .priority-low {
            border-left: 4px solid #22c55e;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .loading-spinner {
            width: 3rem;
            height: 3rem;
            border: 3px solid rgba(59, 130, 246, 0.3);
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background: rgba(239, 68, 68, 0.2);
            color: #fca5a5;
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid rgba(239, 68, 68, 0.3);
            margin: 1rem 0;
            text-align: center;
        }

        .success-message {
            background: rgba(34, 197, 94, 0.2);
            color: #86efac;
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid rgba(34, 197, 94, 0.3);
            margin: 1rem 0;
            text-align: center;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .header-content {
                flex-direction: column;
                text-align: center;
            }

            .controls-grid {
                grid-template-columns: 1fr;
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }

            .bottleneck-analysis {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="airis-content-wrapper">
    <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="loading-spinner"></div>
        <p>E2E ì„±ëŠ¥ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
    </div>

    <div class="header">
        <div class="header-content">
            <div>
                <h1>ğŸ” AIRIS-MON E2E ì„±ëŠ¥ ë¶„ì„ê¸°</h1>
                <p>ì—”ë“œíˆ¬ì—”ë“œ íŠ¸ë ˆì´ìŠ¤ ë¶„ì„ì„ í†µí•œ ì„±ëŠ¥ ë³‘ëª© ì§€ì  ì‹ë³„ ë° ìµœì í™” ê¶Œì¥ì‚¬í•­</p>
            </div>
            <div class="header-controls">
                <div class="status-indicator">
                    <div class="status-dot"></div>
                    <span>ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§</span>
                </div>
                <button class="btn" onclick="exportReport()">ğŸ“Š ë¦¬í¬íŠ¸ ë‚´ë³´ë‚´ê¸°</button>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- ì»¨íŠ¸ë¡¤ íŒ¨ë„ -->
        <div class="controls-panel">
            <div class="controls-grid">
                <div class="control-group">
                    <label>ë¶„ì„í•  ì„¸ì…˜ ì„ íƒ</label>
                    <select id="sessionSelect">
                        <option value="">ì„¸ì…˜ì„ ì„ íƒí•˜ì„¸ìš”...</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label>ë¶„ì„ ì‹œê°„ ë²”ìœ„</label>
                    <select id="timeRange">
                        <option value="5">ìµœê·¼ 5ë¶„</option>
                        <option value="15">ìµœê·¼ 15ë¶„</option>
                        <option value="30">ìµœê·¼ 30ë¶„</option>
                        <option value="60" selected>ìµœê·¼ 1ì‹œê°„</option>
                        <option value="360">ìµœê·¼ 6ì‹œê°„</option>
                        <option value="1440">ìµœê·¼ 24ì‹œê°„</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label>ì„±ëŠ¥ ì„ê³„ê°’ (ms)</label>
                    <input type="number" id="performanceThreshold" value="1000" min="100" max="10000">
                </div>
                
                <div class="control-group">
                    <label>íŠ¸ë ˆì´ìŠ¤ ìƒ˜í”Œë§ ë¹„ìœ¨</label>
                    <select id="samplingRate">
                        <option value="1">100% (ì „ì²´)</option>
                        <option value="0.1" selected>10% (ê¶Œì¥)</option>
                        <option value="0.05">5% (ê²½ëŸ‰)</option>
                        <option value="0.01">1% (ìµœì†Œ)</option>
                    </select>
                </div>
            </div>
            
            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                <button class="btn" onclick="startAnalysis()">ğŸ” ë¶„ì„ ì‹œì‘</button>
                <button class="btn success" onclick="refreshData()">ğŸ”„ ë°ì´í„° ìƒˆë¡œê³ ì¹¨</button>
                <button class="btn danger" onclick="clearAnalysis()">ğŸ—‘ï¸ ë¶„ì„ ì´ˆê¸°í™”</button>
            </div>
        </div>

        <!-- ì„±ëŠ¥ ë©”íŠ¸ë¦­ ê°œìš” -->
        <div class="metrics-overview">
            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-title">í‰ê·  ì‘ë‹µ ì‹œê°„</div>
                    <div class="metric-icon">â±ï¸</div>
                </div>
                <div class="metric-value" id="avgResponseTime">0ms</div>
                <div class="metric-change positive" id="responseTimeChange">+0%</div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-title">ì²˜ë¦¬ëŸ‰ (RPS)</div>
                    <div class="metric-icon">ğŸš€</div>
                </div>
                <div class="metric-value" id="throughput">0</div>
                <div class="metric-change negative" id="throughputChange">-0%</div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-title">ì˜¤ë¥˜ìœ¨</div>
                    <div class="metric-icon">âŒ</div>
                </div>
                <div class="metric-value" id="errorRate">0%</div>
                <div class="metric-change positive" id="errorRateChange">-0%</div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-title">ë³‘ëª© ì§€ì </div>
                    <div class="metric-icon">ğŸ”´</div>
                </div>
                <div class="metric-value" id="bottleneckCount">0</div>
                <div class="metric-change negative" id="bottleneckChange">+0</div>
            </div>
        </div>

        <!-- ì°¨íŠ¸ ì˜ì—­ -->
        <div class="charts-grid">
            <div class="chart-container">
                <h3 class="chart-title">ì‘ë‹µ ì‹œê°„ ë¶„í¬</h3>
                <canvas id="responseTimeChart" width="400" height="200"></canvas>
            </div>

            <div class="chart-container">
                <h3 class="chart-title">ì²˜ë¦¬ëŸ‰ íŠ¸ë Œë“œ</h3>
                <canvas id="throughputChart" width="400" height="200"></canvas>
            </div>

            <div class="chart-container full-width">
                <h3 class="chart-title">ì„œë¹„ìŠ¤ë³„ ì„±ëŠ¥ íˆíŠ¸ë§µ</h3>
                <canvas id="performanceHeatmap" width="800" height="300"></canvas>
            </div>
        </div>

        <!-- íŠ¸ë ˆì´ìŠ¤ íƒ€ì„ë¼ì¸ -->
        <div class="trace-timeline">
            <h3 class="chart-title">ğŸ” íŠ¸ë ˆì´ìŠ¤ íƒ€ì„ë¼ì¸ ë¶„ì„</h3>
            
            <div class="trace-controls">
                <button class="trace-filter active" onclick="filterTraces('all')">ì „ì²´</button>
                <button class="trace-filter" onclick="filterTraces('slow')">ëŠë¦° ìš”ì²­</button>
                <button class="trace-filter" onclick="filterTraces('error')">ì˜¤ë¥˜</button>
                <button class="trace-filter" onclick="filterTraces('database')">ë°ì´í„°ë² ì´ìŠ¤</button>
                <button class="trace-filter" onclick="filterTraces('external')">ì™¸ë¶€ API</button>
                <button class="trace-filter" onclick="filterTraces('cache')">ìºì‹œ</button>
            </div>

            <div class="timeline-container" id="timelineContainer">
                <div class="timeline-track" id="timelineTrack">
                    <!-- íŠ¸ë ˆì´ìŠ¤ í•­ëª©ë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>

        <!-- ë³‘ëª© ì§€ì  ë¶„ì„ -->
        <div class="bottleneck-analysis">
            <div class="bottleneck-list">
                <h3 class="chart-title">ğŸ”´ ì„±ëŠ¥ ë³‘ëª© ì§€ì </h3>
                <div id="bottleneckList">
                    <p style="text-align: center; color: #64748b; padding: 2rem;">
                        ë¶„ì„ì„ ì‹œì‘í•˜ì—¬ ë³‘ëª© ì§€ì ì„ ì‹ë³„í•´ë³´ì„¸ìš”.
                    </p>
                </div>
            </div>

            <div class="recommendations">
                <h3 class="chart-title">ğŸ’¡ ìµœì í™” ê¶Œì¥ì‚¬í•­</h3>
                <div id="recommendationsList">
                    <p style="text-align: center; color: #64748b; padding: 2rem;">
                        ì„±ëŠ¥ ë¶„ì„ ì™„ë£Œ í›„ ë§ì¶¤í˜• ê¶Œì¥ì‚¬í•­ì´ í‘œì‹œë©ë‹ˆë‹¤.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ê¸€ë¡œë²Œ ë³€ìˆ˜
        let performanceData = {};
        let traceData = [];
        let charts = {};
        let currentFilter = 'all';
        let analysisInterval = null;

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
            loadSessions();
            startRealTimeUpdates();
            generateMockData(); // ë°ëª¨ìš© ë°ì´í„° ìƒì„±
        });

        // ì°¨íŠ¸ ì´ˆê¸°í™”
        function initializeCharts() {
            // ì‘ë‹µ ì‹œê°„ ë¶„í¬ ì°¨íŠ¸
            const responseCtx = document.getElementById('responseTimeChart').getContext('2d');
            charts.responseTime = new Chart(responseCtx, {
                type: 'histogram',
                data: {
                    labels: ['0-100ms', '100-500ms', '500ms-1s', '1s-3s', '3s-10s', '10s+'],
                    datasets: [{
                        label: 'ìš”ì²­ ìˆ˜',
                        data: [0, 0, 0, 0, 0, 0],
                        backgroundColor: [
                            '#22c55e',
                            '#84cc16',
                            '#f59e0b',
                            '#f97316',
                            '#ef4444',
                            '#dc2626'
                        ],
                        borderColor: '#1f2937',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#e2e8f0' }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { color: '#94a3b8' },
                            grid: { color: '#334155' }
                        },
                        x: {
                            ticks: { color: '#94a3b8' },
                            grid: { color: '#334155' }
                        }
                    }
                }
            });

            // ì²˜ë¦¬ëŸ‰ íŠ¸ë Œë“œ ì°¨íŠ¸
            const throughputCtx = document.getElementById('throughputChart').getContext('2d');
            charts.throughput = new Chart(throughputCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'RPS',
                        data: [],
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#e2e8f0' }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { color: '#94a3b8' },
                            grid: { color: '#334155' }
                        },
                        x: {
                            ticks: { color: '#94a3b8' },
                            grid: { color: '#334155' }
                        }
                    }
                }
            });

            // ì„±ëŠ¥ íˆíŠ¸ë§µ ì°¨íŠ¸
            const heatmapCtx = document.getElementById('performanceHeatmap').getContext('2d');
            charts.heatmap = new Chart(heatmapCtx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'ì„œë¹„ìŠ¤ ì„±ëŠ¥',
                        data: [],
                        backgroundColor: function(context) {
                            const value = context.parsed.y;
                            if (value < 100) return '#22c55e';
                            if (value < 500) return '#84cc16';
                            if (value < 1000) return '#f59e0b';
                            if (value < 3000) return '#f97316';
                            return '#ef4444';
                        },
                        pointRadius: function(context) {
                            return Math.max(5, Math.min(15, context.parsed.y / 100));
                        }
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#e2e8f0' }
                        }
                    },
                    scales: {
                        y: {
                            title: { display: true, text: 'ì‘ë‹µì‹œê°„ (ms)', color: '#94a3b8' },
                            ticks: { color: '#94a3b8' },
                            grid: { color: '#334155' }
                        },
                        x: {
                            title: { display: true, text: 'ì‹œê°„', color: '#94a3b8' },
                            ticks: { color: '#94a3b8' },
                            grid: { color: '#334155' }
                        }
                    }
                }
            });
        }

        // ì„¸ì…˜ ëª©ë¡ ë¡œë“œ
        async function loadSessions() {
            try {
                const scenarios = ['bug_payment', 'ux_navigation', 'security_attack', 'performance_slow', 'enhanced_recording', 'mobile_recording'];
                const select = document.getElementById('sessionSelect');
                
                for (const scenario of scenarios) {
                    try {
                        const response = await fetch(`/api/session-replay/sessions/${scenario}`);
                        const data = await response.json();
                        
                        if (data.success && data.sessions.length > 0) {
                            const optgroup = document.createElement('optgroup');
                            optgroup.label = getScenarioName(scenario);
                            
                            data.sessions.forEach(session => {
                                const option = document.createElement('option');
                                option.value = session.id;
                                option.textContent = `${session.id.substring(0, 12)}... (${session.eventCount || 0}ê°œ ì´ë²¤íŠ¸)`;
                                optgroup.appendChild(option);
                            });
                            
                            select.appendChild(optgroup);
                        }
                    } catch (error) {
                        console.warn(`ì‹œë‚˜ë¦¬ì˜¤ ${scenario} ë¡œë“œ ì‹¤íŒ¨:`, error);
                    }
                }
            } catch (error) {
                console.error('ì„¸ì…˜ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        // ì‹œë‚˜ë¦¬ì˜¤ ì´ë¦„ ë³€í™˜
        function getScenarioName(scenario) {
            const names = {
                'bug_payment': 'ğŸ› ë²„ê·¸ ì¬í˜„ ì‹œë‚˜ë¦¬ì˜¤',
                'ux_navigation': 'ğŸ“Š UX/UI ê°œì„  ì‹œë‚˜ë¦¬ì˜¤', 
                'security_attack': 'ğŸš¨ ë³´ì•ˆ ê³µê²© ì‹œë‚˜ë¦¬ì˜¤',
                'performance_slow': 'âš¡ ì„±ëŠ¥ ë¬¸ì œ ì‹œë‚˜ë¦¬ì˜¤',
                'enhanced_recording': 'ğŸ¯ í–¥ìƒëœ ë…¹í™” ì„¸ì…˜',
                'mobile_recording': 'ğŸ“± ëª¨ë°”ì¼ ë…¹í™” ì„¸ì…˜'
            };
            return names[scenario] || scenario;
        }

        // ë¶„ì„ ì‹œì‘
        async function startAnalysis() {
            const sessionId = document.getElementById('sessionSelect').value;
            if (!sessionId) {
                alert('ë¶„ì„í•  ì„¸ì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            try {
                showLoading(true);
                
                // ì„¸ì…˜ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const sessionResponse = await fetch(`/api/session-replay/session/${sessionId}`);
                const sessionData = await sessionResponse.json();

                if (!sessionData.success) {
                    throw new Error('ì„¸ì…˜ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }

                // E2E ì„±ëŠ¥ ë°ì´í„° ìƒì„± (ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” APM ë„êµ¬ì—ì„œ ê°€ì ¸ì˜´)
                await generatePerformanceData(sessionData.session);
                
                // íŠ¸ë ˆì´ìŠ¤ ë°ì´í„° ë¶„ì„
                await analyzeTraces(sessionData.session);
                
                // ë³‘ëª© ì§€ì  ì‹ë³„
                await identifyBottlenecks();
                
                // ê¶Œì¥ì‚¬í•­ ìƒì„±
                await generateRecommendations();
                
                // UI ì—…ë°ì´íŠ¸
                updateMetrics();
                updateCharts();
                updateTimeline();
                
                showSuccess('E2E ì„±ëŠ¥ ë¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
                
            } catch (error) {
                console.error('ë¶„ì„ ì˜¤ë¥˜:', error);
                showError('ì„±ëŠ¥ ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        // ì„±ëŠ¥ ë°ì´í„° ìƒì„± (ì‹¤ì œë¡œëŠ” APM ë„êµ¬ì—ì„œ ìˆ˜ì§‘)
        async function generatePerformanceData(session) {
            const events = session.events || [];
            const duration = session.duration || 60000;
            
            performanceData = {
                avgResponseTime: Math.random() * 2000 + 200,
                throughput: Math.random() * 100 + 20,
                errorRate: Math.random() * 5,
                bottleneckCount: Math.floor(Math.random() * 10) + 1,
                responseTimeDistribution: [
                    Math.floor(Math.random() * 50) + 10,  // 0-100ms
                    Math.floor(Math.random() * 30) + 20,  // 100-500ms
                    Math.floor(Math.random() * 20) + 15,  // 500ms-1s
                    Math.floor(Math.random() * 15) + 10,  // 1s-3s
                    Math.floor(Math.random() * 10) + 5,   // 3s-10s
                    Math.floor(Math.random() * 5) + 2     // 10s+
                ],
                throughputTrend: [],
                heatmapData: []
            };

            // ì‹œê°„ë³„ ì²˜ë¦¬ëŸ‰ íŠ¸ë Œë“œ ìƒì„±
            const timePoints = 20;
            for (let i = 0; i < timePoints; i++) {
                performanceData.throughputTrend.push({
                    time: new Date(Date.now() - (timePoints - i) * 60000).toLocaleTimeString(),
                    value: performanceData.throughput + (Math.random() - 0.5) * 20
                });
            }

            // ì„œë¹„ìŠ¤ë³„ íˆíŠ¸ë§µ ë°ì´í„° ìƒì„±
            const services = ['API Gateway', 'Auth Service', 'User Service', 'Payment Service', 'Database', 'Cache'];
            services.forEach((service, index) => {
                for (let i = 0; i < 10; i++) {
                    performanceData.heatmapData.push({
                        x: index,
                        y: Math.random() * 3000 + 100,
                        service: service,
                        timestamp: Date.now() - Math.random() * 3600000
                    });
                }
            });
        }

        // íŠ¸ë ˆì´ìŠ¤ ë¶„ì„
        async function analyzeTraces(session) {
            const events = session.events || [];
            traceData = [];

            // ì´ë²¤íŠ¸ë¥¼ íŠ¸ë ˆì´ìŠ¤ë¡œ ë³€í™˜
            events.forEach((event, index) => {
                const trace = {
                    id: `trace-${index}`,
                    service: getServiceFromEvent(event),
                    operation: event.type,
                    startTime: event.timestamp || 0,
                    duration: Math.random() * 1000 + 50,
                    status: Math.random() > 0.95 ? 'error' : 'success',
                    type: categorizeTrace(event)
                };

                trace.endTime = trace.startTime + trace.duration;
                traceData.push(trace);
            });

            // íŠ¸ë ˆì´ìŠ¤ ì •ë ¬
            traceData.sort((a, b) => a.startTime - b.startTime);
        }

        // ì´ë²¤íŠ¸ì—ì„œ ì„œë¹„ìŠ¤ ì¶”ë¡ 
        function getServiceFromEvent(event) {
            if (event.type === 'click') return 'Frontend';
            if (event.type === 'input') return 'Form Service';
            if (event.type === 'navigation') return 'Router';
            if (event.page_url && event.page_url.includes('payment')) return 'Payment Service';
            if (event.page_url && event.page_url.includes('login')) return 'Auth Service';
            return 'User Service';
        }

        // íŠ¸ë ˆì´ìŠ¤ ë¶„ë¥˜
        function categorizeTrace(event) {
            if (event.type === 'click' && event.target?.id?.includes('submit')) return 'database';
            if (event.type === 'input') return 'cache';
            if (Math.random() > 0.8) return 'external';
            return 'internal';
        }

        // ë³‘ëª© ì§€ì  ì‹ë³„
        async function identifyBottlenecks() {
            const bottlenecks = [];

            // ëŠë¦° íŠ¸ë ˆì´ìŠ¤ ì°¾ê¸°
            const slowTraces = traceData.filter(trace => trace.duration > 1000);
            
            // ì„œë¹„ìŠ¤ë³„ í‰ê·  ì‘ë‹µ ì‹œê°„ ê³„ì‚°
            const serviceStats = {};
            traceData.forEach(trace => {
                if (!serviceStats[trace.service]) {
                    serviceStats[trace.service] = { totalTime: 0, count: 0 };
                }
                serviceStats[trace.service].totalTime += trace.duration;
                serviceStats[trace.service].count++;
            });

            // ë³‘ëª© ì§€ì  ìƒì„±
            Object.entries(serviceStats).forEach(([service, stats]) => {
                const avgTime = stats.totalTime / stats.count;
                if (avgTime > 500) {
                    bottlenecks.push({
                        service: service,
                        avgResponseTime: avgTime,
                        impact: calculateImpact(avgTime, stats.count),
                        description: `${service}ì˜ í‰ê·  ì‘ë‹µ ì‹œê°„ì´ ${Math.round(avgTime)}msë¡œ ë†’ìŠµë‹ˆë‹¤.`,
                        type: 'performance'
                    });
                }
            });

            // ì˜¤ë¥˜ ë§ì€ ì„œë¹„ìŠ¤ ì°¾ê¸°
            const errorCounts = {};
            traceData.filter(trace => trace.status === 'error').forEach(trace => {
                errorCounts[trace.service] = (errorCounts[trace.service] || 0) + 1;
            });

            Object.entries(errorCounts).forEach(([service, errorCount]) => {
                if (errorCount > 5) {
                    bottlenecks.push({
                        service: service,
                        errorCount: errorCount,
                        impact: calculateImpact(errorCount * 100, errorCount),
                        description: `${service}ì—ì„œ ${errorCount}ê°œì˜ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.`,
                        type: 'error'
                    });
                }
            });

            performanceData.bottlenecks = bottlenecks.sort((a, b) => b.impact - a.impact);
        }

        // ì˜í–¥ë„ ê³„ì‚°
        function calculateImpact(responseTime, frequency) {
            return Math.min(100, (responseTime / 10) * Math.log(frequency + 1));
        }

        // ê¶Œì¥ì‚¬í•­ ìƒì„±
        async function generateRecommendations() {
            const recommendations = [];

            // ë³‘ëª© ì§€ì  ê¸°ë°˜ ê¶Œì¥ì‚¬í•­
            performanceData.bottlenecks?.forEach(bottleneck => {
                if (bottleneck.type === 'performance') {
                    if (bottleneck.service === 'Database') {
                        recommendations.push({
                            priority: 'high',
                            title: 'ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ ìµœì í™”',
                            description: 'ì¸ë±ìŠ¤ ì¶”ê°€, ì¿¼ë¦¬ ìµœì í™”, ì»¤ë„¥ì…˜ í’€ íŠœë‹ì„ í†µí•´ ë°ì´í„°ë² ì´ìŠ¤ ì„±ëŠ¥ì„ ê°œì„ í•˜ì„¸ìš”.',
                            icon: 'ğŸ—„ï¸',
                            estimatedImprovement: '30-50% ì„±ëŠ¥ í–¥ìƒ'
                        });
                    } else if (bottleneck.service === 'Payment Service') {
                        recommendations.push({
                            priority: 'high',
                            title: 'ê²°ì œ ì„œë¹„ìŠ¤ ìµœì í™”',
                            description: 'ì™¸ë¶€ ê²°ì œ API í˜¸ì¶œì„ ë¹„ë™ê¸° ì²˜ë¦¬í•˜ê³ , ì‘ë‹µ ìºì‹±ì„ êµ¬í˜„í•˜ì„¸ìš”.',
                            icon: 'ğŸ’³',
                            estimatedImprovement: '40-60% ì‘ë‹µ ì‹œê°„ ë‹¨ì¶•'
                        });
                    } else {
                        recommendations.push({
                            priority: 'medium',
                            title: `${bottleneck.service} ì„±ëŠ¥ íŠœë‹`,
                            description: 'ì„œë¹„ìŠ¤ì˜ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ì„ ëª¨ë‹ˆí„°ë§í•˜ê³  ë³‘ëª© ì§€ì ì„ ìµœì í™”í•˜ì„¸ìš”.',
                            icon: 'âš¡',
                            estimatedImprovement: '20-30% ì„±ëŠ¥ í–¥ìƒ'
                        });
                    }
                } else if (bottleneck.type === 'error') {
                    recommendations.push({
                        priority: 'high',
                        title: `${bottleneck.service} ì˜¤ë¥˜ í•´ê²°`,
                        description: 'ë°˜ë³µë˜ëŠ” ì˜¤ë¥˜ì˜ ê·¼ë³¸ ì›ì¸ì„ íŒŒì•…í•˜ê³  ì˜ˆì™¸ ì²˜ë¦¬ë¥¼ ê°•í™”í•˜ì„¸ìš”.',
                        icon: 'ğŸš¨',
                        estimatedImprovement: 'ì•ˆì •ì„± í¬ê²Œ ê°œì„ '
                    });
                }
            });

            // ì¼ë°˜ì ì¸ ê¶Œì¥ì‚¬í•­
            if (performanceData.avgResponseTime > 1000) {
                recommendations.push({
                    priority: 'medium',
                    title: 'CDN ë° ìºì‹± ì „ëµ êµ¬í˜„',
                    description: 'ì •ì  ìì›ì€ CDNì„ í™œìš©í•˜ê³ , ë™ì  ì½˜í…ì¸ ëŠ” Redis ìºì‹±ì„ ì ìš©í•˜ì„¸ìš”.',
                    icon: 'ğŸŒ',
                    estimatedImprovement: '25-40% ë¡œë”© ì‹œê°„ ë‹¨ì¶•'
                });
            }

            if (performanceData.errorRate > 2) {
                recommendations.push({
                    priority: 'high',
                    title: 'ëª¨ë‹ˆí„°ë§ ë° ì•Œë¦¼ ì‹œìŠ¤í…œ ê°•í™”',
                    description: 'ì‹¤ì‹œê°„ ì˜¤ë¥˜ ê°ì§€ì™€ ìë™ ì•Œë¦¼ ì‹œìŠ¤í…œì„ êµ¬ì¶•í•˜ì—¬ ë¹ ë¥¸ ëŒ€ì‘ì´ ê°€ëŠ¥í•˜ë„ë¡ í•˜ì„¸ìš”.',
                    icon: 'ğŸ“Š',
                    estimatedImprovement: 'MTTR 50% ë‹¨ì¶•'
                });
            }

            recommendations.push({
                priority: 'low',
                title: 'ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ êµ¬ì¶•',
                description: 'ì£¼ìš” ì„±ëŠ¥ ì§€í‘œë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§í•  ìˆ˜ ìˆëŠ” ëŒ€ì‹œë³´ë“œë¥¼ êµ¬ì¶•í•˜ì„¸ìš”.',
                icon: 'ğŸ“ˆ',
                estimatedImprovement: 'ì§€ì†ì ì¸ ì„±ëŠ¥ ê´€ë¦¬'
            });

            performanceData.recommendations = recommendations;
        }

        // ë©”íŠ¸ë¦­ ì—…ë°ì´íŠ¸
        function updateMetrics() {
            document.getElementById('avgResponseTime').textContent = Math.round(performanceData.avgResponseTime) + 'ms';
            document.getElementById('throughput').textContent = Math.round(performanceData.throughput);
            document.getElementById('errorRate').textContent = performanceData.errorRate.toFixed(1) + '%';
            document.getElementById('bottleneckCount').textContent = performanceData.bottleneckCount;

            // ë³€í™”ìœ¨ ì—…ë°ì´íŠ¸ (ëœë¤)
            const changes = {
                responseTime: (Math.random() - 0.5) * 20,
                throughput: (Math.random() - 0.5) * 30,
                errorRate: (Math.random() - 0.5) * 2,
                bottleneck: Math.floor((Math.random() - 0.5) * 6)
            };

            updateMetricChange('responseTimeChange', changes.responseTime, '%', true);
            updateMetricChange('throughputChange', changes.throughput, '%');
            updateMetricChange('errorRateChange', changes.errorRate, '%', true);
            updateMetricChange('bottleneckChange', changes.bottleneck, '');
        }

        function updateMetricChange(elementId, value, unit, reverse = false) {
            const element = document.getElementById(elementId);
            const isPositive = reverse ? value < 0 : value > 0;
            
            element.className = `metric-change ${isPositive ? 'positive' : 'negative'}`;
            element.textContent = (value > 0 ? '+' : '') + value.toFixed(1) + unit;
        }

        // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateCharts() {
            // ì‘ë‹µ ì‹œê°„ ë¶„í¬ ì°¨íŠ¸
            charts.responseTime.data.datasets[0].data = performanceData.responseTimeDistribution;
            charts.responseTime.update();

            // ì²˜ë¦¬ëŸ‰ íŠ¸ë Œë“œ ì°¨íŠ¸
            charts.throughput.data.labels = performanceData.throughputTrend.map(point => point.time);
            charts.throughput.data.datasets[0].data = performanceData.throughputTrend.map(point => point.value);
            charts.throughput.update();

            // íˆíŠ¸ë§µ ì°¨íŠ¸
            charts.heatmap.data.datasets[0].data = performanceData.heatmapData;
            charts.heatmap.update();
        }

        // íƒ€ì„ë¼ì¸ ì—…ë°ì´íŠ¸
        function updateTimeline() {
            const timelineTrack = document.getElementById('timelineTrack');
            timelineTrack.innerHTML = '';

            if (traceData.length === 0) return;

            const minTime = Math.min(...traceData.map(trace => trace.startTime));
            const maxTime = Math.max(...traceData.map(trace => trace.endTime));
            const timeRange = maxTime - minTime || 1;

            traceData.forEach((trace, index) => {
                if (shouldShowTrace(trace)) {
                    const traceElement = createTraceElement(trace, index, minTime, timeRange);
                    timelineTrack.appendChild(traceElement);
                }
            });

            // ë³‘ëª© ì§€ì  ì—…ë°ì´íŠ¸
            updateBottleneckList();

            // ê¶Œì¥ì‚¬í•­ ì—…ë°ì´íŠ¸
            updateRecommendationsList();
        }

        // íŠ¸ë ˆì´ìŠ¤ í•„í„°ë§
        function shouldShowTrace(trace) {
            switch (currentFilter) {
                case 'slow':
                    return trace.duration > 1000;
                case 'error':
                    return trace.status === 'error';
                case 'database':
                    return trace.type === 'database';
                case 'external':
                    return trace.type === 'external';
                case 'cache':
                    return trace.type === 'cache';
                default:
                    return true;
            }
        }

        // íŠ¸ë ˆì´ìŠ¤ ìš”ì†Œ ìƒì„±
        function createTraceElement(trace, index, minTime, timeRange) {
            const element = document.createElement('div');
            element.className = `trace-item ${trace.duration > 1000 ? 'slow' : ''} ${trace.status === 'error' ? 'error' : ''}`;
            
            const left = ((trace.startTime - minTime) / timeRange) * 100;
            const width = (trace.duration / timeRange) * 100;
            
            element.style.left = left + '%';
            element.style.width = Math.max(0.5, width) + '%';
            element.style.top = (index % 10) * 35 + 'px';
            
            element.textContent = `${trace.service}: ${trace.operation} (${Math.round(trace.duration)}ms)`;
            element.title = `Service: ${trace.service}\nOperation: ${trace.operation}\nDuration: ${Math.round(trace.duration)}ms\nStatus: ${trace.status}`;
            
            element.addEventListener('click', () => {
                showTraceDetails(trace);
            });
            
            return element;
        }

        // íŠ¸ë ˆì´ìŠ¤ ìƒì„¸ ì •ë³´ í‘œì‹œ
        function showTraceDetails(trace) {
            alert(`íŠ¸ë ˆì´ìŠ¤ ìƒì„¸ ì •ë³´:
            
ì„œë¹„ìŠ¤: ${trace.service}
ì‘ì—…: ${trace.operation}
ì‹œì‘ ì‹œê°„: ${new Date(trace.startTime).toLocaleTimeString()}
ì§€ì† ì‹œê°„: ${Math.round(trace.duration)}ms
ìƒíƒœ: ${trace.status}
íƒ€ì…: ${trace.type}`);
        }

        // ë³‘ëª© ì§€ì  ëª©ë¡ ì—…ë°ì´íŠ¸
        function updateBottleneckList() {
            const bottleneckList = document.getElementById('bottleneckList');
            
            if (!performanceData.bottlenecks || performanceData.bottlenecks.length === 0) {
                bottleneckList.innerHTML = '<p style="text-align: center; color: #64748b; padding: 2rem;">ë³‘ëª© ì§€ì ì´ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            bottleneckList.innerHTML = performanceData.bottlenecks.map(bottleneck => `
                <div class="bottleneck-item">
                    <div class="bottleneck-info">
                        <h4>${bottleneck.service}</h4>
                        <p>${bottleneck.description}</p>
                    </div>
                    <div class="bottleneck-impact">
                        <div class="impact-score">${Math.round(bottleneck.impact)}</div>
                        <div class="impact-label">ì˜í–¥ë„</div>
                    </div>
                </div>
            `).join('');
        }

        // ê¶Œì¥ì‚¬í•­ ëª©ë¡ ì—…ë°ì´íŠ¸
        function updateRecommendationsList() {
            const recommendationsList = document.getElementById('recommendationsList');
            
            if (!performanceData.recommendations || performanceData.recommendations.length === 0) {
                recommendationsList.innerHTML = '<p style="text-align: center; color: #64748b; padding: 2rem;">ê¶Œì¥ì‚¬í•­ì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>';
                return;
            }

            recommendationsList.innerHTML = performanceData.recommendations.map(rec => `
                <div class="recommendation-item priority-${rec.priority}">
                    <div class="recommendation-icon">${rec.icon}</div>
                    <div class="recommendation-content">
                        <h4>${rec.title}</h4>
                        <p>${rec.description}</p>
                        <small style="color: #3b82f6; font-weight: 600;">${rec.estimatedImprovement}</small>
                    </div>
                </div>
            `).join('');
        }

        // íŠ¸ë ˆì´ìŠ¤ í•„í„°
        function filterTraces(filter) {
            currentFilter = filter;
            
            // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.trace-filter').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // íƒ€ì„ë¼ì¸ ì—…ë°ì´íŠ¸
            updateTimeline();
        }

        // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
        function startRealTimeUpdates() {
            analysisInterval = setInterval(() => {
                if (Object.keys(performanceData).length > 0) {
                    // ë©”íŠ¸ë¦­ ê°’ ì•½ê°„ ë³€í™”
                    performanceData.avgResponseTime += (Math.random() - 0.5) * 50;
                    performanceData.throughput += (Math.random() - 0.5) * 5;
                    performanceData.errorRate += (Math.random() - 0.5) * 0.5;
                    
                    // ê°’ ë²”ìœ„ ì œí•œ
                    performanceData.avgResponseTime = Math.max(100, Math.min(3000, performanceData.avgResponseTime));
                    performanceData.throughput = Math.max(10, Math.min(150, performanceData.throughput));
                    performanceData.errorRate = Math.max(0, Math.min(10, performanceData.errorRate));
                    
                    updateMetrics();
                }
            }, 5000);
        }

        // ë°ëª¨ìš© ëª© ë°ì´í„° ìƒì„±
        function generateMockData() {
            performanceData = {
                avgResponseTime: 1250,
                throughput: 45,
                errorRate: 2.3,
                bottleneckCount: 4,
                responseTimeDistribution: [25, 35, 20, 15, 8, 3],
                throughputTrend: [],
                heatmapData: [],
                bottlenecks: [
                    {
                        service: 'Payment Service',
                        avgResponseTime: 2300,
                        impact: 85,
                        description: 'Payment Serviceì˜ í‰ê·  ì‘ë‹µ ì‹œê°„ì´ 2300msë¡œ ë§¤ìš° ë†’ìŠµë‹ˆë‹¤.',
                        type: 'performance'
                    },
                    {
                        service: 'Database',
                        avgResponseTime: 1800,
                        impact: 72,
                        description: 'Database ì¿¼ë¦¬ ì‘ë‹µ ì‹œê°„ì´ 1800msë¡œ ë†’ìŠµë‹ˆë‹¤.',
                        type: 'performance'
                    },
                    {
                        service: 'Auth Service',
                        errorCount: 12,
                        impact: 65,
                        description: 'Auth Serviceì—ì„œ 12ê°œì˜ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
                        type: 'error'
                    }
                ],
                recommendations: [
                    {
                        priority: 'high',
                        title: 'ê²°ì œ ì„œë¹„ìŠ¤ ìµœì í™”',
                        description: 'ì™¸ë¶€ ê²°ì œ API í˜¸ì¶œì„ ë¹„ë™ê¸° ì²˜ë¦¬í•˜ê³ , ì‘ë‹µ ìºì‹±ì„ êµ¬í˜„í•˜ì„¸ìš”.',
                        icon: 'ğŸ’³',
                        estimatedImprovement: '40-60% ì‘ë‹µ ì‹œê°„ ë‹¨ì¶•'
                    },
                    {
                        priority: 'high',
                        title: 'ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ ìµœì í™”',
                        description: 'ì¸ë±ìŠ¤ ì¶”ê°€, ì¿¼ë¦¬ ìµœì í™”, ì»¤ë„¥ì…˜ í’€ íŠœë‹ì„ í†µí•´ ë°ì´í„°ë² ì´ìŠ¤ ì„±ëŠ¥ì„ ê°œì„ í•˜ì„¸ìš”.',
                        icon: 'ğŸ—„ï¸',
                        estimatedImprovement: '30-50% ì„±ëŠ¥ í–¥ìƒ'
                    },
                    {
                        priority: 'medium',
                        title: 'CDN ë° ìºì‹± ì „ëµ êµ¬í˜„',
                        description: 'ì •ì  ìì›ì€ CDNì„ í™œìš©í•˜ê³ , ë™ì  ì½˜í…ì¸ ëŠ” Redis ìºì‹±ì„ ì ìš©í•˜ì„¸ìš”.',
                        icon: 'ğŸŒ',
                        estimatedImprovement: '25-40% ë¡œë”© ì‹œê°„ ë‹¨ì¶•'
                    }
                ]
            };

            // ì‹œê°„ë³„ ì²˜ë¦¬ëŸ‰ íŠ¸ë Œë“œ
            for (let i = 0; i < 20; i++) {
                performanceData.throughputTrend.push({
                    time: new Date(Date.now() - (20 - i) * 60000).toLocaleTimeString(),
                    value: 45 + Math.sin(i * 0.5) * 10 + (Math.random() - 0.5) * 8
                });
            }

            // ì„œë¹„ìŠ¤ íˆíŠ¸ë§µ ë°ì´í„°
            const services = ['API Gateway', 'Auth Service', 'User Service', 'Payment Service', 'Database', 'Cache'];
            services.forEach((service, index) => {
                for (let i = 0; i < 15; i++) {
                    performanceData.heatmapData.push({
                        x: index + (Math.random() - 0.5) * 0.8,
                        y: Math.random() * 2500 + 200 + (service === 'Payment Service' ? 500 : 0),
                        service: service
                    });
                }
            });

            updateMetrics();
            updateCharts();
            updateBottleneckList();
            updateRecommendationsList();
        }

        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        function refreshData() {
            generateMockData();
            showSuccess('ë°ì´í„°ê°€ ìƒˆë¡œê³ ì¹¨ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        function clearAnalysis() {
            if (confirm('ëª¨ë“  ë¶„ì„ ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                performanceData = {};
                traceData = [];
                
                Object.values(charts).forEach(chart => {
                    chart.data.datasets.forEach(dataset => {
                        dataset.data = [];
                    });
                    chart.data.labels = [];
                    chart.update();
                });

                document.getElementById('timelineTrack').innerHTML = '';
                document.getElementById('bottleneckList').innerHTML = '<p style="text-align: center; color: #64748b; padding: 2rem;">ë¶„ì„ì„ ì‹œì‘í•˜ì—¬ ë³‘ëª© ì§€ì ì„ ì‹ë³„í•´ë³´ì„¸ìš”.</p>';
                document.getElementById('recommendationsList').innerHTML = '<p style="text-align: center; color: #64748b; padding: 2rem;">ì„±ëŠ¥ ë¶„ì„ ì™„ë£Œ í›„ ë§ì¶¤í˜• ê¶Œì¥ì‚¬í•­ì´ í‘œì‹œë©ë‹ˆë‹¤.</p>';

                showSuccess('ë¶„ì„ ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        function exportReport() {
            const reportData = {
                timestamp: new Date().toISOString(),
                metrics: performanceData,
                traces: traceData,
                recommendations: performanceData.recommendations || []
            };

            const blob = new Blob([JSON.stringify(reportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `e2e-performance-report-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);

            showSuccess('ì„±ëŠ¥ ë¶„ì„ ë¦¬í¬íŠ¸ê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        function showLoading(show) {
            document.getElementById('loadingOverlay').style.display = show ? 'flex' : 'none';
        }

        function showError(message) {
            const container = document.querySelector('.container');
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = message;
            container.insertBefore(errorDiv, container.firstChild);
            
            setTimeout(() => errorDiv.remove(), 5000);
        }

        function showSuccess(message) {
            const container = document.querySelector('.container');
            const successDiv = document.createElement('div');
            successDiv.className = 'success-message';
            successDiv.textContent = message;
            container.insertBefore(successDiv, container.firstChild);
            
            setTimeout(() => successDiv.remove(), 3000);
        }

        // ì •ë¦¬
        window.addEventListener('beforeunload', function() {
            if (analysisInterval) {
                clearInterval(analysisInterval);
            }
        });
    </script>
    </div>
</body>
</html>