<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìƒì„¸ ë©”íŠ¸ë¦­ ëŒ€ì‹œë³´ë“œ - AIRIS-MON</title>
    
    <!-- ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/components/common-layout.js"></script>
    
    <style>
        /* íˆ¬ëª… ë¼ì´íŠ¸ í…Œë§ˆ */
        :root {
            --grafana-bg: transparent;
            --grafana-panel: rgba(255, 255, 255, 0.05);
            --grafana-text: #212529;
            --grafana-text-secondary: #6c757d;
            --grafana-border: rgba(0, 0, 0, 0.1);
            --grafana-accent: #0d6efd;
            --grafana-success: #198754;
            --grafana-warning: #ffc107;
            --grafana-danger: #dc3545;
            --grafana-info: #0dcaf0;
        }

        body {
            background: var(--grafana-bg);
            color: var(--grafana-text);
            font-family: 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            margin: 0;
            padding: 0;
        }

        /* ëŒ€ì‹œë³´ë“œ í—¤ë” */
        .dashboard-header {
            background: var(--grafana-panel);
            border-bottom: 1px solid var(--grafana-border);
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .dashboard-title {
            font-size: 20px;
            font-weight: 500;
            color: var(--grafana-text);
            margin: 0;
        }

        .dashboard-controls {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .time-picker {
            background: var(--grafana-panel);
            border: 1px solid var(--grafana-border);
            color: var(--grafana-text);
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
        }

        .refresh-btn {
            background: transparent;
            color: var(--grafana-text);
            border: 1px solid var(--grafana-border);
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .refresh-btn:hover {
            background: var(--grafana-accent);
            color: white;
            border-color: var(--grafana-accent);
        }

        /* ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 16px;
            padding: 24px;
            max-width: 100%;
        }

        /* ì„¹ì…˜ í—¤ë” */
        .section-header {
            grid-column: 1 / -1;
            font-size: 18px;
            font-weight: 600;
            color: var(--grafana-text);
            padding: 12px 0;
            border-bottom: 2px solid var(--grafana-border);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-icon {
            font-size: 20px;
        }

        /* ë©”íŠ¸ë¦­ íŒ¨ë„ (Grafana ìŠ¤íƒ€ì¼) */
        .metric-panel {
            background: var(--grafana-panel);
            border: 1px solid var(--grafana-border);
            border-radius: 8px;
            padding: 0;
            position: relative;
            transition: all 0.3s ease;
            cursor: pointer;
            overflow: hidden;
        }

        .metric-panel:hover {
            border-color: var(--grafana-accent);
            box-shadow: 0 0 20px rgba(31, 119, 180, 0.3);
            transform: translateY(-2px);
        }

        .panel-header {
            padding: 12px 16px;
            border-bottom: 1px solid var(--grafana-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.02);
        }

        .panel-title {
            font-size: 14px;
            font-weight: 500;
            color: var(--grafana-text);
            margin: 0;
        }

        .panel-value {
            font-size: 16px;
            font-weight: 600;
            color: var(--grafana-success);
        }

        .panel-body {
            padding: 16px;
            height: 280px;
            position: relative;
        }

        .chart-container {
            width: 100%;
            height: 100%;
            position: relative;
        }

        .chart-canvas {
            width: 100% !important;
            height: 100% !important;
        }

        /* ìŠ¤íƒ¯ íŒ¨ë„ */
        .stat-panel {
            background: var(--grafana-panel);
            border: 1px solid var(--grafana-border);
            border-radius: 8px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .stat-panel:hover {
            border-color: var(--grafana-accent);
            transform: translateY(-2px);
        }

        .stat-value {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 8px;
            line-height: 1;
        }

        .stat-label {
            font-size: 14px;
            color: var(--grafana-text-secondary);
            margin-bottom: 4px;
        }

        .stat-change {
            font-size: 12px;
            font-weight: 500;
            padding: 2px 8px;
            border-radius: 12px;
        }

        .change-positive {
            color: var(--grafana-success);
            background: rgba(115, 191, 105, 0.1);
        }

        .change-negative {
            color: var(--grafana-danger);
            background: rgba(224, 47, 68, 0.1);
        }

        .change-neutral {
            color: var(--grafana-text-secondary);
            background: rgba(255, 255, 255, 0.1);
        }

        /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
        .loading-spinner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            border: 3px solid var(--grafana-border);
            border-top: 3px solid var(--grafana-accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        /* ëª¨ë‹¬ íŒì—… */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            z-index: 1000;
            display: none;
            backdrop-filter: blur(4px);
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 1200px;
            height: 80%;
            background: #ffffff;
            border: 1px solid var(--grafana-border);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--grafana-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #ffffff;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--grafana-text);
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--grafana-text-secondary);
            font-size: 24px;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background: rgba(0, 0, 0, 0.1);
            color: var(--grafana-text);
        }

        .modal-body {
            flex: 1;
            padding: 24px;
            display: flex;
            gap: 24px;
            overflow: auto;
            background: #ffffff;
        }

        .modal-chart {
            flex: 2;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            position: relative;
            border: 1px solid var(--grafana-border);
        }

        .modal-data {
            flex: 1;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            overflow: auto;
            border: 1px solid var(--grafana-border);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }

        .data-table th,
        .data-table td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid var(--grafana-border);
        }

        .data-table th {
            background: #e9ecef;
            font-weight: 600;
            color: var(--grafana-text);
        }

        .data-table td {
            color: var(--grafana-text-secondary);
        }

        /* ìƒíƒœ í‘œì‹œê¸° */
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-healthy { background: var(--grafana-success); }
        .status-warning { background: var(--grafana-warning); }
        .status-critical { background: var(--grafana-danger); }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .metrics-grid {
                grid-template-columns: 1fr;
                padding: 16px;
            }
            
            .modal-content {
                width: 95%;
                height: 90%;
            }
            
            .modal-body {
                flex-direction: column;
            }
            
            .dashboard-controls {
                flex-direction: column;
                gap: 8px;
            }
        }

        /* ì°¨íŠ¸ë³„ ìƒ‰ìƒ í…Œë§ˆ */
        .chart-cpu { border-left: 4px solid #ff6b6b; }
        .chart-memory { border-left: 4px solid #4ecdc4; }
        .chart-disk { border-left: 4px solid #45b7d1; }
        .chart-network { border-left: 4px solid #96ceb4; }
        .chart-app { border-left: 4px solid #feca57; }
        .chart-db { border-left: 4px solid #ff9ff3; }
        .chart-service { border-left: 4px solid #54a0ff; }
        .chart-logs { border-left: 4px solid #5f27cd; }
    </style>
</head>
<body>
    <!-- ëŒ€ì‹œë³´ë“œ í—¤ë” -->
    <div class="dashboard-header">
        <h1 class="dashboard-title">ğŸ“Š ìƒì„¸ ë©”íŠ¸ë¦­ ëŒ€ì‹œë³´ë“œ</h1>
        <div class="dashboard-controls">
            <select class="time-picker" id="timeRange">
                <option value="5m">ìµœê·¼ 5ë¶„</option>
                <option value="15m">ìµœê·¼ 15ë¶„</option>
                <option value="1h" selected>ìµœê·¼ 1ì‹œê°„</option>
                <option value="6h">ìµœê·¼ 6ì‹œê°„</option>
                <option value="24h">ìµœê·¼ 24ì‹œê°„</option>
                <option value="7d">ìµœê·¼ 7ì¼</option>
                <option value="30d">ìµœê·¼ 30ì¼</option>
            </select>
            <button class="refresh-btn" id="refreshBtn">
                ğŸ”„ ìƒˆë¡œê³ ì¹¨
            </button>
            <div style="color: var(--grafana-text-secondary); font-size: 12px;" id="lastUpdate">
                ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: --
            </div>
        </div>
    </div>

    <!-- ë©”íŠ¸ë¦­ ê·¸ë¦¬ë“œ -->
    <div class="metrics-grid">
        <!-- H/W ë©”íŠ¸ë¦­ ì„¹ì…˜ -->
        <div class="section-header">
            <span class="section-icon">ğŸ–¥ï¸</span>
            H/W ë©”íŠ¸ë¦­ (Hardware Metrics)
        </div>

        <!-- CPU ë©”íŠ¸ë¦­ -->
        <div class="metric-panel chart-cpu" onclick="openDetailModal('cpu')">
            <div class="panel-header">
                <h3 class="panel-title">CPU ì‚¬ìš©ë¥ </h3>
                <div class="panel-value" id="cpuValue">--</div>
            </div>
            <div class="panel-body">
                <div class="chart-container">
                    <canvas class="chart-canvas" id="cpuChart"></canvas>
                </div>
            </div>
        </div>

        <!-- ë©”ëª¨ë¦¬ ë©”íŠ¸ë¦­ -->
        <div class="metric-panel chart-memory" onclick="openDetailModal('memory')">
            <div class="panel-header">
                <h3 class="panel-title">ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ </h3>
                <div class="panel-value" id="memoryValue">--</div>
            </div>
            <div class="panel-body">
                <div class="chart-container">
                    <canvas class="chart-canvas" id="memoryChart"></canvas>
                </div>
            </div>
        </div>

        <!-- ë””ìŠ¤í¬ I/O -->
        <div class="metric-panel chart-disk" onclick="openDetailModal('disk')">
            <div class="panel-header">
                <h3 class="panel-title">ë””ìŠ¤í¬ I/O</h3>
                <div class="panel-value" id="diskValue">--</div>
            </div>
            <div class="panel-body">
                <div class="chart-container">
                    <canvas class="chart-canvas" id="diskChart"></canvas>
                </div>
            </div>
        </div>

        <!-- ë„¤íŠ¸ì›Œí¬ I/O -->
        <div class="metric-panel chart-network" onclick="openDetailModal('network')">
            <div class="panel-header">
                <h3 class="panel-title">ë„¤íŠ¸ì›Œí¬ I/O</h3>
                <div class="panel-value" id="networkValue">--</div>
            </div>
            <div class="panel-body">
                <div class="chart-container">
                    <canvas class="chart-canvas" id="networkChart"></canvas>
                </div>
            </div>
        </div>

        <!-- S/W ë©”íŠ¸ë¦­ ì„¹ì…˜ -->
        <div class="section-header">
            <span class="section-icon">âš™ï¸</span>
            S/W ë©”íŠ¸ë¦­ (Software Metrics)
        </div>

        <!-- ì• í”Œë¦¬ì¼€ì´ì…˜ ì„±ëŠ¥ -->
        <div class="metric-panel chart-app" onclick="openDetailModal('application')">
            <div class="panel-header">
                <h3 class="panel-title">ì• í”Œë¦¬ì¼€ì´ì…˜ ì„±ëŠ¥</h3>
                <div class="panel-value" id="applicationValue">--</div>
            </div>
            <div class="panel-body">
                <div class="chart-container">
                    <canvas class="chart-canvas" id="applicationChart"></canvas>
                </div>
            </div>
        </div>

        <!-- ë°ì´í„°ë² ì´ìŠ¤ ì„±ëŠ¥ -->
        <div class="metric-panel chart-db" onclick="openDetailModal('database')">
            <div class="panel-header">
                <h3 class="panel-title">ë°ì´í„°ë² ì´ìŠ¤ ì„±ëŠ¥</h3>
                <div class="panel-value" id="databaseValue">--</div>
            </div>
            <div class="panel-body">
                <div class="chart-container">
                    <canvas class="chart-canvas" id="databaseChart"></canvas>
                </div>
            </div>
        </div>

        <!-- ì„œë¹„ìŠ¤ ê°€ìš©ì„± -->
        <div class="metric-panel chart-service" onclick="openDetailModal('service')">
            <div class="panel-header">
                <h3 class="panel-title">ì„œë¹„ìŠ¤ ê°€ìš©ì„±</h3>
                <div class="panel-value" id="serviceValue">--</div>
            </div>
            <div class="panel-body">
                <div class="chart-container">
                    <canvas class="chart-canvas" id="serviceChart"></canvas>
                </div>
            </div>
        </div>

        <!-- JVM/ëŸ°íƒ€ì„ ë©”íŠ¸ë¦­ -->
        <div class="metric-panel chart-app" onclick="openDetailModal('jvm')">
            <div class="panel-header">
                <h3 class="panel-title">JVM/ëŸ°íƒ€ì„</h3>
                <div class="panel-value" id="jvmValue">--</div>
            </div>
            <div class="panel-body">
                <div class="chart-container">
                    <canvas class="chart-canvas" id="jvmChart"></canvas>
                </div>
            </div>
        </div>

        <!-- ë¡œê·¸ ë°ì´í„° ì„¹ì…˜ -->
        <div class="section-header">
            <span class="section-icon">ğŸ“</span>
            ë¡œê·¸ ë°ì´í„° (Log Data Metrics)
        </div>

        <!-- ì—ëŸ¬ ë¡œê·¸ -->
        <div class="metric-panel chart-logs" onclick="openDetailModal('errorLogs')">
            <div class="panel-header">
                <h3 class="panel-title">ì—ëŸ¬ ë¡œê·¸</h3>
                <div class="panel-value" id="errorLogsValue">--</div>
            </div>
            <div class="panel-body">
                <div class="chart-container">
                    <canvas class="chart-canvas" id="errorLogsChart"></canvas>
                </div>
            </div>
        </div>

        <!-- ì•¡ì„¸ìŠ¤ ë¡œê·¸ -->
        <div class="metric-panel chart-logs" onclick="openDetailModal('accessLogs')">
            <div class="panel-header">
                <h3 class="panel-title">ì•¡ì„¸ìŠ¤ ë¡œê·¸</h3>
                <div class="panel-value" id="accessLogsValue">--</div>
            </div>
            <div class="panel-body">
                <div class="chart-container">
                    <canvas class="chart-canvas" id="accessLogsChart"></canvas>
                </div>
            </div>
        </div>

        <!-- ì‹œìŠ¤í…œ ë¡œê·¸ -->
        <div class="metric-panel chart-logs" onclick="openDetailModal('systemLogs')">
            <div class="panel-header">
                <h3 class="panel-title">ì‹œìŠ¤í…œ ë¡œê·¸</h3>
                <div class="panel-value" id="systemLogsValue">--</div>
            </div>
            <div class="panel-body">
                <div class="chart-container">
                    <canvas class="chart-canvas" id="systemLogsChart"></canvas>
                </div>
            </div>
        </div>

        <!-- ë³´ì•ˆ ë¡œê·¸ -->
        <div class="metric-panel chart-logs" onclick="openDetailModal('securityLogs')">
            <div class="panel-header">
                <h3 class="panel-title">ë³´ì•ˆ ë¡œê·¸</h3>
                <div class="panel-value" id="securityLogsValue">--</div>
            </div>
            <div class="panel-body">
                <div class="chart-container">
                    <canvas class="chart-canvas" id="securityLogsChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- ìƒì„¸ ëª¨ë‹¬ íŒì—… -->
    <div class="modal-overlay" id="detailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">ë©”íŠ¸ë¦­ ìƒì„¸ ì •ë³´</h2>
                <button class="modal-close" onclick="closeDetailModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="modal-chart">
                    <canvas id="modalChart"></canvas>
                </div>
                <div class="modal-data">
                    <h3 style="margin-top: 0; color: var(--grafana-text);">ì‹¤ì‹œê°„ ë°ì´í„°</h3>
                    <table class="data-table" id="modalDataTable">
                        <thead>
                            <tr>
                                <th>ì‹œê°„</th>
                                <th>ê°’</th>
                                <th>ìƒíƒœ</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let charts = {};
        let modalChart = null;
        let updateInterval = null;
        let currentMetric = null;

        // ë©”íŠ¸ë¦­ ì„¤ì • (ë¨¼ì € ì„ ì–¸)
        const metricConfigs = {
            cpu: {
                title: 'CPU ì‚¬ìš©ë¥ ',
                unit: '%',
                color: '#ff6b6b',
                threshold: { warning: 70, critical: 90 },
                api: '/api/analytics/infra-metrics?metric=cpu'
            },
            memory: {
                title: 'ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ ',
                unit: '%',
                color: '#4ecdc4',
                threshold: { warning: 80, critical: 95 },
                api: '/api/analytics/infra-metrics?metric=memory'
            },
            disk: {
                title: 'ë””ìŠ¤í¬ I/O',
                unit: 'MB/s',
                color: '#45b7d1',
                threshold: { warning: 100, critical: 200 },
                api: '/api/analytics/infra-metrics?metric=disk'
            },
            network: {
                title: 'ë„¤íŠ¸ì›Œí¬ I/O',
                unit: 'Mbps',
                color: '#96ceb4',
                threshold: { warning: 800, critical: 950 },
                api: '/api/analytics/network-metrics'
            },
            application: {
                title: 'ì• í”Œë¦¬ì¼€ì´ì…˜ ì„±ëŠ¥',
                unit: 'ms',
                color: '#feca57',
                threshold: { warning: 500, critical: 1000 },
                api: '/api/analytics/app-metrics'
            },
            database: {
                title: 'ë°ì´í„°ë² ì´ìŠ¤ ì„±ëŠ¥',
                unit: 'ms',
                color: '#ff9ff3',
                threshold: { warning: 200, critical: 500 },
                api: '/api/analytics/db-metrics'
            },
            service: {
                title: 'ì„œë¹„ìŠ¤ ê°€ìš©ì„±',
                unit: '%',
                color: '#54a0ff',
                threshold: { warning: 99, critical: 95 },
                api: '/api/analytics/service-metrics'
            },
            jvm: {
                title: 'JVM ë©”ëª¨ë¦¬',
                unit: 'MB',
                color: '#feca57',
                threshold: { warning: 1024, critical: 2048 },
                api: '/api/analytics/jvm-metrics'
            },
            errorLogs: {
                title: 'ì—ëŸ¬ ë¡œê·¸',
                unit: 'ê±´/ë¶„',
                color: '#5f27cd',
                threshold: { warning: 10, critical: 50 },
                api: '/api/analytics/error-logs'
            },
            accessLogs: {
                title: 'ì•¡ì„¸ìŠ¤ ë¡œê·¸',
                unit: 'ìš”ì²­/ë¶„',
                color: '#5f27cd',
                threshold: { warning: 1000, critical: 5000 },
                api: '/api/analytics/access-logs'
            },
            systemLogs: {
                title: 'ì‹œìŠ¤í…œ ë¡œê·¸',
                unit: 'ê±´/ë¶„',
                color: '#5f27cd',
                threshold: { warning: 100, critical: 500 },
                api: '/api/analytics/system-logs'
            },
            securityLogs: {
                title: 'ë³´ì•ˆ ë¡œê·¸',
                unit: 'ì´ë²¤íŠ¸/ë¶„',
                color: '#5f27cd',
                threshold: { warning: 5, critical: 20 },
                api: '/api/analytics/security-logs'
            }
        };

        // Chart.js ê¸€ë¡œë²Œ ì„¤ì • í•¨ìˆ˜ (Grafana ìŠ¤íƒ€ì¼)
        function setupChartDefaults() {
            try {
                console.log('ğŸ¨ Chart.js ë²„ì „:', Chart.version);
                
                // Chart.js 2.x vs 3.x vs 4.x ë²„ì „ í˜¸í™˜ì„± ì²˜ë¦¬
                const majorVersion = parseInt(Chart.version.split('.')[0]);
                
                if (majorVersion >= 3) {
                    // Chart.js 3.x ì´ìƒ
                    Chart.defaults.color = '#c9d1d9';
                    
                    if (Chart.defaults.plugins && Chart.defaults.plugins.legend) {
                        Chart.defaults.plugins.legend.display = false;
                    }
                    
                    // v3+ ë°©ì‹ (ì§ì ‘ ì„¤ì •í•˜ì§€ ì•Šê³  getChartConfigì—ì„œ ì²˜ë¦¬)
                    console.log('âœ… Chart.js v3+ ê¸€ë¡œë²Œ ì„¤ì • ì™„ë£Œ');
                } else {
                    // Chart.js 2.x
                    Chart.defaults.global.defaultColor = '#c9d1d9';
                    Chart.defaults.global.legend.display = false;
                    
                    if (Chart.defaults.global.elements) {
                        Chart.defaults.global.elements.line.borderColor = '#3b82f6';
                        Chart.defaults.global.elements.point.backgroundColor = '#3b82f6';
                    }
                    
                    console.log('âœ… Chart.js v2.x ê¸€ë¡œë²Œ ì„¤ì • ì™„ë£Œ');
                }
                
            } catch (error) {
                console.warn('âš ï¸ Chart.js ê¸€ë¡œë²Œ ì„¤ì • ì‹¤íŒ¨:', error.message);
                console.log('ğŸ“ Chart.js ê°œë³„ ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ìŠ¤íƒ€ì¼ ì ìš© ì˜ˆì •');
            }
        }

        // í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±
        function generateTestData(count = 50, type = 'cpu') {
            const data = [];
            const now = Date.now();
            const baseValue = type === 'service' ? 99.5 : type === 'errorLogs' ? 5 : 50;
            
            for (let i = count - 1; i >= 0; i--) {
                const timestamp = new Date(now - i * 60000);
                let value;
                
                switch(type) {
                    case 'cpu':
                    case 'memory':
                        value = Math.max(0, Math.min(100, baseValue + Math.sin(i * 0.1) * 20 + (Math.random() - 0.5) * 15));
                        break;
                    case 'disk':
                    case 'network':
                        value = Math.max(0, baseValue * 2 + Math.sin(i * 0.1) * 30 + (Math.random() - 0.5) * 20);
                        break;
                    case 'application':
                    case 'database':
                        value = Math.max(10, 200 + Math.sin(i * 0.1) * 100 + (Math.random() - 0.5) * 50);
                        break;
                    case 'service':
                        value = Math.max(95, Math.min(100, 99.5 + (Math.random() - 0.5) * 3));
                        break;
                    case 'jvm':
                        value = Math.max(100, 800 + Math.sin(i * 0.1) * 200 + (Math.random() - 0.5) * 100);
                        break;
                    case 'errorLogs':
                    case 'accessLogs':
                    case 'systemLogs':
                    case 'securityLogs':
                        value = Math.max(0, baseValue + Math.sin(i * 0.1) * 10 + (Math.random() - 0.5) * 8);
                        break;
                    default:
                        value = Math.max(0, baseValue + (Math.random() - 0.5) * 20);
                }
                
                data.push({
                    timestamp: timestamp,
                    value: parseFloat(value.toFixed(2))
                });
            }
            return data;
        }

        // Chart.js ë²„ì „ í˜¸í™˜ì„± í•¨ìˆ˜
        function getCompatibleScales(config) {
            try {
                const majorVersion = parseInt(Chart.version.split('.')[0]);
                
                if (majorVersion >= 3) {
                    // Chart.js 3.x+ ë°©ì‹
                    return {
                        x: {
                            display: true,
                            grid: {
                                display: true,
                                color: 'rgba(0, 0, 0, 0.1)'
                            },
                            ticks: {
                                maxTicksLimit: 6,
                                color: '#6c757d'
                            }
                        },
                        y: {
                            display: true,
                            grid: {
                                display: true,
                                color: 'rgba(0, 0, 0, 0.1)'
                            },
                            ticks: {
                                color: '#6c757d',
                                callback: function(value) {
                                    return value + config.unit;
                                }
                            }
                        }
                    };
                } else {
                    // Chart.js 2.x ë°©ì‹
                    return {
                        xAxes: [{
                            display: true,
                            gridLines: {
                                display: true,
                                color: 'rgba(0, 0, 0, 0.1)'
                            },
                            ticks: {
                                maxTicksLimit: 6,
                                fontColor: '#6c757d'
                            }
                        }],
                        yAxes: [{
                            display: true,
                            gridLines: {
                                display: true,
                                color: 'rgba(0, 0, 0, 0.1)'
                            },
                            ticks: {
                                fontColor: '#6c757d',
                                callback: function(value) {
                                    return value + config.unit;
                                }
                            }
                        }]
                    };
                }
            } catch (error) {
                console.warn('âš ï¸ ìŠ¤ì¼€ì¼ ì„¤ì • ì‹¤íŒ¨, ê¸°ë³¸ê°’ ì‚¬ìš©:', error.message);
                return {};
            }
        }

        // ì°¨íŠ¸ ìƒì„±
        function createChart(canvasId, metricType) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return null;

            const config = metricConfigs[metricType];
            const data = generateTestData(30, metricType);
            
            const chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(d => d.timestamp.toLocaleTimeString()),
                    datasets: [{
                        data: data.map(d => d.value),
                        borderColor: config.color,
                        backgroundColor: config.color + '20',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0,
                        pointHoverRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    scales: getCompatibleScales(config),
                    plugins: {
                        tooltip: {
                            backgroundColor: 'rgba(255, 255, 255, 0.95)',
                            titleColor: '#212529',
                            bodyColor: '#6c757d',
                            borderColor: config.color,
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    return config.title + ': ' + context.parsed.y + config.unit;
                                }
                            }
                        }
                    }
                }
            });

            // ê°’ ì—…ë°ì´íŠ¸
            const latest = data[data.length - 1];
            const valueElement = document.getElementById(metricType + 'Value');
            if (valueElement) {
                valueElement.textContent = latest.value + config.unit;
                
                // ìƒíƒœì— ë”°ë¥¸ ìƒ‰ìƒ ë³€ê²½
                if (latest.value >= config.threshold.critical) {
                    valueElement.style.color = '#e02f44';
                } else if (latest.value >= config.threshold.warning) {
                    valueElement.style.color = '#ff9830';
                } else {
                    valueElement.style.color = '#73bf69';
                }
            }

            return chart;
        }

        // ëª¨ë“  ì°¨íŠ¸ ì´ˆê¸°í™”
        function initializeCharts() {
            console.log('ğŸ“Š ì°¨íŠ¸ ì´ˆê¸°í™” ì‹œì‘...');
            
            Object.keys(metricConfigs).forEach(metricType => {
                const chartId = metricType + 'Chart';
                charts[metricType] = createChart(chartId, metricType);
            });
            
            console.log('âœ… ëª¨ë“  ì°¨íŠ¸ ì´ˆê¸°í™” ì™„ë£Œ');
            updateLastUpdateTime();
        }

        // ëª¨ë“  ë©”íŠ¸ë¦­ ìƒˆë¡œê³ ì¹¨
        async function refreshAllMetrics() {
            console.log('ğŸ”„ ë©”íŠ¸ë¦­ ìƒˆë¡œê³ ì¹¨ ì‹œì‘...');
            
            Object.keys(metricConfigs).forEach(metricType => {
                if (charts[metricType]) {
                    const data = generateTestData(30, metricType);
                    const chart = charts[metricType];
                    
                    // ì°¨íŠ¸ ë°ì´í„° ì—…ë°ì´íŠ¸
                    chart.data.labels = data.map(d => d.timestamp.toLocaleTimeString());
                    chart.data.datasets[0].data = data.map(d => d.value);
                    chart.update('none');
                    
                    // ê°’ ì—…ë°ì´íŠ¸
                    const latest = data[data.length - 1];
                    const valueElement = document.getElementById(metricType + 'Value');
                    if (valueElement) {
                        valueElement.textContent = latest.value + metricConfigs[metricType].unit;
                        
                        // ìƒíƒœì— ë”°ë¥¸ ìƒ‰ìƒ ë³€ê²½
                        const config = metricConfigs[metricType];
                        if (latest.value >= config.threshold.critical) {
                            valueElement.style.color = '#e02f44';
                        } else if (latest.value >= config.threshold.warning) {
                            valueElement.style.color = '#ff9830';
                        } else {
                            valueElement.style.color = '#73bf69';
                        }
                    }
                }
            });
            
            updateLastUpdateTime();
            console.log('âœ… ë©”íŠ¸ë¦­ ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ');
        }

        // ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„ ê°±ì‹ 
        function updateLastUpdateTime() {
            const now = new Date();
            const timeString = now.toLocaleString('ko-KR');
            document.getElementById('lastUpdate').textContent = `ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${timeString}`;
        }

        // ìƒì„¸ ëª¨ë‹¬ ì—´ê¸°
        function openDetailModal(metricType) {
            currentMetric = metricType;
            const config = metricConfigs[metricType];
            
            // ëª¨ë‹¬ ì œëª© ì„¤ì •
            document.getElementById('modalTitle').textContent = config.title + ' ìƒì„¸ ì •ë³´';
            
            // ëª¨ë‹¬ ì°¨íŠ¸ ìƒì„±
            const modalCanvas = document.getElementById('modalChart');
            const ctx = modalCanvas.getContext('2d');
            
            // ê¸°ì¡´ ì°¨íŠ¸ ì œê±°
            if (modalChart) {
                modalChart.destroy();
            }
            
            // ë” ë§ì€ ë°ì´í„°ë¡œ ìƒì„¸ ì°¨íŠ¸ ìƒì„±
            const detailData = generateTestData(100, metricType);
            
            modalChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: detailData.map(d => d.timestamp.toLocaleTimeString()),
                    datasets: [{
                        label: config.title,
                        data: detailData.map(d => d.value),
                        borderColor: config.color,
                        backgroundColor: config.color + '10',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.3,
                        pointRadius: 1,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    scales: getCompatibleScales(config),
                    plugins: {
                        legend: {
                            display: true,
                            labels: {
                                color: '#c9d1d9'
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#fff',
                            bodyColor: '#c9d1d9',
                            borderColor: config.color,
                            borderWidth: 1
                        }
                    }
                }
            });
            
            // ë°ì´í„° í…Œì´ë¸” ì—…ë°ì´íŠ¸
            updateModalDataTable(detailData, config);
            
            // ëª¨ë‹¬ í‘œì‹œ
            document.getElementById('detailModal').style.display = 'block';
        }

        // ëª¨ë‹¬ ë°ì´í„° í…Œì´ë¸” ì—…ë°ì´íŠ¸
        function updateModalDataTable(data, config) {
            const tbody = document.querySelector('#modalDataTable tbody');
            tbody.innerHTML = '';
            
            // ìµœê·¼ 20ê°œ ë°ì´í„°ë§Œ í‘œì‹œ
            const recentData = data.slice(-20);
            
            recentData.forEach(item => {
                const row = document.createElement('tr');
                const status = getStatus(item.value, config.threshold);
                
                row.innerHTML = `
                    <td>${item.timestamp.toLocaleTimeString()}</td>
                    <td>${item.value}${config.unit}</td>
                    <td>
                        <span class="status-indicator status-${status}"></span>
                        ${status === 'healthy' ? 'ì •ìƒ' : status === 'warning' ? 'ê²½ê³ ' : 'ìœ„í—˜'}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // ìƒíƒœ íŒì •
        function getStatus(value, threshold) {
            if (value >= threshold.critical) return 'critical';
            if (value >= threshold.warning) return 'warning';
            return 'healthy';
        }

        // ìƒì„¸ ëª¨ë‹¬ ë‹«ê¸°
        function closeDetailModal() {
            document.getElementById('detailModal').style.display = 'none';
            if (modalChart) {
                modalChart.destroy();
                modalChart = null;
            }
            currentMetric = null;
        }

        // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì‹œì‘
        function startRealTimeUpdates() {
            updateInterval = setInterval(() => {
                refreshAllMetrics();
                
                // ëª¨ë‹¬ì´ ì—´ë ¤ìˆìœ¼ë©´ ëª¨ë‹¬ ì°¨íŠ¸ë„ ì—…ë°ì´íŠ¸
                if (currentMetric && modalChart) {
                    const newData = generateTestData(100, currentMetric);
                    modalChart.data.labels = newData.map(d => d.timestamp.toLocaleTimeString());
                    modalChart.data.datasets[0].data = newData.map(d => d.value);
                    modalChart.update('none');
                    
                    updateModalDataTable(newData, metricConfigs[currentMetric]);
                }
            }, 5000); // 5ì´ˆë§ˆë‹¤ ì—…ë°ì´íŠ¸
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ ìƒì„¸ ë©”íŠ¸ë¦­ ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™”...');
            
            // Chart.js ë¡œë“œ í™•ì¸
            if (typeof Chart === 'undefined') {
                console.error('âŒ Chart.jsê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!');
                return;
            }
            
            // Chart.js ê¸€ë¡œë²Œ ì„¤ì • ì ìš©
            setupChartDefaults();
            console.log('âœ… Chart.js ì„¤ì • ì™„ë£Œ');
            
            // ì°¨íŠ¸ ì´ˆê¸°í™”
            setTimeout(() => {
                initializeCharts();
                startRealTimeUpdates();
            }, 500);
            
            // ëª¨ë‹¬ í´ë¦­ ì´ë²¤íŠ¸ (ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°)
            document.getElementById('detailModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeDetailModal();
                }
            });
            
            // ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.getElementById('refreshBtn').addEventListener('click', function() {
                refreshAllMetrics();
            });
            
            // ì‹œê°„ ë²”ìœ„ ë³€ê²½ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.getElementById('timeRange').addEventListener('change', function() {
                console.log('â±ï¸ ì‹œê°„ ë²”ìœ„ ë³€ê²½:', this.value);
                refreshAllMetrics();
            });
            
            // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && document.getElementById('detailModal').style.display === 'block') {
                    closeDetailModal();
                }
            });
            
            console.log('âœ… ìƒì„¸ ë©”íŠ¸ë¦­ ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™” ì™„ë£Œ');
        });

        // í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ì •ë¦¬
        window.addEventListener('beforeunload', function() {
            if (updateInterval) {
                clearInterval(updateInterval);
            }
            Object.values(charts).forEach(chart => {
                if (chart) chart.destroy();
            });
            if (modalChart) {
                modalChart.destroy();
            }
        });
    </script>
</body>
</html>