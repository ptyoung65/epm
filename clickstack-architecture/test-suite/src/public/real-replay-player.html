<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¬ ì‹¤ì œ DOM ê¸°ë°˜ ì„¸ì…˜ ë¦¬í”Œë ˆì´ í”Œë ˆì´ì–´</title>
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    
    <!-- rrweb-player CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/rrweb-player@1/dist/style.css">
    
    <!-- rrweb ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdn.jsdelivr.net/npm/rrweb@2/dist/rrweb.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/rrweb-player@1/dist/index.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .header p {
            color: #7f8c8d;
            font-size: 1.1rem;
        }
        
        .player-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
        }
        
        .session-selector {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 15px;
            margin-bottom: 20px;
            align-items: end;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            margin-bottom: 5px;
            font-weight: bold;
            color: #495057;
        }
        
        .form-control {
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #007bff;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0056b3;
        }
        
        .btn-primary:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .player-container {
            margin: 20px 0;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            overflow: hidden;
            min-height: 600px;
            background: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .player-placeholder {
            text-align: center;
            color: #6c757d;
            font-size: 1.2rem;
        }
        
        .session-info {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .info-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .info-label {
            font-size: 0.9rem;
            color: #6c757d;
            margin-bottom: 5px;
        }
        
        .info-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .events-panel {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
            max-height: 600px;
            overflow-y: auto;
        }
        
        .events-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .event-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #007bff;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .event-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }
        
        .event-item.active {
            background: #e3f2fd;
            border-left-color: #2196f3;
        }
        
        .event-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .event-type {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .event-timestamp {
            font-size: 0.9rem;
            color: #6c757d;
        }
        
        .event-details {
            font-size: 0.9rem;
            color: #495057;
            line-height: 1.4;
        }
        
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 200px;
            color: #6c757d;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .controls-panel {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .rrweb-player {
            width: 100% !important;
            height: 600px !important;
        }
        
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .alert-info {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            color: #1565c0;
        }
        
        .alert-warning {
            background: #fff3cd;
            border: 1px solid #ffc107;
            color: #856404;
        }
        
        .alert-danger {
            background: #f8d7da;
            border: 1px solid #dc3545;
            color: #721c24;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #6c757d;
        }
        
        @keyframes clickPulse {
            0% {
                transform: scale(0);
                opacity: 1;
            }
            50% {
                transform: scale(1.5);
                opacity: 0.7;
            }
            100% {
                transform: scale(2);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¬ ì‹¤ì œ DOM ê¸°ë°˜ ì„¸ì…˜ ë¦¬í”Œë ˆì´ í”Œë ˆì´ì–´</h1>
            <p>rrweb-playerë¥¼ ì‚¬ìš©í•œ ì‹¤ì œ ì‚¬ìš©ì ìƒí˜¸ì‘ìš© ì¬ìƒ ë° ë¶„ì„</p>
        </div>

        <!-- ì„¸ì…˜ ì„ íƒ ì„¹ì…˜ -->
        <div class="player-section">
            <h3>ğŸ“‹ ì„¸ì…˜ ì„ íƒ</h3>
            <div class="session-selector">
                <div class="form-group">
                    <label for="scenarioSelect">ì‹œë‚˜ë¦¬ì˜¤</label>
                    <select id="scenarioSelect" class="form-control">
                        <option value="">ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="ecommerce_checkout">ğŸ›’ E-commerce ê²°ì œ í”Œë¡œìš°</option>
                        <option value="saas_dashboard">ğŸ“Š SaaS ëŒ€ì‹œë³´ë“œ ìƒí˜¸ì‘ìš©</option>
                        <option value="form_validation">ğŸ“ í¼ ê²€ì¦ ë° ì‚¬ìš©ì í”¼ë“œë°±</option>
                        <option value="mobile_responsive">ğŸ“± ëª¨ë°”ì¼ ë°˜ì‘í˜• ìƒí˜¸ì‘ìš©</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="sessionSelect">ì„¸ì…˜</label>
                    <select id="sessionSelect" class="form-control" disabled>
                        <option value="">ë¨¼ì € ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                    </select>
                </div>
                <button id="loadSessionBtn" class="btn btn-primary" disabled>
                    ğŸ¬ ì„¸ì…˜ ë¡œë“œ
                </button>
            </div>
        </div>

        <!-- ì„¸ì…˜ ì •ë³´ ì„¹ì…˜ -->
        <div class="session-info" id="sessionInfoPanel" style="display: none;">
            <h3>ğŸ“Š ì„¸ì…˜ ì •ë³´</h3>
            <div class="info-grid" id="sessionInfoGrid">
                <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§ -->
            </div>
        </div>

        <!-- í†µê³„ ì„¹ì…˜ -->
        <div class="player-section" id="statsPanel" style="display: none;">
            <h3>ğŸ“ˆ ì„¸ì…˜ í†µê³„</h3>
            <div class="stats-grid" id="sessionStats">
                <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§ -->
            </div>
        </div>

        <!-- í”Œë ˆì´ì–´ ì„¹ì…˜ -->
        <div class="player-section">
            <h3>ğŸ® ë¦¬í”Œë ˆì´ í”Œë ˆì´ì–´</h3>
            <div class="controls-panel">
                <button id="playBtn" class="btn btn-success" disabled>â–¶ï¸ ì¬ìƒ</button>
                <button id="pauseBtn" class="btn btn-warning" disabled>â¸ï¸ ì¼ì‹œì •ì§€</button>
                <button id="restartBtn" class="btn btn-primary" disabled>ğŸ”„ ì²˜ìŒë¶€í„°</button>
                <button id="downloadBtn" class="btn btn-danger" disabled>ğŸ’¾ ì„¸ì…˜ ë‹¤ìš´ë¡œë“œ</button>
            </div>
            
            <div class="player-container" id="playerContainer">
                <div class="player-placeholder" id="playerPlaceholder">
                    <div>ğŸ¬ ì„¸ì…˜ì„ ì„ íƒí•˜ê³  ë¡œë“œí•˜ë©´ ë¦¬í”Œë ˆì´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ë¡œë”© ëª¨ë‹¬ -->
    <div id="loadingModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 10px; text-align: center;">
            <div class="loading-spinner"></div>
            <div>ì„¸ì…˜ ë°ì´í„°ë¥¼ ë¡œë“œí•˜ëŠ” ì¤‘...</div>
        </div>
    </div>

    <script>
        class RealReplayPlayer {
            constructor() {
                this.currentSession = null;
                this.rrwebEvents = [];
                this.player = null;
                this.isLoading = false;
                
                this.initializeElements();
                this.bindEvents();
                this.checkUrlParameters();
            }
            
            initializeElements() {
                this.scenarioSelect = document.getElementById('scenarioSelect');
                this.sessionSelect = document.getElementById('sessionSelect');
                this.loadSessionBtn = document.getElementById('loadSessionBtn');
                this.playerContainer = document.getElementById('playerContainer');
                this.playerPlaceholder = document.getElementById('playerPlaceholder');
                this.sessionInfoPanel = document.getElementById('sessionInfoPanel');
                this.sessionInfoGrid = document.getElementById('sessionInfoGrid');
                this.statsPanel = document.getElementById('statsPanel');
                this.sessionStats = document.getElementById('sessionStats');
                this.loadingModal = document.getElementById('loadingModal');
                
                // ì»¨íŠ¸ë¡¤ ë²„íŠ¼ë“¤
                this.playBtn = document.getElementById('playBtn');
                this.pauseBtn = document.getElementById('pauseBtn');
                this.restartBtn = document.getElementById('restartBtn');
                this.downloadBtn = document.getElementById('downloadBtn');
            }
            
            bindEvents() {
                this.scenarioSelect.addEventListener('change', () => this.onScenarioChange());
                this.sessionSelect.addEventListener('change', () => this.onSessionChange());
                this.loadSessionBtn.addEventListener('click', () => this.loadSession());
                
                this.playBtn.addEventListener('click', () => this.play());
                this.pauseBtn.addEventListener('click', () => this.pause());
                this.restartBtn.addEventListener('click', () => this.restart());
                this.downloadBtn.addEventListener('click', () => this.downloadSession());
            }
            
            checkUrlParameters() {
                const urlParams = new URLSearchParams(window.location.search);
                const sessionId = urlParams.get('session');
                
                if (sessionId) {
                    console.log(`URLì—ì„œ ì„¸ì…˜ ID ê°ì§€: ${sessionId}`);
                    this.loadSessionById(sessionId);
                }
            }
            
            async onScenarioChange() {
                const scenario = this.scenarioSelect.value;
                this.sessionSelect.innerHTML = '<option value="">ë¡œë”© ì¤‘...</option>';
                this.sessionSelect.disabled = true;
                
                if (scenario) {
                    try {
                        const response = await fetch(`/api/session-replay/sessions/${scenario}`);
                        const data = await response.json();
                        
                        if (data.success && data.sessions && data.sessions.length > 0) {
                            this.sessionSelect.innerHTML = '<option value="">ì„¸ì…˜ì„ ì„ íƒí•˜ì„¸ìš”</option>';
                            data.sessions.forEach(session => {
                                const option = document.createElement('option');
                                option.value = session.id;
                                option.textContent = `${session.id.substr(0,8)}... (${this.formatDuration(session.duration)}) - ${session.eventCount}ê°œ ì´ë²¤íŠ¸`;
                                this.sessionSelect.appendChild(option);
                            });
                            this.sessionSelect.disabled = false;
                        } else {
                            this.sessionSelect.innerHTML = '<option value="">ì‚¬ìš© ê°€ëŠ¥í•œ ì„¸ì…˜ì´ ì—†ìŠµë‹ˆë‹¤</option>';
                        }
                    } catch (error) {
                        console.error('ì„¸ì…˜ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
                        this.sessionSelect.innerHTML = '<option value="">ì„¸ì…˜ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨</option>';
                    }
                } else {
                    this.sessionSelect.innerHTML = '<option value="">ë¨¼ì € ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';
                }
                
                this.updateLoadButton();
            }
            
            onSessionChange() {
                this.updateLoadButton();
            }
            
            updateLoadButton() {
                const hasScenario = this.scenarioSelect.value;
                const hasSession = this.sessionSelect.value;
                this.loadSessionBtn.disabled = !hasScenario || !hasSession;
            }
            
            async loadSession() {
                const sessionId = this.sessionSelect.value;
                if (!sessionId) return;
                
                await this.loadSessionById(sessionId);
            }
            
            async loadSessionById(sessionId) {
                this.showLoading(true);
                
                try {
                    const response = await fetch(`/api/session-replay/session/${sessionId}`);
                    const data = await response.json();
                    
                    if (data.success) {
                        this.currentSession = data.session;
                        this.rrwebEvents = this.extractRrwebEvents(data.events);
                        
                        if (this.rrwebEvents.length === 0) {
                            throw new Error('ì´ ì„¸ì…˜ì—ëŠ” rrweb ì´ë²¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤. ì‹¤ì œ DOM ê¸°ë°˜ ì„¸ì…˜ì´ ì•„ë‹™ë‹ˆë‹¤.');
                        }
                        
                        this.updateSessionInfo();
                        this.updateSessionStats();
                        this.initializePlayer();
                        
                        console.log(`âœ… ì„¸ì…˜ ë¡œë“œ ì™„ë£Œ: ${sessionId} (${this.rrwebEvents.length}ê°œ rrweb ì´ë²¤íŠ¸)`);
                    } else {
                        throw new Error(data.error || 'ì„¸ì…˜ì„ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                    }
                } catch (error) {
                    console.error('ì„¸ì…˜ ë¡œë“œ ì‹¤íŒ¨:', error);
                    this.showAlert('ì„¸ì…˜ì„ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + error.message, 'danger');
                } finally {
                    this.showLoading(false);
                }
            }
            
            extractRrwebEvents(events) {
                const rrwebEvents = [];
                const basicEvents = [];
                
                events.forEach(event => {
                    if (event.type === 'rrweb_event' && event.originalEvent) {
                        rrwebEvents.push(event.originalEvent);
                    } else if (event.type === 'click' || event.type === 'input' || event.type === 'scroll' || event.type === 'page_load') {
                        // ê¸°ë³¸ ì´ë²¤íŠ¸ ì²˜ë¦¬
                        basicEvents.push(event);
                    }
                });
                
                // rrweb ì´ë²¤íŠ¸ê°€ ìˆìœ¼ë©´ ìš°ì„  ì‚¬ìš©, ì—†ìœ¼ë©´ ê¸°ë³¸ ì´ë²¤íŠ¸ ì‚¬ìš©
                if (rrwebEvents.length > 0) {
                    return rrwebEvents.sort((a, b) => a.timestamp - b.timestamp);
                } else {
                    console.log('rrweb ì´ë²¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤. ê¸°ë³¸ ì´ë²¤íŠ¸ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤:', basicEvents.length);
                    return basicEvents.sort((a, b) => a.timestamp - b.timestamp);
                }
            }
            
            updateSessionInfo() {
                const session = this.currentSession;
                
                this.sessionInfoGrid.innerHTML = `
                    <div class="info-item">
                        <div class="info-label">ì„¸ì…˜ ID</div>
                        <div class="info-value">${session.id.substr(0, 8)}...</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">ì‹œë‚˜ë¦¬ì˜¤</div>
                        <div class="info-value">${this.getScenarioName(session.scenario)}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">ì‹œì‘ ì‹œê°„</div>
                        <div class="info-value">${new Date(session.startTime).toLocaleString()}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">ì†Œìš” ì‹œê°„</div>
                        <div class="info-value">${this.formatDuration(session.duration)}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">ì´ ì´ë²¤íŠ¸</div>
                        <div class="info-value">${session.events.length}ê°œ</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">DOM ì´ë²¤íŠ¸</div>
                        <div class="info-value">${this.rrwebEvents.length}ê°œ</div>
                    </div>
                `;
                
                this.sessionInfoPanel.style.display = 'block';
            }
            
            updateSessionStats() {
                const rrwebEventTypes = {};
                this.rrwebEvents.forEach(event => {
                    const type = this.getRrwebEventTypeName(event.type);
                    rrwebEventTypes[type] = (rrwebEventTypes[type] || 0) + 1;
                });
                
                let statsHtml = '';
                Object.entries(rrwebEventTypes).forEach(([type, count]) => {
                    statsHtml += `
                        <div class="stat-card">
                            <div class="stat-value">${count}</div>
                            <div class="stat-label">${type}</div>
                        </div>
                    `;
                });
                
                this.sessionStats.innerHTML = statsHtml;
                this.statsPanel.style.display = 'block';
            }
            
            initializePlayer() {
                // ë¼ì´ë¸ŒëŸ¬ë¦¬ í™•ì¸
                console.log('rrweb ì‚¬ìš© ê°€ëŠ¥:', typeof rrweb !== 'undefined');
                console.log('rrwebPlayer ì‚¬ìš© ê°€ëŠ¥:', typeof rrwebPlayer !== 'undefined');
                console.log('ì´ë²¤íŠ¸ ìˆ˜:', this.rrwebEvents.length);
                console.log('ì´ë²¤íŠ¸ ìƒ˜í”Œ:', this.rrwebEvents.slice(0, 3));
                
                if (this.rrwebEvents.length === 0) {
                    throw new Error('ì¬ìƒí•  ì´ë²¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                // ê¸°ì¡´ í”Œë ˆì´ì–´ê°€ ìˆë‹¤ë©´ ì œê±°
                if (this.player) {
                    this.playerContainer.innerHTML = '';
                    this.player = null;
                }
                
                this.playerPlaceholder.style.display = 'none';
                
                try {
                    // rrweb ì´ë²¤íŠ¸ê°€ ìˆê³  í”Œë ˆì´ì–´ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ìˆìœ¼ë©´ rrweb-player ì‚¬ìš©
                    if (typeof rrwebPlayer !== 'undefined' && this.rrwebEvents[0].type !== undefined && typeof this.rrwebEvents[0].type === 'number') {
                        console.log('rrweb-player ì´ˆê¸°í™” ì‹œë„...');
                        this.player = new rrwebPlayer({
                            target: this.playerContainer,
                            props: {
                                events: this.rrwebEvents,
                                width: this.playerContainer.clientWidth - 40,
                                height: 600,
                                autoPlay: false,
                                speedOption: [1, 2, 4, 8],
                                showController: true,
                                tags: {
                                    'session-id': this.currentSession.id,
                                    'scenario': this.currentSession.scenario
                                }
                            }
                        });
                        console.log('âœ… rrweb-player ì´ˆê¸°í™” ì™„ë£Œ');
                    } else {
                        // ê¸°ë³¸ ì´ë²¤íŠ¸ í”Œë ˆì´ì–´ ì‚¬ìš©
                        console.log('ê¸°ë³¸ ì´ë²¤íŠ¸ í”Œë ˆì´ì–´ ì´ˆê¸°í™”...');
                        this.initializeBasicPlayer();
                        console.log('âœ… ê¸°ë³¸ ì´ë²¤íŠ¸ í”Œë ˆì´ì–´ ì´ˆê¸°í™” ì™„ë£Œ');
                    }
                    
                    // ì»¨íŠ¸ë¡¤ ë²„íŠ¼ í™œì„±í™”
                    this.playBtn.disabled = false;
                    this.pauseBtn.disabled = false;
                    this.restartBtn.disabled = false;
                    this.downloadBtn.disabled = false;
                    
                    console.log('âœ… rrweb-player ì´ˆê¸°í™” ì™„ë£Œ');
                } catch (error) {
                    console.error('í”Œë ˆì´ì–´ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                    this.showAlert('í”Œë ˆì´ì–´ë¥¼ ì´ˆê¸°í™”í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + error.message, 'danger');
                    this.playerPlaceholder.style.display = 'block';
                    this.playerPlaceholder.innerHTML = `
                        <div>âŒ í”Œë ˆì´ì–´ ì´ˆê¸°í™” ì‹¤íŒ¨</div>
                        <div style="font-size: 0.9rem; margin-top: 10px; color: #666;">
                            ${error.message}
                        </div>
                    `;
                }
            }
            
            play() {
                if (this.player && this.player.play) {
                    this.player.play();
                }
            }
            
            pause() {
                if (this.player && this.player.pause) {
                    this.player.pause();
                }
            }
            
            restart() {
                if (this.player) {
                    this.player.goto(0);
                    this.player.play();
                }
            }
            
            async downloadSession() {
                if (!this.currentSession) return;
                
                try {
                    const sessionData = {
                        session: this.currentSession,
                        rrwebEvents: this.rrwebEvents,
                        exportedAt: new Date().toISOString(),
                        format: 'rrweb-compatible'
                    };
                    
                    const blob = new Blob([JSON.stringify(sessionData, null, 2)], { 
                        type: 'application/json' 
                    });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `session_${this.currentSession.id}_rrweb.json`;
                    a.click();
                    URL.revokeObjectURL(url);
                    
                    this.showAlert('ì„¸ì…˜ ë°ì´í„°ê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
                } catch (error) {
                    console.error('ì„¸ì…˜ ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨:', error);
                    this.showAlert('ì„¸ì…˜ì„ ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + error.message, 'danger');
                }
            }
            
            getRrwebEventTypeName(type) {
                const typeNames = {
                    0: 'DOM ì½˜í…ì¸ ',
                    1: 'DOM ë³€í™”',
                    2: 'DOM ë³€ê²½',
                    3: 'ë§ˆìš°ìŠ¤ ì´ë™',
                    4: 'ë§ˆìš°ìŠ¤ ìƒí˜¸ì‘ìš©',
                    5: 'ë·°í¬íŠ¸ í¬ê¸°',
                    6: 'ì…ë ¥',
                    7: 'ë¯¸ë””ì–´ ìƒí˜¸ì‘ìš©',
                    8: 'ìŠ¤íƒ€ì¼ ì„ ì–¸',
                    9: 'ìº”ë²„ìŠ¤ ë³€í™”',
                    10: 'í°íŠ¸ ë¡œë“œ',
                    11: 'ë¡œê·¸',
                    12: 'ë“œë˜ê·¸',
                    13: 'ìŠ¤íƒ€ì¼ì‹œíŠ¸ ê·œì¹™',
                    14: 'ì„ íƒ ë³€í™”'
                };
                return typeNames[type] || `íƒ€ì… ${type}`;
            }
            
            getScenarioName(scenario) {
                const names = {
                    'ecommerce_checkout': 'ğŸ›’ E-commerce ê²°ì œ',
                    'saas_dashboard': 'ğŸ“Š SaaS ëŒ€ì‹œë³´ë“œ',
                    'form_validation': 'ğŸ“ í¼ ê²€ì¦',
                    'mobile_responsive': 'ğŸ“± ëª¨ë°”ì¼ ë°˜ì‘í˜•'
                };
                return names[scenario] || scenario;
            }
            
            formatDuration(milliseconds) {
                if (!milliseconds) return '0ì´ˆ';
                const seconds = Math.floor(milliseconds / 1000);
                const minutes = Math.floor(seconds / 60);
                
                if (minutes > 0) {
                    return `${minutes}ë¶„ ${seconds % 60}ì´ˆ`;
                } else {
                    return `${seconds}ì´ˆ`;
                }
            }
            
            showLoading(show) {
                this.isLoading = show;
                this.loadingModal.style.display = show ? 'block' : 'none';
            }
            
            // ê¸°ë³¸ ì´ë²¤íŠ¸ í”Œë ˆì´ì–´ ì´ˆê¸°í™”
            initializeBasicPlayer() {
                this.playerContainer.innerHTML = `
                    <div style="background: white; border: 2px solid #e9ecef; border-radius: 8px; padding: 20px; height: 580px; overflow-y: auto;">
                        <h4 style="color: #2c3e50; margin-bottom: 20px;">ğŸ“‹ ê¸°ë³¸ ì´ë²¤íŠ¸ ì¬ìƒ (${this.rrwebEvents.length}ê°œ ì´ë²¤íŠ¸)</h4>
                        <div id="basicEventsList" style="display: flex; flex-direction: column; gap: 10px;"></div>
                    </div>
                `;
                
                const eventsList = document.getElementById('basicEventsList');
                
                this.rrwebEvents.forEach((event, index) => {
                    const eventDiv = document.createElement('div');
                    eventDiv.style.cssText = `
                        padding: 15px;
                        border: 1px solid #dee2e6;
                        border-radius: 6px;
                        background: ${this.getEventColor(event.type)};
                        transition: all 0.3s ease;
                        cursor: pointer;
                    `;
                    
                    eventDiv.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <span style="font-weight: bold; color: #2c3e50;">
                                ${this.getEventIcon(event.type)} ${this.getEventTypeName(event.type)}
                            </span>
                            <span style="font-size: 0.9rem; color: #6c757d;">
                                ${this.formatTime(event.timestamp)}
                            </span>
                        </div>
                        <div style="font-size: 0.9rem; color: #495057;">
                            ${this.getBasicEventDetails(event)}
                        </div>
                    `;
                    
                    eventDiv.addEventListener('click', () => {
                        this.highlightEvent(eventDiv);
                        if (event.type === 'click') {
                            this.showClickVisualization(event);
                        }
                    });
                    
                    eventsList.appendChild(eventDiv);
                });
                
                this.player = { isBasic: true };
            }
            
            getEventColor(type) {
                const colors = {
                    'page_load': '#e3f2fd',
                    'click': '#fff3e0',
                    'input': '#f3e5f5',
                    'scroll': '#e8f5e8'
                };
                return colors[type] || '#f8f9fa';
            }
            
            getEventIcon(type) {
                const icons = {
                    'page_load': 'ğŸŒ',
                    'click': 'ğŸ‘†',
                    'input': 'âœï¸',
                    'scroll': 'ğŸ”„'
                };
                return icons[type] || 'ğŸ“';
            }
            
            getEventTypeName(type) {
                const names = {
                    'page_load': 'í˜ì´ì§€ ë¡œë“œ',
                    'click': 'í´ë¦­',
                    'input': 'ì…ë ¥',
                    'scroll': 'ìŠ¤í¬ë¡¤'
                };
                return names[type] || type;
            }
            
            getBasicEventDetails(event) {
                switch (event.type) {
                    case 'page_load':
                        return `URL: ${event.url} | ì œëª©: ${event.title} | ë·°í¬íŠ¸: ${event.viewport?.width}x${event.viewport?.height}`;
                    case 'click':
                        return `ìœ„ì¹˜: (${event.x}, ${event.y}) | ìš”ì†Œ: ${event.element?.tagName}${event.element?.id ? '#' + event.element.id : ''} | í…ìŠ¤íŠ¸: ${event.element?.textContent || 'ì—†ìŒ'}`;
                    case 'input':
                        return `ìš”ì†Œ: ${event.element?.tagName}${event.element?.id ? '#' + event.element.id : ''} | íƒ€ì…: ${event.element?.type} | ì…ë ¥ ê¸¸ì´: ${event.valueLength}ì`;
                    case 'scroll':
                        return `ìŠ¤í¬ë¡¤ ìœ„ì¹˜: X=${event.scrollX}, Y=${event.scrollY}`;
                    default:
                        return JSON.stringify(event).slice(0, 100) + '...';
                }
            }
            
            highlightEvent(eventDiv) {
                // ì´ì „ í•˜ì´ë¼ì´íŠ¸ ì œê±°
                document.querySelectorAll('#basicEventsList > div').forEach(div => {
                    div.style.boxShadow = 'none';
                    div.style.transform = 'none';
                });
                
                // í˜„ì¬ ì´ë²¤íŠ¸ í•˜ì´ë¼ì´íŠ¸
                eventDiv.style.boxShadow = '0 4px 12px rgba(0,123,255,0.3)';
                eventDiv.style.transform = 'translateX(10px)';
            }
            
            showClickVisualization(clickEvent) {
                // ê°„ë‹¨í•œ í´ë¦­ ì‹œê°í™” (í–¥í›„ í™•ì¥ ê°€ëŠ¥)
                const visualization = document.createElement('div');
                visualization.style.cssText = `
                    position: fixed;
                    left: ${clickEvent.x}px;
                    top: ${clickEvent.y}px;
                    width: 20px;
                    height: 20px;
                    background: radial-gradient(circle, rgba(255,0,0,0.8) 0%, transparent 70%);
                    border-radius: 50%;
                    pointer-events: none;
                    z-index: 9999;
                    animation: clickPulse 1s ease-out;
                `;
                
                document.body.appendChild(visualization);
                setTimeout(() => {
                    if (visualization.parentElement) {
                        visualization.parentElement.removeChild(visualization);
                    }
                }, 1000);
            }
            
            showAlert(message, type = 'info') {
                const alertDiv = document.createElement('div');
                alertDiv.className = `alert alert-${type}`;
                alertDiv.textContent = message;
                
                document.body.insertBefore(alertDiv, document.body.firstChild);
                
                setTimeout(() => {
                    if (alertDiv.parentElement) {
                        alertDiv.parentElement.removeChild(alertDiv);
                    }
                }, 5000);
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ í”Œë ˆì´ì–´ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            const player = new RealReplayPlayer();
            window.realReplayPlayer = player; // ë””ë²„ê¹…ìš©
        });
    </script>
</body>
</html>