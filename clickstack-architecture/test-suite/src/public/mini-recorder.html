<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¯¸ë‹ˆ DOM ë…¹í™”ê¸°</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; }
        .panel { background: #f5f5f5; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .btn { padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; }
        .btn-green { background: #28a745; color: white; }
        .btn-red { background: #dc3545; color: white; }
        .btn-blue { background: #007bff; color: white; }
        .btn:disabled { background: #ccc; cursor: not-allowed; }
        .status { font-weight: bold; color: #007bff; }
    </style>
</head>
<body>
    <div class="panel">
        <h1>ğŸ¬ ë¯¸ë‹ˆ DOM ë…¹í™”ê¸°</h1>
        <p>ìƒíƒœ: <span class="status" id="status">ì¤€ë¹„ ì™„ë£Œ</span></p>
        <p>ì´ë²¤íŠ¸ ìˆ˜: <span id="eventCount">0</span></p>
        
        <button class="btn btn-green" id="startBtn">ë…¹í™” ì‹œì‘</button>
        <button class="btn btn-red" id="stopBtn" disabled>ë…¹í™” ì¤‘ì§€</button>
        <button class="btn btn-blue" id="playBtn" disabled>ì¬ìƒí•˜ê¸°</button>
    </div>
    
    <div class="panel">
        <h3>í…ŒìŠ¤íŠ¸ ì˜ì—­</h3>
        <input type="text" placeholder="í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" style="width: 100%; padding: 10px; margin: 10px 0;">
        <br>
        <button class="btn btn-blue" onclick="testAction('ë²„íŠ¼ A')">í…ŒìŠ¤íŠ¸ ë²„íŠ¼ A</button>
        <button class="btn btn-blue" onclick="testAction('ë²„íŠ¼ B')">í…ŒìŠ¤íŠ¸ ë²„íŠ¼ B</button>
        <div id="testArea" style="height: 100px; background: #e9ecef; margin: 10px 0; padding: 10px;">
            í´ë¦­í•˜ê±°ë‚˜ ìƒí˜¸ì‘ìš©í•´ë³´ì„¸ìš”
        </div>
    </div>

    <script>
        console.log('ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© ì‹œì‘');
        
        let isRecording = false;
        let events = [];
        let currentSessionId = null;
        let startTime = null;
        
        // DOM ìš”ì†Œë“¤
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const playBtn = document.getElementById('playBtn');
        const status = document.getElementById('status');
        const eventCount = document.getElementById('eventCount');
        
        console.log('DOM ìš”ì†Œ í™•ì¸:', { startBtn, stopBtn, playBtn });
        
        // rrweb ì—†ì´ ê¸°ë³¸ì ì¸ ì´ë²¤íŠ¸ ìˆ˜ì§‘ê¸°
        function startBasicRecording() {
            console.log('ê¸°ë³¸ ë…¹í™” ì‹œì‘');
            
            // í˜ì´ì§€ì˜ ëª¨ë“  í´ë¦­ ì´ë²¤íŠ¸ ê°ì§€
            document.addEventListener('click', recordEvent);
            document.addEventListener('input', recordEvent);
            document.addEventListener('change', recordEvent);
            
            function recordEvent(e) {
                if (!isRecording) return;
                
                const event = {
                    type: e.type,
                    timestamp: Date.now() - startTime,
                    target: e.target.tagName,
                    id: e.target.id,
                    className: e.target.className,
                    value: e.target.value || e.target.textContent?.substring(0, 50) || ''
                };
                
                events.push(event);
                eventCount.textContent = events.length;
                console.log('ì´ë²¤íŠ¸ ê¸°ë¡:', event);
            }
        }
        
        // ë…¹í™” ì‹œì‘
        function startRecording() {
            console.log('ë…¹í™” ì‹œì‘ í•¨ìˆ˜ í˜¸ì¶œ');
            
            if (isRecording) return;
            
            // ì´ˆê¸°í™”
            events = [];
            currentSessionId = 'session_' + Date.now();
            startTime = Date.now();
            isRecording = true;
            
            // UI ì—…ë°ì´íŠ¸
            status.textContent = 'ğŸ”´ ë…¹í™” ì¤‘';
            startBtn.disabled = true;
            stopBtn.disabled = false;
            playBtn.disabled = true;
            
            // ê¸°ë³¸ ì´ë²¤íŠ¸ ë…¹í™” ì‹œì‘
            startBasicRecording();
            
            console.log('ë…¹í™” ì‹œì‘ ì™„ë£Œ, ì„¸ì…˜ ID:', currentSessionId);
            alert('âœ… ë…¹í™”ê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤! ì•„ë˜ í…ŒìŠ¤íŠ¸ ì˜ì—­ì—ì„œ í´ë¦­ì´ë‚˜ ì…ë ¥ì„ í•´ë³´ì„¸ìš”.');
        }
        
        // ë…¹í™” ì¤‘ì§€
        function stopRecording() {
            console.log('ë…¹í™” ì¤‘ì§€ í•¨ìˆ˜ í˜¸ì¶œ');
            
            if (!isRecording) return;
            
            isRecording = false;
            
            // UI ì—…ë°ì´íŠ¸
            status.textContent = 'â¹ï¸ ë…¹í™” ì™„ë£Œ';
            startBtn.disabled = false;
            stopBtn.disabled = true;
            playBtn.disabled = false;
            
            // ì„¸ì…˜ ì €ì¥
            const session = {
                id: currentSessionId,
                events: events,
                startTime: startTime,
                endTime: Date.now(),
                duration: Date.now() - startTime,
                eventCount: events.length
            };
            
            localStorage.setItem(currentSessionId, JSON.stringify(session));
            
            console.log('ë…¹í™” ì™„ë£Œ, ì„¸ì…˜ ì €ì¥:', session);
            alert(`âœ… ë…¹í™” ì™„ë£Œ! ${events.length}ê°œì˜ ì´ë²¤íŠ¸ê°€ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }
        
        // ì¬ìƒ (ê¸°ë³¸ì ì¸ ë¡œê·¸ ì¶œë ¥)
        function playRecording() {
            console.log('ì¬ìƒ í•¨ìˆ˜ í˜¸ì¶œ');
            
            if (events.length === 0) {
                alert('âš ï¸ ì¬ìƒí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            console.log('=== ì„¸ì…˜ ì¬ìƒ ===');
            console.log('ì„¸ì…˜ ID:', currentSessionId);
            console.log('ì´ ì´ë²¤íŠ¸:', events.length);
            console.log('ì´ë²¤íŠ¸ ëª©ë¡:');
            
            events.forEach((event, index) => {
                console.log(`${index + 1}. [${event.timestamp}ms] ${event.type} on ${event.target}${event.id ? '#' + event.id : ''} - "${event.value}"`);
            });
            
            alert(`ğŸ“¹ ì½˜ì†”ì—ì„œ ${events.length}ê°œ ì´ë²¤íŠ¸ì˜ ì¬ìƒ ë¡œê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”!\n(F12 > Console íƒ­)`);
        }
        
        // í…ŒìŠ¤íŠ¸ í•¨ìˆ˜
        function testAction(name) {
            console.log(name + ' í´ë¦­ë¨');
            document.getElementById('testArea').innerHTML += `<p>${name} í´ë¦­ë¨ (${new Date().toLocaleTimeString()})</p>`;
        }
        
        // ë²„íŠ¼ ì´ë²¤íŠ¸ ì—°ê²°
        startBtn.addEventListener('click', startRecording);
        stopBtn.addEventListener('click', stopRecording);
        playBtn.addEventListener('click', playRecording);
        
        // í…ŒìŠ¤íŠ¸ ì˜ì—­ í´ë¦­ ì´ë²¤íŠ¸
        document.getElementById('testArea').addEventListener('click', function() {
            this.style.backgroundColor = `hsl(${Math.random() * 360}, 50%, 80%)`;
        });
        
        console.log('âœ… ë¯¸ë‹ˆ ë…¹í™”ê¸° ì´ˆê¸°í™” ì™„ë£Œ');
    </script>
</body>
</html>