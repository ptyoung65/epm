<!DOCTYPE html>
<html lang="ko" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LSTM 장애 예측 모델 학습 - AIRIS EPM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* shadcn/ui CSS Variables */
        :root {
            --background: 0 0% 100%;
            --foreground: 222.2 84% 4.9%;
            --card: 0 0% 100%;
            --card-foreground: 222.2 84% 4.9%;
            --popover: 0 0% 100%;
            --popover-foreground: 222.2 84% 4.9%;
            --primary: 222.2 47.4% 11.2%;
            --primary-foreground: 210 40% 98%;
            --secondary: 210 40% 96.1%;
            --secondary-foreground: 222.2 47.4% 11.2%;
            --muted: 210 40% 96.1%;
            --muted-foreground: 215.4 16.3% 46.9%;
            --accent: 210 40% 96.1%;
            --accent-foreground: 222.2 47.4% 11.2%;
            --destructive: 0 84.2% 60.2%;
            --destructive-foreground: 210 40% 98%;
            --border: 214.3 31.8% 91.4%;
            --input: 214.3 31.8% 91.4%;
            --ring: 222.2 84% 4.9%;
            --radius: 0.5rem;
        }
        .dark {
            --background: 222.2 84% 4.9%;
            --foreground: 210 40% 98%;
            --card: 222.2 84% 4.9%;
            --card-foreground: 210 40% 98%;
            --popover: 222.2 84% 4.9%;
            --popover-foreground: 210 40% 98%;
            --primary: 210 40% 98%;
            --primary-foreground: 222.2 47.4% 11.2%;
            --secondary: 217.2 32.6% 17.5%;
            --secondary-foreground: 210 40% 98%;
            --muted: 217.2 32.6% 17.5%;
            --muted-foreground: 215 20.2% 65.1%;
            --accent: 217.2 32.6% 17.5%;
            --accent-foreground: 210 40% 98%;
            --destructive: 0 62.8% 30.6%;
            --destructive-foreground: 210 40% 98%;
            --border: 217.2 32.6% 17.5%;
            --input: 217.2 32.6% 17.5%;
            --ring: 212.7 26.8% 83.9%;
        }

        .btn {
            @apply inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none ring-offset-background;
        }

        .btn-primary {
            @apply bg-primary text-primary-foreground hover:bg-primary/90;
            padding: 0.5rem 1rem;
        }

        .btn-ghost {
            @apply hover:bg-accent hover:text-accent-foreground;
            padding: 0.5rem 1rem;
        }
        
        /* Chart Container Fixed Height */
        .ml-chart-container {
            width: 100% !important;
            height: 256px !important;
            position: relative !important;
            overflow: hidden !important;
        }
        
        .ml-chart-container canvas {
            position: absolute !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
        }
    </style>
</head>
<body class="bg-background text-foreground">
    <!-- Navigation -->
    <nav class="border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60">
        <div class="container mx-auto px-4">
            <div class="flex h-14 items-center">
                <a href="/portal.html" class="text-xl font-bold text-gray-900 dark:text-white hover:text-blue-600 dark:hover:text-blue-400 transition-colors cursor-pointer">🚀 AIRIS EPM</a>
                
                <div class="ml-auto flex items-center space-x-4">
                    <!-- APM 모니터링 드롭다운 -->
                    <div class="relative group">
                        <button class="flex items-center space-x-1 px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 hover:text-gray-900 dark:hover:text-white">
                            <span>📊 APM 모니터링</span>
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div class="absolute left-0 mt-1 w-48 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                            <a href="/j2ee-dashboard.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">☕ J2EE 모니터링</a>
                            <a href="/was-dashboard.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">🏗️ WAS 모니터링</a>
                            <a href="/exception-dashboard.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">🚨 예외 추적</a>
                            <a href="/topology-dashboard.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">🗺️ 서비스 맵</a>
                            <a href="/performance-optimization-dashboard.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">⚡ 성능 최적화</a>
                        </div>
                    </div>

                    <!-- AI/ML 시스템 드롭다운 -->
                    <div class="relative group">
                        <button class="flex items-center space-x-1 px-3 py-2 text-sm font-medium text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20">
                            <span>🤖 AI/ML 시스템</span>
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div class="absolute left-0 mt-1 w-56 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                            <a href="/ai-prediction-dashboard.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">🔮 AI 예측 분석</a>
                            <a href="/data-quality-dashboard.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">📊 데이터 품질</a>
                            <a href="/aiops-management.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">🤖 AIOps 관리</a>
                            <div class="border-t border-gray-200 dark:border-gray-600 my-1"></div>
                            <div class="px-4 py-2 text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide font-semibold">ML 훈련</div>
                            <a href="/ml-training-autoencoder.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">🔬 오토인코더</a>
                            <a href="/ml-training-clustering.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">🎯 클러스터링</a>
                            <a href="/ml-training-lstm.html" class="block px-4 py-2 text-sm text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 hover:bg-blue-100 dark:hover:bg-blue-900/40">🧠 LSTM</a>
                            <a href="/ml-training-rca.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">🔍 RCA 분석</a>
                            <a href="/ml-training-report.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">📋 훈련 리포트</a>
                            <a href="/clustering-insights.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">💡 인사이트</a>
                        </div>
                    </div>

                    <!-- 시스템 관리 드롭다운 -->
                    <div class="relative group">
                        <button class="flex items-center space-x-1 px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 hover:text-gray-900 dark:hover:text-white">
                            <span>⚙️ 시스템 관리</span>
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div class="absolute left-0 mt-1 w-48 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                            <a href="/alert-dashboard.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">🔔 알림 관리</a>
                            <a href="/security-dashboard.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">🛡️ 보안 모니터링</a>
                            <a href="/log-analysis-dashboard.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">📄 로그 분석</a>
                            <a href="/external-integration-dashboard.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">🔗 외부 통합</a>
                            <a href="/system-config-dashboard.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">⚙️ 시스템 설정</a>
                        </div>
                    </div>

                    <!-- 분석 & 리포트 드롭다운 -->
                    <div class="relative group">
                        <button class="flex items-center space-x-1 px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 hover:text-gray-900 dark:hover:text-white">
                            <span>📈 분석 & 리포트</span>
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div class="absolute right-0 mt-1 w-56 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                            <a href="/deployment-manager.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">🚀 배포 관리</a>
                            <a href="/session-management.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">👤 세션 관리</a>
                            <div class="border-t border-gray-200 dark:border-gray-600 my-1"></div>
                            <div class="px-4 py-2 text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide font-semibold">온톨로지</div>
                            <a href="/ontology.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">🧠 기본 온톨로지</a>
                            <a href="/ontology-tabs.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">📂 탭 온톨로지</a>
                            <a href="/ontology-complete.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">🔗 완전 온톨로지</a>
                        </div>
                    </div>

                    <!-- 챗봇 아이콘 -->
                    <button onclick="window.open('/chatbot.html', '_blank', 'width=1200,height=800,scrollbars=yes,resizable=yes')" class="btn btn-ghost" title="지능형 분석 챗봇">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                        </svg>
                    </button>

                    <!-- 테마 토글 -->
                    <button id="themeToggle" class="btn btn-ghost">🌙</button>
                </div>
            </div>
        </div>
    </nav>

    <main class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- Page Title -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold mb-2">📈 LSTM 장애 예측 모델 학습</h1>
            <p class="text-muted-foreground">시계열 분석을 통한 시스템 장애 예측 모델의 학습 및 최적화</p>
        </div>

        <!-- Model Architecture & Current Status -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <!-- Model Architecture Card -->
            <div class="lg:col-span-2 bg-card rounded-lg border p-6">
                <h2 class="text-xl font-semibold mb-4">LSTM 모델 아키텍처</h2>
                <div class="grid grid-cols-1 gap-4 mb-4">
                    <div>
                        <h3 class="text-sm font-medium text-muted-foreground mb-2">시계열 입력층</h3>
                        <div class="space-y-2">
                            <div class="flex justify-between text-sm">
                                <span>입력 형태</span>
                                <span class="font-mono">[batch, 24, 10] (24시간, 10개 특성)</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span>특성</span>
                                <span class="font-mono">CPU, Memory, Disk, Network, Response Time, Error Rate, Throughput, Connections, Threads, Transactions</span>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-sm font-medium text-muted-foreground mb-2">LSTM 레이어</h3>
                        <div class="space-y-2">
                            <div class="flex justify-between text-sm">
                                <span>LSTM Layer 1</span>
                                <span class="font-mono">128 units, return_sequences=True</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span>Dropout 1</span>
                                <span class="font-mono">rate=0.2</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span>LSTM Layer 2</span>
                                <span class="font-mono">64 units, return_sequences=False</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span>Dropout 2</span>
                                <span class="font-mono">rate=0.2</span>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-sm font-medium text-muted-foreground mb-2">출력층</h3>
                        <div class="space-y-2">
                            <div class="flex justify-between text-sm">
                                <span>Dense Layer 1</span>
                                <span class="font-mono">32 units (ReLU)</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span>Dense Layer 2</span>
                                <span class="font-mono">10 units (Linear) - 다음 10시간 예측</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-muted rounded p-3 text-sm">
                    <p><strong>Loss Function:</strong> Mean Absolute Error (MAE)</p>
                    <p><strong>Optimizer:</strong> Adam (learning rate: 0.001)</p>
                    <p><strong>Prediction Window:</strong> 24시간 후까지</p>
                </div>
            </div>

            <!-- Current Model Status -->
            <div class="bg-card rounded-lg border p-6">
                <h2 class="text-xl font-semibold mb-4">현재 모델 상태</h2>
                <div class="space-y-3">
                    <div class="flex justify-between">
                        <span class="text-sm text-muted-foreground">마지막 학습</span>
                        <span class="text-sm font-medium">2024-08-27 13:45</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm text-muted-foreground">예측 정확도</span>
                        <span class="text-sm font-medium text-green-600">89.7%</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm text-muted-foreground">MAE</span>
                        <span class="text-sm font-medium">0.0134</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm text-muted-foreground">RMSE</span>
                        <span class="text-sm font-medium">0.0267</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm text-muted-foreground">총 에포크</span>
                        <span class="text-sm font-medium">300</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm text-muted-foreground">모델 크기</span>
                        <span class="text-sm font-medium">4.1 MB</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Time Series Data Preview -->
        <div class="bg-card rounded-lg border p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4">시계열 데이터 미리보기</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h3 class="font-medium mb-3">시스템 메트릭 트렌드 (최근 24시간)</h3>
                    <div class="h-48 ml-chart-container">
                        <canvas id="metricsTimeSeriesChart" class="w-full h-full"></canvas>
                    </div>
                </div>
                <div>
                    <h3 class="font-medium mb-3">장애 이벤트 패턴</h3>
                    <div class="h-48 ml-chart-container">
                        <canvas id="failurePatternChart" class="w-full h-full"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Training Configuration -->
        <div class="bg-card rounded-lg border p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4">시계열 학습 설정</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <!-- Time Window -->
                <div>
                    <label class="block text-sm font-medium mb-2">시간 윈도우 (Hours)</label>
                    <input type="number" id="timeWindow" value="24" min="1" max="168" 
                           class="w-full px-3 py-2 bg-background border rounded-md focus:ring-2 focus:ring-primary">
                </div>

                <!-- Prediction Horizon -->
                <div>
                    <label class="block text-sm font-medium mb-2">예측 지평 (Hours)</label>
                    <input type="number" id="predictionHorizon" value="10" min="1" max="72" 
                           class="w-full px-3 py-2 bg-background border rounded-md focus:ring-2 focus:ring-primary">
                </div>

                <!-- Learning Rate -->
                <div>
                    <label class="block text-sm font-medium mb-2">학습률</label>
                    <input type="number" id="learningRate" value="0.001" step="0.0001" min="0.00001" max="1" 
                           class="w-full px-3 py-2 bg-background border rounded-md focus:ring-2 focus:ring-primary">
                </div>

                <!-- Batch Size -->
                <div>
                    <label class="block text-sm font-medium mb-2">배치 크기</label>
                    <input type="number" id="batchSize" value="16" min="1" max="128" 
                           class="w-full px-3 py-2 bg-background border rounded-md focus:ring-2 focus:ring-primary">
                </div>
            </div>

            <!-- LSTM Specific Settings -->
            <div class="mt-6 pt-6 border-t">
                <h3 class="font-medium mb-4">LSTM 전용 설정</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">LSTM Units (Layer 1)</label>
                        <input type="number" id="lstmUnits1" value="128" min="16" max="512" step="16" 
                               class="w-full px-3 py-2 bg-background border rounded-md focus:ring-2 focus:ring-primary">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">LSTM Units (Layer 2)</label>
                        <input type="number" id="lstmUnits2" value="64" min="16" max="256" step="16" 
                               class="w-full px-3 py-2 bg-background border rounded-md focus:ring-2 focus:ring-primary">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Dropout Rate</label>
                        <input type="number" id="dropoutRate" value="0.2" step="0.1" min="0" max="0.8" 
                               class="w-full px-3 py-2 bg-background border rounded-md focus:ring-2 focus:ring-primary">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Epochs</label>
                        <input type="number" id="epochs" value="200" min="50" max="1000" 
                               class="w-full px-3 py-2 bg-background border rounded-md focus:ring-2 focus:ring-primary">
                    </div>
                </div>
            </div>

            <!-- Data Preprocessing Options -->
            <div class="mt-6 pt-6 border-t">
                <h3 class="font-medium mb-4">데이터 전처리 옵션</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div class="flex items-center space-x-2">
                        <input type="checkbox" id="normalize" checked class="rounded">
                        <label for="normalize" class="text-sm">정규화 적용</label>
                    </div>
                    <div class="flex items-center space-x-2">
                        <input type="checkbox" id="seasonalDecomp" class="rounded">
                        <label for="seasonalDecomp" class="text-sm">계절성 분해</label>
                    </div>
                    <div class="flex items-center space-x-2">
                        <input type="checkbox" id="trendRemoval" class="rounded">
                        <label for="trendRemoval" class="text-sm">트렌드 제거</label>
                    </div>
                    <div class="flex items-center space-x-2">
                        <input type="checkbox" id="outlierFilter" checked class="rounded">
                        <label for="outlierFilter" class="text-sm">이상치 필터링</label>
                    </div>
                </div>
            </div>

            <!-- Training Controls -->
            <div class="mt-6 flex gap-4">
                <button id="startTrainingBtn" onclick="startTraining()" 
                        class="px-6 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors">
                    🚀 LSTM 학습 시작
                </button>
                <button id="stopTrainingBtn" onclick="stopTraining()" disabled
                        class="px-6 py-2 bg-destructive text-destructive-foreground rounded-md hover:bg-destructive/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                    ⏹️ 학습 중단
                </button>
                <button onclick="validatePredictions()"
                        class="px-6 py-2 bg-secondary text-secondary-foreground rounded-md hover:bg-secondary/90 transition-colors">
                    🔍 예측 검증
                </button>
            </div>
        </div>

        <!-- Training Progress -->
        <div class="bg-card rounded-lg border p-6 mb-8" id="trainingProgress" style="display: none;">
            <h2 class="text-xl font-semibold mb-4">LSTM 학습 진행 상황</h2>
            
            <!-- Progress Bar -->
            <div class="mb-6">
                <div class="flex justify-between mb-2">
                    <span class="text-sm text-muted-foreground">학습 진행률</span>
                    <span class="text-sm font-medium" id="progressText">0 / 200 epochs</span>
                </div>
                <div class="w-full bg-muted rounded-full h-3">
                    <div id="progressBar" class="bg-gradient-to-r from-blue-500 to-purple-600 h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
            </div>

            <!-- Real-time Metrics -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                <div class="bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded p-3">
                    <p class="text-sm text-muted-foreground mb-1">현재 에포크</p>
                    <p class="text-2xl font-bold text-blue-700 dark:text-blue-300" id="currentEpoch">0</p>
                </div>
                <div class="bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 rounded p-3">
                    <p class="text-sm text-muted-foreground mb-1">MAE 손실</p>
                    <p class="text-2xl font-bold text-green-700 dark:text-green-300" id="trainingMAE">0.0000</p>
                </div>
                <div class="bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 rounded p-3">
                    <p class="text-sm text-muted-foreground mb-1">검증 MAE</p>
                    <p class="text-2xl font-bold text-purple-700 dark:text-purple-300" id="validationMAE">0.0000</p>
                </div>
                <div class="bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-900/20 dark:to-orange-800/20 rounded p-3">
                    <p class="text-sm text-muted-foreground mb-1">예상 완료</p>
                    <p class="text-2xl font-bold text-orange-700 dark:text-orange-300" id="remainingTime">--:--</p>
                </div>
            </div>

            <!-- Training Charts -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h3 class="font-medium mb-3">학습/검증 손실 곡선</h3>
                    <div class="h-64 ml-chart-container">
                        <canvas id="lossChart" class="w-full h-full"></canvas>
                    </div>
                </div>
                <div>
                    <h3 class="font-medium mb-3">예측 vs 실제 값</h3>
                    <div class="h-64 ml-chart-container">
                        <canvas id="predictionChart" class="w-full h-full"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Model Evaluation -->
        <div class="bg-card rounded-lg border p-6" id="modelEvaluation" style="display: none;">
            <h2 class="text-xl font-semibold mb-4">모델 평가 결과</h2>
            
            <!-- Performance Metrics -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <div class="bg-muted rounded p-4">
                    <h3 class="font-medium mb-3">예측 정확도</h3>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="text-sm">MAE (평균 절대 오차)</span>
                            <span class="font-bold text-green-600" id="finalMAE">0.0123</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">RMSE (평균 제곱근 오차)</span>
                            <span class="font-bold" id="finalRMSE">0.0245</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">MAPE (평균 절대 백분율 오차)</span>
                            <span class="font-bold" id="finalMAPE">3.4%</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">R² Score</span>
                            <span class="font-bold text-blue-600" id="finalR2">0.923</span>
                        </div>
                    </div>
                </div>

                <div class="bg-muted rounded p-4">
                    <h3 class="font-medium mb-3">장애 예측 성능</h3>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="text-sm">장애 감지율</span>
                            <span class="font-bold text-green-600" id="detectionRate">87.3%</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">오탐지율</span>
                            <span class="font-bold text-red-600" id="falseAlarmRate">4.2%</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">평균 예측 시간</span>
                            <span class="font-bold" id="avgPredictionTime">2.3h</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">예측 신뢰도</span>
                            <span class="font-bold text-purple-600" id="confidenceScore">91.2%</span>
                        </div>
                    </div>
                </div>

                <div class="bg-muted rounded p-4">
                    <h3 class="font-medium mb-3">학습 통계</h3>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="text-sm">총 학습 시간</span>
                            <span class="font-bold" id="totalTime">1시간 23분</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">최적 에포크</span>
                            <span class="font-bold" id="bestEpoch">156</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">학습 데이터 수</span>
                            <span class="font-bold" id="trainSize">75,000</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">검증 데이터 수</span>
                            <span class="font-bold" id="validSize">15,000</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Feature Importance -->
            <div class="mb-6">
                <h3 class="font-medium mb-3">특성 중요도</h3>
                <div class="h-48 ml-chart-container">
                    <canvas id="featureImportanceChart" class="w-full h-full"></canvas>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex gap-4">
                <button onclick="deployModel()" class="px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors">
                    🚀 모델 배포
                </button>
                <button onclick="runBacktest()" class="px-6 py-2 bg-secondary text-secondary-foreground rounded-md hover:bg-secondary/90 transition-colors">
                    📊 백테스트 실행
                </button>
                <button onclick="exportPredictions()" class="px-6 py-2 bg-secondary text-secondary-foreground rounded-md hover:bg-secondary/90 transition-colors">
                    📈 예측 결과 내보내기
                </button>
                <button onclick="viewDetailedReport()" class="px-6 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors">
                    📊 상세 보고서
                </button>
            </div>
        </div>
    </main>

    <script>
        let lossChart, predictionChart, metricsTimeSeriesChart, failurePatternChart, featureImportanceChart;
        let isTraining = false;
        let trainingInterval;

        function initCharts() {
            // Metrics Time Series Chart
            const metricsCtx = document.getElementById('metricsTimeSeriesChart')?.getContext('2d');
            if (metricsCtx) {
                metricsTimeSeriesChart = new Chart(metricsCtx, {
                    type: 'line',
                    data: {
                        labels: Array.from({length: 24}, (_, i) => `${i}:00`),
                        datasets: [{
                            label: 'CPU Usage',
                            data: Array.from({length: 24}, () => Math.random() * 100),
                            borderColor: 'rgb(59, 130, 246)',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.4
                        }, {
                            label: 'Memory Usage',
                            data: Array.from({length: 24}, () => Math.random() * 100),
                            borderColor: 'rgb(34, 197, 94)',
                            backgroundColor: 'rgba(34, 197, 94, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        animation: { duration: 0 }, // 크기 변경 시 애니메이션 제거
                        plugins: { legend: { display: true } },
                        scales: {
                            x: { title: { display: true, text: 'Time (Hours)' } },
                            y: { title: { display: true, text: 'Usage (%)' } }
                        }
                    }
                });
            }

            // Failure Pattern Chart
            const failureCtx = document.getElementById('failurePatternChart')?.getContext('2d');
            if (failureCtx) {
                failurePatternChart = new Chart(failureCtx, {
                    type: 'scatter',
                    data: {
                        datasets: [{
                            label: '장애 발생',
                            data: Array.from({length: 20}, () => ({
                                x: Math.random() * 24,
                                y: Math.random() * 100
                            })),
                            backgroundColor: 'rgba(239, 68, 68, 0.6)',
                            borderColor: 'rgb(239, 68, 68)',
                            pointRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        animation: { duration: 0 }, // 크기 변경 시 애니메이션 제거
                        plugins: { legend: { display: true } },
                        scales: {
                            x: { title: { display: true, text: 'Time (Hours)' } },
                            y: { title: { display: true, text: 'Severity' } }
                        }
                    }
                });
            }

            // Loss Chart
            const lossCtx = document.getElementById('lossChart')?.getContext('2d');
            if (lossCtx) {
                lossChart = new Chart(lossCtx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: '학습 MAE',
                            data: [],
                            borderColor: 'rgb(34, 197, 94)',
                            backgroundColor: 'rgba(34, 197, 94, 0.1)',
                            tension: 0.4
                        }, {
                            label: '검증 MAE',
                            data: [],
                            borderColor: 'rgb(147, 51, 234)',
                            backgroundColor: 'rgba(147, 51, 234, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        animation: { duration: 0 }, // 크기 변경 시 애니메이션 제거
                        plugins: { legend: { display: true } },
                        scales: {
                            x: { title: { display: true, text: 'Epoch' } },
                            y: { title: { display: true, text: 'MAE Loss' } }
                        }
                    }
                });
            }

            // Prediction vs Actual Chart
            const predCtx = document.getElementById('predictionChart')?.getContext('2d');
            if (predCtx) {
                predictionChart = new Chart(predCtx, {
                    type: 'scatter',
                    data: {
                        datasets: [{
                            label: '예측 vs 실제',
                            data: [],
                            backgroundColor: 'rgba(59, 130, 246, 0.6)',
                            borderColor: 'rgb(59, 130, 246)',
                            pointRadius: 3
                        }, {
                            label: '완벽한 예측 (y=x)',
                            data: [{x: 0, y: 0}, {x: 100, y: 100}],
                            type: 'line',
                            borderColor: 'rgb(239, 68, 68)',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            pointRadius: 0,
                            borderDash: [5, 5]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        animation: { duration: 0 }, // 크기 변경 시 애니메이션 제거
                        plugins: { legend: { display: true } },
                        scales: {
                            x: { title: { display: true, text: 'Actual Values' } },
                            y: { title: { display: true, text: 'Predicted Values' } }
                        }
                    }
                });
            }
        }

        async function startTraining() {
            const timeWindow = parseInt(document.getElementById('timeWindow').value);
            const predictionHorizon = parseInt(document.getElementById('predictionHorizon').value);
            const learningRate = parseFloat(document.getElementById('learningRate').value);
            const batchSize = parseInt(document.getElementById('batchSize').value);
            const lstmUnits1 = parseInt(document.getElementById('lstmUnits1').value);
            const lstmUnits2 = parseInt(document.getElementById('lstmUnits2').value);
            const dropoutRate = parseFloat(document.getElementById('dropoutRate').value);
            const epochs = parseInt(document.getElementById('epochs').value);

            // Show training progress
            document.getElementById('trainingProgress').style.display = 'block';
            document.getElementById('modelEvaluation').style.display = 'none';
            
            document.getElementById('startTrainingBtn').disabled = true;
            document.getElementById('stopTrainingBtn').disabled = false;
            
            isTraining = true;

            // Prepare training data
            const trainingData = generateTimeSeriesData();

            try {
                const response = await fetch('http://localhost:3004/api/models/lstm/train', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        datasetId: 'timeseries_failure_prediction',
                        hyperparameters: {
                            learningRate,
                            epochs,
                            batchSize,
                            timeWindow,
                            predictionHorizon,
                            lstmUnits1,
                            lstmUnits2,
                            dropoutRate
                        },
                        trainingData: trainingData
                    })
                });

                if (!response.ok) {
                    throw new Error('LSTM training failed');
                }

                // Simulate training progress
                simulateTrainingProgress(epochs);

            } catch (error) {
                console.log('⚠️ API 연결 실패, 모의 학습으로 전환:', error.message);
                // Continue with mock training simulation
                simulateTrainingProgress(epochs);
            }
        }

        function simulateTrainingProgress(totalEpochs) {
            let currentEpoch = 0;
            const startTime = Date.now();
            
            trainingInterval = setInterval(() => {
                if (!isTraining || currentEpoch >= totalEpochs) {
                    clearInterval(trainingInterval);
                    if (currentEpoch >= totalEpochs) {
                        showModelEvaluation();
                    }
                    return;
                }

                currentEpoch++;
                const progress = (currentEpoch / totalEpochs) * 100;
                
                // Update progress
                document.getElementById('progressBar').style.width = progress + '%';
                document.getElementById('progressText').textContent = `${currentEpoch} / ${totalEpochs} epochs`;
                document.getElementById('currentEpoch').textContent = currentEpoch;
                
                // Simulate loss values (decreasing with some noise)
                const trainMAE = 0.1 * Math.exp(-currentEpoch / 50) + Math.random() * 0.01;
                const valMAE = trainMAE + Math.random() * 0.02;
                
                document.getElementById('trainingMAE').textContent = trainMAE.toFixed(4);
                document.getElementById('validationMAE').textContent = valMAE.toFixed(4);
                
                // Calculate remaining time
                const elapsedTime = Date.now() - startTime;
                const avgTimePerEpoch = elapsedTime / currentEpoch;
                const remainingEpochs = totalEpochs - currentEpoch;
                const remainingMs = avgTimePerEpoch * remainingEpochs;
                const remainingMinutes = Math.floor(remainingMs / 60000);
                const remainingSeconds = Math.floor((remainingMs % 60000) / 1000);
                document.getElementById('remainingTime').textContent = 
                    `${remainingMinutes}:${remainingSeconds.toString().padStart(2, '0')}`;
                
                // Update charts
                if (lossChart) {
                    lossChart.data.labels.push(currentEpoch);
                    lossChart.data.datasets[0].data.push(trainMAE);
                    lossChart.data.datasets[1].data.push(valMAE);
                    lossChart.update('none');
                }
                
                // Update prediction vs actual scatter plot
                if (predictionChart && currentEpoch % 10 === 0) {
                    const newPoints = Array.from({length: 20}, () => ({
                        x: Math.random() * 100,
                        y: Math.random() * 100
                    }));
                    predictionChart.data.datasets[0].data = newPoints;
                    predictionChart.update('none');
                }
                
            }, 300); // Faster updates for demo
        }

        function stopTraining() {
            isTraining = false;
            if (trainingInterval) {
                clearInterval(trainingInterval);
            }
            
            document.getElementById('startTrainingBtn').disabled = false;
            document.getElementById('stopTrainingBtn').disabled = true;
        }

        function showModelEvaluation() {
            stopTraining();
            document.getElementById('modelEvaluation').style.display = 'block';
            
            // Initialize feature importance chart
            const featureCtx = document.getElementById('featureImportanceChart')?.getContext('2d');
            if (featureCtx && !featureImportanceChart) {
                featureImportanceChart = new Chart(featureCtx, {
                    type: 'bar',
                    data: {
                        labels: ['CPU', 'Memory', 'Disk', 'Network', 'Response Time', 'Error Rate', 'Throughput', 'Connections', 'Threads', 'Transactions'],
                        datasets: [{
                            label: '특성 중요도',
                            data: [0.15, 0.13, 0.11, 0.09, 0.12, 0.08, 0.10, 0.07, 0.06, 0.09],
                            backgroundColor: 'rgba(59, 130, 246, 0.6)',
                            borderColor: 'rgb(59, 130, 246)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        animation: { duration: 0 }, // 크기 변경 시 애니메이션 제거
                        plugins: { legend: { display: false } },
                        scales: {
                            x: { title: { display: true, text: 'Features' } },
                            y: { title: { display: true, text: 'Importance Score' } }
                        }
                    }
                });
            }
        }

        function generateTimeSeriesData() {
            // Generate time series data for LSTM training
            const data = [];
            const dataPoints = 1000;
            
            for (let i = 0; i < dataPoints; i++) {
                const time = i / dataPoints * 24 * 30; // 30 days worth of data
                data.push({
                    timestamp: new Date(Date.now() - (dataPoints - i) * 3600000).toISOString(),
                    cpu: 50 + 30 * Math.sin(time / 24 * Math.PI) + Math.random() * 20,
                    memory: 60 + 25 * Math.sin(time / 12 * Math.PI) + Math.random() * 15,
                    disk: 40 + Math.random() * 10,
                    network: 30 + 20 * Math.sin(time / 6 * Math.PI) + Math.random() * 10,
                    responseTime: 100 + 50 * Math.sin(time / 3 * Math.PI) + Math.random() * 30,
                    errorRate: Math.random() * 5,
                    throughput: 500 + 200 * Math.sin(time / 8 * Math.PI) + Math.random() * 100,
                    connections: Math.floor(100 + 50 * Math.sin(time / 4 * Math.PI) + Math.random() * 30),
                    threads: Math.floor(50 + 20 * Math.sin(time / 2 * Math.PI) + Math.random() * 15),
                    transactions: Math.floor(1000 + 500 * Math.sin(time / 6 * Math.PI) + Math.random() * 200)
                });
            }
            
            return data;
        }

        function validatePredictions() {
            alert('예측 검증 기능을 실행합니다. 테스트 데이터셋에 대해 모델을 평가합니다.');
        }

        function deployModel() {
            if (confirm('LSTM 예측 모델을 프로덕션에 배포하시겠습니까?')) {
                alert('LSTM 모델이 성공적으로 배포되었습니다.');
            }
        }

        function runBacktest() {
            window.open('/ml-backtest.html?model=lstm', '_blank');
        }

        function exportPredictions() {
            alert('예측 결과를 CSV 파일로 내보냅니다.');
        }

        function viewDetailedReport() {
            window.open('/ml-training-report.html?model=lstm', '_blank');
        }

        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleString('ko-KR', {
                year: 'numeric', month: '2-digit', day: '2-digit',
                hour: '2-digit', minute: '2-digit', second: '2-digit',
                hour12: false
            });
            document.getElementById('currentTime').textContent = timeString;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initCharts();
            updateTime();
            setInterval(updateTime, 1000);
        });
    </script>
</body>
</html>