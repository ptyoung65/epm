<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AIRIS EPM | 메트릭 모니터링 대시보드</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    * { font-family: 'Inter', sans-serif; }
    
    /* Dropdown 메뉴 완전 제어 - 모든 Tailwind 클래스 오버라이드 */
    .relative.group div.absolute {
      opacity: 0 !important;
      visibility: hidden !important;
      transform: translateY(-10px) !important;
      transition: all 0.2s ease-in-out !important;
      z-index: 9999 !important;
      pointer-events: none !important;
    }
    .relative.group:hover div.absolute {
      opacity: 1 !important;
      visibility: visible !important;
      transform: translateY(0) !important;
      z-index: 9999 !important;
      pointer-events: auto !important;
    }
    
    /* 추가 강제 오버라이드 - Tailwind 클래스별 */
    .group-hover\:opacity-100 { opacity: 1 !important; }
    .group-hover\:visible { visibility: visible !important; }
    .opacity-0 { opacity: 0 !important; }
    .invisible { visibility: hidden !important; }
    
    /* 드롭다운 항목들 모두 강제 표시 */
    .relative.group:hover .absolute a {
      opacity: 1 !important;
      visibility: visible !important;
      display: block !important;
    }
    
    /* shadcn/ui CSS Variables */
    :root {
      --background: 0 0% 100%;
      --foreground: 222.2 84% 4.9%;
      --card: 0 0% 100%;
      --card-foreground: 222.2 84% 4.9%;
      --popover: 0 0% 100%;
      --popover-foreground: 222.2 84% 4.9%;
      --primary: 222.2 47.4% 11.2%;
      --primary-foreground: 210 40% 98%;
      --secondary: 210 40% 96%;
      --secondary-foreground: 222.2 47.4% 11.2%;
      --muted: 210 40% 96%;
      --muted-foreground: 215.4 16.3% 46.9%;
      --accent: 210 40% 96%;
      --accent-foreground: 222.2 47.4% 11.2%;
      --destructive: 0 84.2% 60.2%;
      --destructive-foreground: 210 40% 98%;
      --border: 214.3 31.8% 91.4%;
      --input: 214.3 31.8% 91.4%;
      --ring: 222.2 84% 4.9%;
      --radius: 0.5rem;
    }

    .dark {
      --background: 222.2 84% 4.9%;
      --foreground: 210 40% 98%;
      --card: 222.2 84% 4.9%;
      --card-foreground: 210 40% 98%;
      --popover: 222.2 84% 4.9%;
      --popover-foreground: 210 40% 98%;
      --primary: 210 40% 98%;
      --primary-foreground: 222.2 47.4% 11.2%;
      --secondary: 217.2 32.6% 17.5%;
      --secondary-foreground: 210 40% 98%;
      --muted: 217.2 32.6% 17.5%;
      --muted-foreground: 215 20.2% 65.1%;
      --accent: 217.2 32.6% 17.5%;
      --accent-foreground: 210 40% 98%;
      --destructive: 0 62.8% 30.6%;
      --destructive-foreground: 210 40% 98%;
      --border: 217.2 32.6% 17.5%;
      --input: 217.2 32.6% 17.5%;
      --ring: 212.7 26.8% 83.9%;
    }
    
    .metric-card {
      transition: all 0.2s ease;
    }
    .metric-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .status-indicator {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      display: inline-block;
    }
    .status-healthy { background-color: #10b981; }
    .status-warning { background-color: #f59e0b; }
    .status-critical { background-color: #ef4444; }
    
    .metric-trend-up { color: #10b981; }
    .metric-trend-down { color: #ef4444; }
    .metric-trend-stable { color: #6b7280; }
  </style>
</head>
<body class="bg-background text-foreground">
  <div class="min-h-screen bg-gray-50 dark:bg-gray-900">
        <!-- Navigation -->
    <nav class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between h-16">
          <div class="flex items-center">
            <div class="flex-shrink-0">
              <a href="/portal.html" class="text-xl font-bold text-gray-900 dark:text-white hover:text-blue-600 dark:hover:text-blue-400 transition-colors cursor-pointer">🚀 AIRIS EPM</a>
            </div>
            <div class="ml-10 flex items-center space-x-8">
              <!-- 메인 대시보드 -->
              <a href="/" class="text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white px-3 py-2 text-sm font-medium">📊 메인</a>
              
              <!-- APM 모니터링 드롭다운 -->
              <div class="relative group">
                <button class="text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white transition-colors bg-transparent border-none cursor-pointer flex items-center px-3 py-2 text-sm font-medium">
                  ⚡ APM 모니터링 ▾
                </button>
                <div class="absolute top-full left-0 mt-1 w-48 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                  <a href="/j2ee-dashboard.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white">☕ J2EE 모니터링</a>
                  <a href="/was-dashboard.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white">🏗️ WAS 모니터링</a>
                  <a href="/exception-dashboard.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white">🚨 예외 추적</a>
                  <a href="/topology-dashboard.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white">🗺️ 서비스 토폴로지</a>
                  <a href="/alert-dashboard.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white">🔔 알림 관리</a>
                </div>
              </div>

              <!-- 인프라 모니터링 드롭다운 -->
              <div class="relative group">
                <button class="text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white transition-colors bg-transparent border-none cursor-pointer flex items-center px-3 py-2 text-sm font-medium">
                  🖥️ 인프라 모니터링 ▾
                </button>
                <div class="absolute top-full left-0 mt-1 w-48 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                  <a href="/app-monitoring.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white">📱 애플리케이션 모니터링</a>
                  <a href="/system-monitoring.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white">⚙️ 시스템 모니터링</a>
                  <a href="/db-monitoring.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white">🗃️ 데이터베이스 모니터링</a>
                  <a href="/web-monitoring.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white">🌐 웹 성능 모니터링</a>
                </div>
              </div>

              <!-- 관찰성 드롭다운 -->
              <div class="relative group">
                <button class="bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300 transition-colors bg-transparent border-none cursor-pointer flex items-center px-3 py-2 text-sm font-medium rounded-md">
                  🔍 관찰성 ▾
                </button>
                <div class="absolute top-full left-0 mt-1 w-48 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                  <a href="/logs-dashboard.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white">📋 로그 대시보드</a>
                  <a href="/metrics-dashboard.html" class="block px-4 py-2 text-sm text-blue-700 dark:text-blue-300 bg-blue-50 dark:bg-blue-900/30 hover:bg-blue-100 dark:hover:bg-blue-900/50">📊 메트릭 대시보드</a>
                  <a href="/traces-dashboard.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white">🔗 트레이스 대시보드</a>
                </div>
              </div>

              <!-- 세션 분석 드롭다운 -->
              <div class="relative group">
                <button class="text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white transition-colors bg-transparent border-none cursor-pointer flex items-center px-3 py-2 text-sm font-medium">
                  👥 세션 분석 ▾
                </button>
                <div class="absolute top-full left-0 mt-1 w-48 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                  <a href="/session-analysis.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white">📈 세션 분석</a>
                  <a href="/session-telemetry-dashboard.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white">🛰️ 세션 텔레메트리</a>
                  <a href="/session-replay.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white">🎬 세션 리플레이</a>
                </div>
              </div>

              <!-- 시스템 관리 드롭다운 -->
              <div class="relative group">
                <button class="text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white transition-colors bg-transparent border-none cursor-pointer flex items-center px-3 py-2 text-sm font-medium">
                  🛠️ 시스템 관리 ▾
                </button>
                <div class="absolute top-full left-0 mt-1 w-48 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                  <a href="/services-management.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white">⚙️ 서비스 관리</a>
                  <a href="/deployment-manager.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white">🚀 배포 관리</a>
                  <a href="/ontology.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white">🧠 온톨로지 시스템</a>
                </div>
              </div>

            </div>
          </div>
          <div class="flex items-center space-x-4">
            <button id="darkModeToggle" class="p-2 rounded-md text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white">
              <span class="dark:hidden">🌙</span>
              <span class="hidden dark:inline">☀️</span>
            </button>
            <div id="systemStatus" class="flex items-center space-x-2">
              <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
              <span class="text-sm text-gray-600 dark:text-gray-300">시스템 정상</span>
            </div>
          </div>
        </div>
      </div>
    </nav>

    <!-- Header -->
    <header class="bg-white dark:bg-gray-800 shadow">
      <div class="max-w-7xl mx-auto px-4 py-6 sm:px-6 lg:px-8">
        <div class="md:flex md:items-center md:justify-between">
          <div class="flex-1 min-w-0">
            <h2 class="text-2xl font-bold leading-7 text-gray-900 dark:text-white sm:text-3xl sm:truncate">
              📊 메트릭 모니터링 대시보드
            </h2>
            <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">
              실시간 시스템 성능 지표 및 리소스 모니터링
            </p>
          </div>
          <div class="mt-4 md:mt-0 flex space-x-3">
            <button id="refreshBtn" class="bg-primary text-primary-foreground px-4 py-2 rounded-md hover:bg-primary/90 transition-colors">
              🔄 새로고침
            </button>
            <select id="timeRangeSelect" class="px-4 py-2 border border-input rounded-md">
              <option value="5m">최근 5분</option>
              <option value="15m" selected>최근 15분</option>
              <option value="1h">최근 1시간</option>
              <option value="6h">최근 6시간</option>
            </select>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 py-8 sm:px-6 lg:px-8">
      
      <!-- System Overview Cards -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <div class="metric-card bg-card rounded-lg border border-border p-6">
          <div class="flex items-center justify-between">
            <div>
              <div class="flex items-center space-x-2">
                <span class="status-indicator status-healthy"></span>
                <p class="text-sm font-medium text-muted-foreground">CPU 사용률</p>
              </div>
              <p class="text-2xl font-bold text-card-foreground" id="cpuUsage">0%</p>
            </div>
            <div class="h-8 w-8 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center">
              <span class="text-blue-600 dark:text-blue-400">⚡</span>
            </div>
          </div>
          <p class="text-xs mt-2" id="cpuTrend">
            <span class="metric-trend-up">↗️ +2.3%</span> 지난 시간 대비
          </p>
        </div>

        <div class="metric-card bg-card rounded-lg border border-border p-6">
          <div class="flex items-center justify-between">
            <div>
              <div class="flex items-center space-x-2">
                <span class="status-indicator status-warning"></span>
                <p class="text-sm font-medium text-muted-foreground">메모리 사용률</p>
              </div>
              <p class="text-2xl font-bold text-card-foreground" id="memoryUsage">0%</p>
            </div>
            <div class="h-8 w-8 bg-green-100 dark:bg-green-900 rounded-full flex items-center justify-center">
              <span class="text-green-600 dark:text-green-400">💾</span>
            </div>
          </div>
          <p class="text-xs mt-2" id="memoryTrend">
            <span class="metric-trend-down">↘️ -1.2%</span> 지난 시간 대비
          </p>
        </div>

        <div class="metric-card bg-card rounded-lg border border-border p-6">
          <div class="flex items-center justify-between">
            <div>
              <div class="flex items-center space-x-2">
                <span class="status-indicator status-healthy"></span>
                <p class="text-sm font-medium text-muted-foreground">네트워크 I/O</p>
              </div>
              <p class="text-2xl font-bold text-card-foreground" id="networkIO">0 MB/s</p>
            </div>
            <div class="h-8 w-8 bg-purple-100 dark:bg-purple-900 rounded-full flex items-center justify-center">
              <span class="text-purple-600 dark:text-purple-400">🌐</span>
            </div>
          </div>
          <p class="text-xs mt-2" id="networkTrend">
            <span class="metric-trend-stable">→ 0.0%</span> 지난 시간 대비
          </p>
        </div>

        <div class="metric-card bg-card rounded-lg border border-border p-6">
          <div class="flex items-center justify-between">
            <div>
              <div class="flex items-center space-x-2">
                <span class="status-indicator status-healthy"></span>
                <p class="text-sm font-medium text-muted-foreground">디스크 사용률</p>
              </div>
              <p class="text-2xl font-bold text-card-foreground" id="diskUsage">0%</p>
            </div>
            <div class="h-8 w-8 bg-orange-100 dark:bg-orange-900 rounded-full flex items-center justify-center">
              <span class="text-orange-600 dark:text-orange-400">💿</span>
            </div>
          </div>
          <p class="text-xs mt-2" id="diskTrend">
            <span class="metric-trend-up">↗️ +0.5%</span> 지난 시간 대비
          </p>
        </div>
      </div>

      <!-- System Resources Charts -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
        <!-- CPU and Memory Chart -->
        <div class="bg-card rounded-lg border border-border p-6">
          <h3 class="text-lg font-semibold text-card-foreground mb-4">⚡ CPU & 메모리 사용률</h3>
          <div class="h-64">
            <canvas id="systemResourcesChart"></canvas>
          </div>
        </div>

        <!-- Network Traffic Chart -->
        <div class="bg-card rounded-lg border border-border p-6">
          <h3 class="text-lg font-semibold text-card-foreground mb-4">🌐 네트워크 트래픽</h3>
          <div class="h-64">
            <canvas id="networkChart"></canvas>
          </div>
        </div>
      </div>

      <!-- Application Metrics -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
        <!-- Response Time Chart -->
        <div class="bg-card rounded-lg border border-border p-6">
          <h3 class="text-lg font-semibold text-card-foreground mb-4">⏱️ 응답 시간</h3>
          <div class="h-48">
            <canvas id="responseTimeChart"></canvas>
          </div>
        </div>

        <!-- Throughput Chart -->
        <div class="bg-card rounded-lg border border-border p-6">
          <h3 class="text-lg font-semibold text-card-foreground mb-4">📈 처리량</h3>
          <div class="h-48">
            <canvas id="throughputChart"></canvas>
          </div>
        </div>

        <!-- Error Rate Chart -->
        <div class="bg-card rounded-lg border border-border p-6">
          <h3 class="text-lg font-semibold text-card-foreground mb-4">🚨 에러율</h3>
          <div class="h-48">
            <canvas id="errorRateChart"></canvas>
          </div>
        </div>
      </div>

      <!-- Service Metrics Table -->
      <div class="bg-card rounded-lg border border-border p-6 mb-8">
        <h3 class="text-lg font-semibold text-card-foreground mb-4">🏗️ 서비스별 메트릭</h3>
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-border">
            <thead class="bg-muted">
              <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider">서비스</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider">상태</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider">CPU</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider">메모리</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider">응답시간</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider">처리량</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider">에러율</th>
              </tr>
            </thead>
            <tbody id="serviceMetricsTable" class="bg-card divide-y divide-border">
              <!-- Table rows will be populated by JavaScript -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Database Metrics -->
      <div class="bg-card rounded-lg border border-border p-6">
        <h3 class="text-lg font-semibold text-card-foreground mb-6">🗄️ 데이터베이스 메트릭</h3>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <!-- Database Connections -->
          <div>
            <h4 class="text-md font-medium text-card-foreground mb-3">연결 수</h4>
            <div class="h-48">
              <canvas id="dbConnectionsChart"></canvas>
            </div>
          </div>

          <!-- Query Performance -->
          <div>
            <h4 class="text-md font-medium text-card-foreground mb-3">쿼리 성능</h4>
            <div class="h-48">
              <canvas id="queryPerformanceChart"></canvas>
            </div>
          </div>
        </div>

        <!-- Database Status Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mt-6">
          <div class="bg-muted rounded-lg p-4">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm text-muted-foreground">PostgreSQL</p>
                <p class="text-xl font-semibold" id="postgresConnections">0</p>
              </div>
              <span class="status-indicator status-healthy"></span>
            </div>
          </div>
          <div class="bg-muted rounded-lg p-4">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm text-muted-foreground">MongoDB</p>
                <p class="text-xl font-semibold" id="mongoConnections">0</p>
              </div>
              <span class="status-indicator status-healthy"></span>
            </div>
          </div>
          <div class="bg-muted rounded-lg p-4">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm text-muted-foreground">Redis</p>
                <p class="text-xl font-semibold" id="redisConnections">0</p>
              </div>
              <span class="status-indicator status-warning"></span>
            </div>
          </div>
          <div class="bg-muted rounded-lg p-4">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm text-muted-foreground">ClickHouse</p>
                <p class="text-xl font-semibold" id="clickhouseConnections">0</p>
              </div>
              <span class="status-indicator status-healthy"></span>
            </div>
          </div>
        </div>
      </div>

    </main>
  </div>

  <script>
    // Navigation event listeners
    document.getElementById('homeBtn').addEventListener('click', () => window.location.href = '/');
    document.getElementById('logsBtn').addEventListener('click', () => window.location.href = '/logs-dashboard.html');
    document.getElementById('tracesBtn').addEventListener('click', () => window.location.href = '/traces-dashboard.html');
    document.getElementById('servicesBtn').addEventListener('click', () => window.location.href = '/services-management.html');

    let charts = {};
    let metrics = {
      cpu: [],
      memory: [],
      network: [],
      disk: [],
      responseTime: [],
      throughput: [],
      errorRate: [],
      dbConnections: [],
      queryPerformance: []
    };

    // Initialize all charts
    function initCharts() {
      // System Resources Chart
      const systemCtx = document.getElementById('systemResourcesChart').getContext('2d');
      charts.systemResources = new Chart(systemCtx, {
        type: 'line',
        data: {
          labels: [],
          datasets: [{
            label: 'CPU (%)',
            data: [],
            borderColor: 'rgb(59, 130, 246)',
            backgroundColor: 'rgba(59, 130, 246, 0.1)',
            tension: 0.4,
            yAxisID: 'y'
          }, {
            label: '메모리 (%)',
            data: [],
            borderColor: 'rgb(34, 197, 94)',
            backgroundColor: 'rgba(34, 197, 94, 0.1)',
            tension: 0.4,
            yAxisID: 'y'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { position: 'top' }
          },
          scales: {
            y: {
              beginAtZero: true,
              max: 100,
              title: { display: true, text: '사용률 (%)' }
            }
          }
        }
      });

      // Network Chart
      const networkCtx = document.getElementById('networkChart').getContext('2d');
      charts.network = new Chart(networkCtx, {
        type: 'line',
        data: {
          labels: [],
          datasets: [{
            label: '인바운드 (MB/s)',
            data: [],
            borderColor: 'rgb(168, 85, 247)',
            backgroundColor: 'rgba(168, 85, 247, 0.1)',
            tension: 0.4
          }, {
            label: '아웃바운드 (MB/s)',
            data: [],
            borderColor: 'rgb(236, 72, 153)',
            backgroundColor: 'rgba(236, 72, 153, 0.1)',
            tension: 0.4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { position: 'top' }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: { display: true, text: 'MB/s' }
            }
          }
        }
      });

      // Response Time Chart
      const responseTimeCtx = document.getElementById('responseTimeChart').getContext('2d');
      charts.responseTime = new Chart(responseTimeCtx, {
        type: 'line',
        data: {
          labels: [],
          datasets: [{
            label: '응답 시간 (ms)',
            data: [],
            borderColor: 'rgb(245, 158, 11)',
            backgroundColor: 'rgba(245, 158, 11, 0.1)',
            tension: 0.4,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: { display: true, text: 'ms' }
            }
          }
        }
      });

      // Throughput Chart
      const throughputCtx = document.getElementById('throughputChart').getContext('2d');
      charts.throughput = new Chart(throughputCtx, {
        type: 'bar',
        data: {
          labels: [],
          datasets: [{
            label: '요청/초',
            data: [],
            backgroundColor: 'rgba(34, 197, 94, 0.8)',
            borderColor: 'rgb(34, 197, 94)',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: { display: true, text: '요청/초' }
            }
          }
        }
      });

      // Error Rate Chart
      const errorRateCtx = document.getElementById('errorRateChart').getContext('2d');
      charts.errorRate = new Chart(errorRateCtx, {
        type: 'line',
        data: {
          labels: [],
          datasets: [{
            label: '에러율 (%)',
            data: [],
            borderColor: 'rgb(239, 68, 68)',
            backgroundColor: 'rgba(239, 68, 68, 0.1)',
            tension: 0.4,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: { display: true, text: '에러율 (%)' }
            }
          }
        }
      });

      // Database Connections Chart
      const dbConnectionsCtx = document.getElementById('dbConnectionsChart').getContext('2d');
      charts.dbConnections = new Chart(dbConnectionsCtx, {
        type: 'line',
        data: {
          labels: [],
          datasets: [{
            label: 'PostgreSQL',
            data: [],
            borderColor: 'rgb(59, 130, 246)',
            tension: 0.4
          }, {
            label: 'MongoDB',
            data: [],
            borderColor: 'rgb(34, 197, 94)',
            tension: 0.4
          }, {
            label: 'Redis',
            data: [],
            borderColor: 'rgb(239, 68, 68)',
            tension: 0.4
          }, {
            label: 'ClickHouse',
            data: [],
            borderColor: 'rgb(245, 158, 11)',
            tension: 0.4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { position: 'top' }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: { display: true, text: '연결 수' }
            }
          }
        }
      });

      // Query Performance Chart
      const queryPerfCtx = document.getElementById('queryPerformanceChart').getContext('2d');
      charts.queryPerformance = new Chart(queryPerfCtx, {
        type: 'bar',
        data: {
          labels: ['PostgreSQL', 'MongoDB', 'Redis', 'ClickHouse'],
          datasets: [{
            label: '평균 쿼리 시간 (ms)',
            data: [],
            backgroundColor: [
              'rgba(59, 130, 246, 0.8)',
              'rgba(34, 197, 94, 0.8)',
              'rgba(239, 68, 68, 0.8)',
              'rgba(245, 158, 11, 0.8)'
            ]
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: { display: true, text: 'ms' }
            }
          }
        }
      });
    }

    // Generate sample metric data
    function generateSampleData() {
      const now = new Date();
      const labels = [];
      
      // Generate 20 data points for the last 20 minutes
      for (let i = 19; i >= 0; i--) {
        const time = new Date(now.getTime() - i * 60000);
        labels.push(time.toLocaleTimeString('ko-KR', {hour: '2-digit', minute: '2-digit'}));
      }

      // Generate realistic metric data
      metrics.cpu = generateRealisticData(20, 15, 85, 5);
      metrics.memory = generateRealisticData(20, 45, 80, 3);
      metrics.network = generateRealisticData(20, 5, 50, 8);
      metrics.disk = generateRealisticData(20, 60, 75, 2);
      metrics.responseTime = generateRealisticData(20, 50, 200, 20);
      metrics.throughput = generateRealisticData(20, 100, 500, 50);
      metrics.errorRate = generateRealisticData(20, 0.1, 5, 1);

      return labels;
    }

    function generateRealisticData(count, min, max, volatility) {
      const data = [];
      let current = min + (max - min) * Math.random();
      
      for (let i = 0; i < count; i++) {
        const change = (Math.random() - 0.5) * volatility;
        current = Math.max(min, Math.min(max, current + change));
        data.push(parseFloat(current.toFixed(2)));
      }
      
      return data;
    }

    // Update all charts
    function updateCharts() {
      const labels = generateSampleData();

      // Update system resources chart
      charts.systemResources.data.labels = labels;
      charts.systemResources.data.datasets[0].data = metrics.cpu;
      charts.systemResources.data.datasets[1].data = metrics.memory;
      charts.systemResources.update('none');

      // Update network chart
      const networkInbound = metrics.network.map(v => v * 0.6);
      const networkOutbound = metrics.network.map(v => v * 0.4);
      charts.network.data.labels = labels;
      charts.network.data.datasets[0].data = networkInbound;
      charts.network.data.datasets[1].data = networkOutbound;
      charts.network.update('none');

      // Update application metrics
      charts.responseTime.data.labels = labels;
      charts.responseTime.data.datasets[0].data = metrics.responseTime;
      charts.responseTime.update('none');

      charts.throughput.data.labels = labels.slice(-10); // Last 10 minutes
      charts.throughput.data.datasets[0].data = metrics.throughput.slice(-10);
      charts.throughput.update('none');

      charts.errorRate.data.labels = labels;
      charts.errorRate.data.datasets[0].data = metrics.errorRate;
      charts.errorRate.update('none');

      // Update database charts
      const dbConnData = {
        postgres: generateRealisticData(20, 10, 50, 5),
        mongo: generateRealisticData(20, 5, 30, 3),
        redis: generateRealisticData(20, 20, 100, 10),
        clickhouse: generateRealisticData(20, 8, 25, 2)
      };

      charts.dbConnections.data.labels = labels;
      charts.dbConnections.data.datasets[0].data = dbConnData.postgres;
      charts.dbConnections.data.datasets[1].data = dbConnData.mongo;
      charts.dbConnections.data.datasets[2].data = dbConnData.redis;
      charts.dbConnections.data.datasets[3].data = dbConnData.clickhouse;
      charts.dbConnections.update('none');

      // Update query performance
      charts.queryPerformance.data.datasets[0].data = [45, 32, 8, 120];
      charts.queryPerformance.update('none');
    }

    // Update overview cards
    function updateOverviewCards() {
      const latestCpu = metrics.cpu[metrics.cpu.length - 1];
      const latestMemory = metrics.memory[metrics.memory.length - 1];
      const latestNetwork = metrics.network[metrics.network.length - 1];
      const latestDisk = metrics.disk[metrics.disk.length - 1];

      document.getElementById('cpuUsage').textContent = `${latestCpu}%`;
      document.getElementById('memoryUsage').textContent = `${latestMemory}%`;
      document.getElementById('networkIO').textContent = `${latestNetwork} MB/s`;
      document.getElementById('diskUsage').textContent = `${latestDisk}%`;

      // Update database connection counts
      document.getElementById('postgresConnections').textContent = '45';
      document.getElementById('mongoConnections').textContent = '23';
      document.getElementById('redisConnections').textContent = '78';
      document.getElementById('clickhouseConnections').textContent = '12';
    }

    // Update service metrics table
    function updateServiceMetricsTable() {
      const services = [
        { name: 'API Gateway', status: 'healthy', cpu: '23%', memory: '45%', responseTime: '85ms', throughput: '450/s', errorRate: '0.2%' },
        { name: 'Analytics Engine', status: 'healthy', cpu: '67%', memory: '78%', responseTime: '120ms', throughput: '234/s', errorRate: '0.1%' },
        { name: 'Session Replay', status: 'warning', cpu: '89%', memory: '82%', responseTime: '200ms', throughput: '156/s', errorRate: '1.2%' },
        { name: 'AIOps Engine', status: 'healthy', cpu: '34%', memory: '56%', responseTime: '95ms', throughput: '189/s', errorRate: '0.3%' },
        { name: 'J2EE Monitor', status: 'critical', cpu: '91%', memory: '94%', responseTime: '450ms', throughput: '67/s', errorRate: '4.8%' },
        { name: 'Data Ingestion', status: 'healthy', cpu: '45%', memory: '67%', responseTime: '110ms', throughput: '345/s', errorRate: '0.4%' }
      ];

      const tbody = document.getElementById('serviceMetricsTable');
      tbody.innerHTML = services.map(service => `
        <tr class="hover:bg-muted/50">
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-card-foreground">${service.name}</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-muted-foreground">
            <span class="status-indicator status-${service.status}"></span>
            <span class="ml-2 capitalize">${service.status}</span>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-muted-foreground">${service.cpu}</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-muted-foreground">${service.memory}</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-muted-foreground">${service.responseTime}</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-muted-foreground">${service.throughput}</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-muted-foreground">${service.errorRate}</td>
        </tr>
      `).join('');
    }

    // Event listeners
    document.getElementById('refreshBtn').addEventListener('click', () => {
      updateCharts();
      updateOverviewCards();
      updateServiceMetricsTable();
    });

    document.getElementById('timeRangeSelect').addEventListener('change', (e) => {
      const range = e.target.value;
      console.log(`Time range changed to: ${range}`);
      updateCharts();
    });

    // Initialize on load
    document.addEventListener('DOMContentLoaded', () => {
      initCharts();
      updateCharts();
      updateOverviewCards();
      updateServiceMetricsTable();

      // Auto-refresh every 30 seconds
      setInterval(() => {
        updateCharts();
        updateOverviewCards();
        updateServiceMetricsTable();
      }, 30000);
    });
  </script>
</body>
</html>