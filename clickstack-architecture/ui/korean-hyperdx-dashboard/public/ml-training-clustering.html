<!DOCTYPE html>
<html lang="ko" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>패턴 클러스터링 모델 학습 - AIRIS EPM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* shadcn/ui CSS Variables */
        :root {
            --background: 0 0% 100%;
            --foreground: 222.2 84% 4.9%;
            --card: 0 0% 100%;
            --card-foreground: 222.2 84% 4.9%;
            --popover: 0 0% 100%;
            --popover-foreground: 222.2 84% 4.9%;
            --primary: 222.2 47.4% 11.2%;
            --primary-foreground: 210 40% 98%;
            --secondary: 210 40% 96.1%;
            --secondary-foreground: 222.2 47.4% 11.2%;
            --muted: 210 40% 96.1%;
            --muted-foreground: 215.4 16.3% 46.9%;
            --accent: 210 40% 96.1%;
            --accent-foreground: 222.2 47.4% 11.2%;
            --destructive: 0 84.2% 60.2%;
            --destructive-foreground: 210 40% 98%;
            --border: 214.3 31.8% 91.4%;
            --input: 214.3 31.8% 91.4%;
            --ring: 222.2 84% 4.9%;
            --radius: 0.5rem;
        }
        .dark {
            --background: 222.2 84% 4.9%;
            --foreground: 210 40% 98%;
            --card: 222.2 84% 4.9%;
            --card-foreground: 210 40% 98%;
            --popover: 222.2 84% 4.9%;
            --popover-foreground: 210 40% 98%;
            --primary: 210 40% 98%;
            --primary-foreground: 222.2 47.4% 11.2%;
            --secondary: 217.2 32.6% 17.5%;
            --secondary-foreground: 210 40% 98%;
            --muted: 217.2 32.6% 17.5%;
            --muted-foreground: 215 20.2% 65.1%;
            --accent: 217.2 32.6% 17.5%;
            --accent-foreground: 210 40% 98%;
            --destructive: 0 62.8% 30.6%;
            --destructive-foreground: 210 40% 98%;
            --border: 217.2 32.6% 17.5%;
            --input: 217.2 32.6% 17.5%;
            --ring: 212.7 26.8% 83.9%;
        }

        .btn {
            @apply inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none ring-offset-background;
        }

        .btn-primary {
            @apply bg-primary text-primary-foreground hover:bg-primary/90;
            padding: 0.5rem 1rem;
        }

        .btn-ghost {
            @apply hover:bg-accent hover:text-accent-foreground;
            padding: 0.5rem 1rem;
        }
        
        /* Chart Container Fixed Height */
        .ml-chart-container {
            width: 100% !important;
            position: relative !important;
            overflow: hidden !important;
        }
        
        .ml-chart-container.h-48 {
            height: 12rem !important; /* 192px */
        }
        
        .ml-chart-container.h-64 {
            height: 16rem !important; /* 256px */
        }
        
        .ml-chart-container canvas {
            position: absolute !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
        }
    </style>
</head>
<body class="bg-background text-foreground">
    <!-- Navigation -->
    <nav class="border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60">
        <div class="container mx-auto px-4">
            <div class="flex h-14 items-center">
                <a href="/portal.html" class="text-xl font-bold text-gray-900 dark:text-white hover:text-blue-600 dark:hover:text-blue-400 transition-colors cursor-pointer">🚀 AIRIS EPM</a>
                
                <div class="ml-auto flex items-center space-x-4">
                    <!-- APM 모니터링 드롭다운 -->
                    <div class="relative group">
                        <button class="flex items-center space-x-1 px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 hover:text-gray-900 dark:hover:text-white">
                            <span>📊 APM 모니터링</span>
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div class="absolute left-0 mt-1 w-48 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                            <a href="/j2ee-dashboard.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">☕ J2EE 모니터링</a>
                            <a href="/was-dashboard.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">🏗️ WAS 모니터링</a>
                            <a href="/exception-dashboard.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">🚨 예외 추적</a>
                            <a href="/topology-dashboard.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">🗺️ 서비스 맵</a>
                            <a href="/performance-optimization-dashboard.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">⚡ 성능 최적화</a>
                        </div>
                    </div>

                    <!-- AI/ML 시스템 드롭다운 -->
                    <div class="relative group">
                        <button class="flex items-center space-x-1 px-3 py-2 text-sm font-medium text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20">
                            <span>🤖 AI/ML 시스템</span>
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div class="absolute left-0 mt-1 w-56 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                            <a href="/ai-prediction-dashboard.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">🔮 AI 예측 분석</a>
                            <a href="/data-quality-dashboard.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">📊 데이터 품질</a>
                            <a href="/aiops-management.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">🤖 AIOps 관리</a>
                            <div class="border-t border-gray-200 dark:border-gray-600 my-1"></div>
                            <div class="px-4 py-2 text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide font-semibold">ML 훈련</div>
                            <a href="/ml-training-autoencoder.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">🔬 오토인코더</a>
                            <a href="/ml-training-clustering.html" class="block px-4 py-2 text-sm text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 hover:bg-blue-100 dark:hover:bg-blue-900/40">🎯 클러스터링</a>
                            <a href="/ml-training-lstm.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">🧠 LSTM</a>
                            <a href="/ml-training-rca.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">🔍 RCA 분석</a>
                            <a href="/ml-training-report.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">📋 훈련 리포트</a>
                            <a href="/clustering-insights.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">💡 인사이트</a>
                        </div>
                    </div>

                    <!-- 시스템 관리 드롭다운 -->
                    <div class="relative group">
                        <button class="flex items-center space-x-1 px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 hover:text-gray-900 dark:hover:text-white">
                            <span>⚙️ 시스템 관리</span>
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div class="absolute left-0 mt-1 w-48 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                            <a href="/alert-dashboard.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">🔔 알림 관리</a>
                            <a href="/security-dashboard.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">🛡️ 보안 모니터링</a>
                            <a href="/log-analysis-dashboard.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">📄 로그 분석</a>
                            <a href="/external-integration-dashboard.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">🔗 외부 통합</a>
                            <a href="/system-config-dashboard.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">⚙️ 시스템 설정</a>
                        </div>
                    </div>

                    <!-- 분석 & 리포트 드롭다운 -->
                    <div class="relative group">
                        <button class="flex items-center space-x-1 px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 hover:text-gray-900 dark:hover:text-white">
                            <span>📈 분석 & 리포트</span>
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div class="absolute right-0 mt-1 w-56 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                            <a href="/deployment-manager.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">🚀 배포 관리</a>
                            <a href="/session-management.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">👤 세션 관리</a>
                            <div class="border-t border-gray-200 dark:border-gray-600 my-1"></div>
                            <div class="px-4 py-2 text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide font-semibold">온톨로지</div>
                            <a href="/ontology.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">🧠 기본 온톨로지</a>
                            <a href="/ontology-tabs.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">📂 탭 온톨로지</a>
                            <a href="/ontology-complete.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">🔗 완전 온톨로지</a>
                        </div>
                    </div>

                    <!-- 챗봇 아이콘 -->
                    <button onclick="window.open('/chatbot.html', '_blank', 'width=1200,height=800,scrollbars=yes,resizable=yes')" class="btn btn-ghost" title="지능형 분석 챗봇">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                        </svg>
                    </button>

                    <!-- 테마 토글 -->
                    <button id="themeToggle" class="btn btn-ghost">🌙</button>
                </div>
            </div>
        </div>
    </nav>

    <main class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- Page Title -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold mb-2">🎯 패턴 클러스터링 모델 학습</h1>
            <p class="text-muted-foreground">시스템 행동 패턴을 자동 분류하여 유사한 이상 상황을 그룹화하는 AI 모델</p>
        </div>

        <!-- Cluster Categories Preview -->
        <div class="bg-card rounded-lg border p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4">패턴 클러스터 분류</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="bg-gradient-to-br from-red-50 to-red-100 dark:from-red-900/20 dark:to-red-800/20 border border-red-200 dark:border-red-700 rounded p-4">
                    <div class="flex items-center mb-2">
                        <div class="w-3 h-3 bg-red-500 rounded-full mr-2"></div>
                        <h3 class="font-medium text-red-800 dark:text-red-200">클러스터 A</h3>
                    </div>
                    <p class="text-xs text-red-600 dark:text-red-300 mb-2">고부하 CPU + 메모리 급증</p>
                    <div class="text-xs text-red-600 dark:text-red-300">
                        <p>• 패턴 수: 2,143</p>
                        <p>• 평균 심각도: High</p>
                        <p>• 주요 시간대: 오후 2-4시</p>
                    </div>
                </div>

                <div class="bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 border border-blue-200 dark:border-blue-700 rounded p-4">
                    <div class="flex items-center mb-2">
                        <div class="w-3 h-3 bg-blue-500 rounded-full mr-2"></div>
                        <h3 class="font-medium text-blue-800 dark:text-blue-200">클러스터 B</h3>
                    </div>
                    <p class="text-xs text-blue-600 dark:text-blue-300 mb-2">네트워크 지연 + 응답시간 증가</p>
                    <div class="text-xs text-blue-600 dark:text-blue-300">
                        <p>• 패턴 수: 1,867</p>
                        <p>• 평균 심각도: Medium</p>
                        <p>• 주요 시간대: 오전 9-11시</p>
                    </div>
                </div>

                <div class="bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 border border-green-200 dark:border-green-700 rounded p-4">
                    <div class="flex items-center mb-2">
                        <div class="w-3 h-3 bg-green-500 rounded-full mr-2"></div>
                        <h3 class="font-medium text-green-800 dark:text-green-200">클러스터 C</h3>
                    </div>
                    <p class="text-xs text-green-600 dark:text-green-300 mb-2">디스크 I/O + 데이터베이스 병목</p>
                    <div class="text-xs text-green-600 dark:text-green-300">
                        <p>• 패턴 수: 1,324</p>
                        <p>• 평균 심각도: High</p>
                        <p>• 주요 시간대: 밤 10시-새벽 2시</p>
                    </div>
                </div>

                <div class="bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 border border-purple-200 dark:border-purple-700 rounded p-4">
                    <div class="flex items-center mb-2">
                        <div class="w-3 h-3 bg-purple-500 rounded-full mr-2"></div>
                        <h3 class="font-medium text-purple-800 dark:text-purple-200">클러스터 D</h3>
                    </div>
                    <p class="text-xs text-purple-600 dark:text-purple-300 mb-2">간헐적 에러 + 연결 실패</p>
                    <div class="text-xs text-purple-600 dark:text-purple-300">
                        <p>• 패턴 수: 956</p>
                        <p>• 평균 심각도: Low</p>
                        <p>• 주요 시간대: 불규칙적</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Model Architecture & Current Clusters -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- Clustering Model Architecture -->
            <div class="bg-card rounded-lg border p-6">
                <h2 class="text-xl font-semibold mb-4">클러스터링 모델 아키텍처</h2>
                <div class="space-y-4">
                    <div>
                        <h3 class="font-medium text-sm mb-2">입력층</h3>
                        <div class="bg-muted rounded p-3 text-xs">
                            <p><strong>차원:</strong> 30개 특성 (메트릭 + 로그 패턴)</p>
                            <p><strong>전처리:</strong> MinMax Scaling, PCA 차원 축소</p>
                        </div>
                    </div>
                    <div>
                        <h3 class="font-medium text-sm mb-2">특성 추출층</h3>
                        <div class="space-y-1 text-xs">
                            <div class="flex justify-between">
                                <span>Dense Layer 1</span>
                                <span class="font-mono">64 units (ReLU)</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Dense Layer 2</span>
                                <span class="font-mono">32 units (ReLU)</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Dense Layer 3</span>
                                <span class="font-mono">16 units (ReLU)</span>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h3 class="font-medium text-sm mb-2">클러스터링층</h3>
                        <div class="bg-muted rounded p-3 text-xs">
                            <p><strong>출력:</strong> 8개 클러스터 (Softmax)</p>
                            <p><strong>손실함수:</strong> Categorical Crossentropy</p>
                            <p><strong>클러스터링 기법:</strong> K-means + Neural Network</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Current Cluster Visualization -->
            <div class="bg-card rounded-lg border p-6">
                <h2 class="text-xl font-semibold mb-4">현재 클러스터 분포</h2>
                <div class="h-48 mb-4 ml-chart-container">
                    <canvas id="clusterDistributionChart" class="w-full h-full"></canvas>
                </div>
                <div class="space-y-2">
                    <div class="flex justify-between text-sm">
                        <span class="text-muted-foreground">총 패턴 수</span>
                        <span class="font-medium">8,290</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span class="text-muted-foreground">실루엣 점수</span>
                        <span class="font-medium text-green-600">0.742</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span class="text-muted-foreground">클러스터 응집도</span>
                        <span class="font-medium text-blue-600">87.3%</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span class="text-muted-foreground">마지막 업데이트</span>
                        <span class="font-medium">2024-08-27 14:22</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Training Configuration -->
        <div class="bg-card rounded-lg border p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4">클러스터링 모델 학습 설정</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                <!-- Cluster Count -->
                <div>
                    <label class="block text-sm font-medium mb-2">클러스터 수</label>
                    <input type="number" id="clusterCount" value="8" min="2" max="20" 
                           class="w-full px-3 py-2 bg-background border rounded-md focus:ring-2 focus:ring-primary">
                </div>

                <!-- Data Selection -->
                <div>
                    <label class="block text-sm font-medium mb-2">데이터 범위</label>
                    <select id="dataRange" class="w-full px-3 py-2 bg-background border rounded-md focus:ring-2 focus:ring-primary">
                        <option value="week">최근 1주</option>
                        <option value="month">최근 1개월</option>
                        <option value="quarter">최근 3개월</option>
                        <option value="year">최근 1년</option>
                    </select>
                </div>

                <!-- Learning Rate -->
                <div>
                    <label class="block text-sm font-medium mb-2">학습률</label>
                    <input type="number" id="learningRate" value="0.001" step="0.0001" min="0.00001" max="0.1" 
                           class="w-full px-3 py-2 bg-background border rounded-md focus:ring-2 focus:ring-primary">
                </div>

                <!-- Batch Size -->
                <div>
                    <label class="block text-sm font-medium mb-2">배치 크기</label>
                    <input type="number" id="batchSize" value="32" min="8" max="256" 
                           class="w-full px-3 py-2 bg-background border rounded-md focus:ring-2 focus:ring-primary">
                </div>
            </div>

            <!-- Advanced Clustering Settings -->
            <div class="pt-6 border-t">
                <h3 class="font-medium mb-4">고급 클러스터링 설정</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">초기화 방법</label>
                        <select id="initMethod" class="w-full px-3 py-2 bg-background border rounded-md focus:ring-2 focus:ring-primary">
                            <option value="kmeans++">K-means++</option>
                            <option value="random">Random</option>
                            <option value="pca">PCA-based</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">거리 메트릭</label>
                        <select id="distanceMetric" class="w-full px-3 py-2 bg-background border rounded-md focus:ring-2 focus:ring-primary">
                            <option value="euclidean">유클리드</option>
                            <option value="cosine">코사인</option>
                            <option value="manhattan">맨하탄</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">차원 축소</label>
                        <input type="number" id="pcaComponents" value="16" min="5" max="30" 
                               class="w-full px-3 py-2 bg-background border rounded-md focus:ring-2 focus:ring-primary">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">에포크 수</label>
                        <input type="number" id="epochs" value="60" min="20" max="300" 
                               class="w-full px-3 py-2 bg-background border rounded-md focus:ring-2 focus:ring-primary">
                    </div>
                </div>
            </div>

            <!-- Feature Selection -->
            <div class="pt-6 border-t">
                <h3 class="font-medium mb-4">클러스터링 특성 선택</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                    <div class="flex items-center space-x-2">
                        <input type="checkbox" id="cpuMetrics" checked class="rounded">
                        <label for="cpuMetrics" class="text-sm">CPU 메트릭</label>
                    </div>
                    <div class="flex items-center space-x-2">
                        <input type="checkbox" id="memoryMetrics" checked class="rounded">
                        <label for="memoryMetrics" class="text-sm">메모리 메트릭</label>
                    </div>
                    <div class="flex items-center space-x-2">
                        <input type="checkbox" id="diskMetrics" checked class="rounded">
                        <label for="diskMetrics" class="text-sm">디스크 I/O</label>
                    </div>
                    <div class="flex items-center space-x-2">
                        <input type="checkbox" id="networkMetrics" checked class="rounded">
                        <label for="networkMetrics" class="text-sm">네트워크 메트릭</label>
                    </div>
                    <div class="flex items-center space-x-2">
                        <input type="checkbox" id="responseTime" checked class="rounded">
                        <label for="responseTime" class="text-sm">응답 시간</label>
                    </div>
                    <div class="flex items-center space-x-2">
                        <input type="checkbox" id="errorRates" checked class="rounded">
                        <label for="errorRates" class="text-sm">에러율</label>
                    </div>
                    <div class="flex items-center space-x-2">
                        <input type="checkbox" id="logPatterns" class="rounded">
                        <label for="logPatterns" class="text-sm">로그 패턴</label>
                    </div>
                    <div class="flex items-center space-x-2">
                        <input type="checkbox" id="timeFeatures" class="rounded">
                        <label for="timeFeatures" class="text-sm">시간적 특성</label>
                    </div>
                </div>
            </div>

            <!-- Training Controls -->
            <div class="mt-6 flex gap-4">
                <button id="startTrainingBtn" onclick="startTraining()" 
                        class="px-6 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors">
                    🚀 클러스터링 학습 시작
                </button>
                <button id="stopTrainingBtn" onclick="stopTraining()" disabled
                        class="px-6 py-2 bg-destructive text-destructive-foreground rounded-md hover:bg-destructive/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                    ⏹️ 학습 중단
                </button>
                <button onclick="optimizeClusterCount()"
                        class="px-6 py-2 bg-secondary text-secondary-foreground rounded-md hover:bg-secondary/90 transition-colors">
                    📊 최적 클러스터 수 찾기
                </button>
            </div>
        </div>

        <!-- Training Progress -->
        <div class="bg-card rounded-lg border p-6 mb-8" id="trainingProgress" style="display: none;">
            <h2 class="text-xl font-semibold mb-4">클러스터링 학습 진행 상황</h2>
            
            <!-- Progress Metrics -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                <div class="bg-gradient-to-br from-cyan-50 to-cyan-100 dark:from-cyan-900/20 dark:to-cyan-800/20 rounded p-3">
                    <p class="text-sm text-muted-foreground mb-1">실루엣 점수</p>
                    <p class="text-2xl font-bold text-cyan-700 dark:text-cyan-300" id="silhouetteScore">0.000</p>
                </div>
                <div class="bg-gradient-to-br from-teal-50 to-teal-100 dark:from-teal-900/20 dark:to-teal-800/20 rounded p-3">
                    <p class="text-sm text-muted-foreground mb-1">클러스터 응집도</p>
                    <p class="text-2xl font-bold text-teal-700 dark:text-teal-300" id="cohesionScore">0%</p>
                </div>
                <div class="bg-gradient-to-br from-indigo-50 to-indigo-100 dark:from-indigo-900/20 dark:to-indigo-800/20 rounded p-3">
                    <p class="text-sm text-muted-foreground mb-1">클러스터 분리도</p>
                    <p class="text-2xl font-bold text-indigo-700 dark:text-indigo-300" id="separationScore">0%</p>
                </div>
                <div class="bg-gradient-to-br from-rose-50 to-rose-100 dark:from-rose-900/20 dark:to-rose-800/20 rounded p-3">
                    <p class="text-sm text-muted-foreground mb-1">관성 (Inertia)</p>
                    <p class="text-2xl font-bold text-rose-700 dark:text-rose-300" id="inertiaScore">0.000</p>
                </div>
            </div>

            <!-- Progress Bar -->
            <div class="mb-6">
                <div class="flex justify-between mb-2">
                    <span class="text-sm text-muted-foreground">수렴 진행도</span>
                    <span class="text-sm font-medium" id="progressText">0 / 60 epochs</span>
                </div>
                <div class="w-full bg-muted rounded-full h-3">
                    <div id="progressBar" class="bg-gradient-to-r from-cyan-500 to-blue-600 h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
            </div>

            <!-- Training Visualization -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h3 class="font-medium mb-3">클러스터 수렴 과정</h3>
                    <div class="h-64 ml-chart-container">
                        <canvas id="convergenceChart" class="w-full h-full"></canvas>
                    </div>
                </div>
                <div>
                    <h3 class="font-medium mb-3">2D 클러스터 시각화 (PCA)</h3>
                    <div class="h-64 ml-chart-container">
                        <canvas id="clusterVisualizationChart" class="w-full h-full"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Clustering Results -->
        <div class="bg-card rounded-lg border p-6" id="clusteringResults" style="display: none;">
            <h2 class="text-xl font-semibold mb-4">클러스터링 결과 분석</h2>
            
            <!-- Cluster Quality Metrics -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-muted rounded p-4">
                    <h3 class="font-medium mb-3">클러스터 품질 지표</h3>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="text-sm">최종 실루엣 점수</span>
                            <span class="font-bold text-green-600" id="finalSilhouette">0.798</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">칼린스키-하라바즈 지수</span>
                            <span class="font-bold" id="chScore">234.7</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">데이비스-볼딘 지수</span>
                            <span class="font-bold" id="dbScore">0.42</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">최적 클러스터 수</span>
                            <span class="font-bold text-blue-600" id="optimalClusters">8</span>
                        </div>
                    </div>
                </div>

                <div class="bg-muted rounded p-4">
                    <h3 class="font-medium mb-3">클러스터 특성</h3>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="text-sm">가장 큰 클러스터</span>
                            <span class="font-bold text-red-600" id="largestCluster">클러스터 A (26%)</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">가장 작은 클러스터</span>
                            <span class="font-bold" id="smallestCluster">클러스터 G (7%)</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">평균 클러스터 크기</span>
                            <span class="font-bold" id="avgClusterSize">1,036</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">클러스터 간 최소 거리</span>
                            <span class="font-bold text-purple-600" id="minDistance">2.34</span>
                        </div>
                    </div>
                </div>

                <div class="bg-muted rounded p-4">
                    <h3 class="font-medium mb-3">비즈니스 인사이트</h3>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="text-sm">주요 패턴 발견</span>
                            <span class="font-bold text-green-600" id="mainPatterns">5가지</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">예방 가능한 장애</span>
                            <span class="font-bold" id="preventableIncidents">73%</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">분류 정확도 향상</span>
                            <span class="font-bold text-blue-600" id="accuracyImprovement">+23%</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">운영 효율성</span>
                            <span class="font-bold text-purple-600" id="operationalEfficiency">+34%</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cluster Details -->
            <div class="mb-6">
                <h3 class="font-medium mb-3">클러스터별 상세 분석</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead class="bg-muted">
                            <tr>
                                <th class="px-4 py-2 text-left">클러스터</th>
                                <th class="px-4 py-2 text-left">크기</th>
                                <th class="px-4 py-2 text-left">주요 특성</th>
                                <th class="px-4 py-2 text-left">심각도</th>
                                <th class="px-4 py-2 text-left">발생 시간대</th>
                                <th class="px-4 py-2 text-left">대응 전략</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y">
                            <tr>
                                <td class="px-4 py-2">
                                    <div class="flex items-center">
                                        <div class="w-3 h-3 bg-red-500 rounded-full mr-2"></div>
                                        클러스터 A
                                    </div>
                                </td>
                                <td class="px-4 py-2 font-medium">2,143 (26%)</td>
                                <td class="px-4 py-2">고CPU + 메모리 급증</td>
                                <td class="px-4 py-2 text-red-600">High</td>
                                <td class="px-4 py-2">오후 2-4시</td>
                                <td class="px-4 py-2 text-xs">자동 스케일링</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-2">
                                    <div class="flex items-center">
                                        <div class="w-3 h-3 bg-blue-500 rounded-full mr-2"></div>
                                        클러스터 B
                                    </div>
                                </td>
                                <td class="px-4 py-2 font-medium">1,867 (23%)</td>
                                <td class="px-4 py-2">네트워크 지연</td>
                                <td class="px-4 py-2 text-orange-600">Medium</td>
                                <td class="px-4 py-2">오전 9-11시</td>
                                <td class="px-4 py-2 text-xs">네트워크 최적화</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-2">
                                    <div class="flex items-center">
                                        <div class="w-3 h-3 bg-green-500 rounded-full mr-2"></div>
                                        클러스터 C
                                    </div>
                                </td>
                                <td class="px-4 py-2 font-medium">1,324 (16%)</td>
                                <td class="px-4 py-2">디스크 I/O 병목</td>
                                <td class="px-4 py-2 text-red-600">High</td>
                                <td class="px-4 py-2">밤 10시-새벽 2시</td>
                                <td class="px-4 py-2 text-xs">스토리지 확장</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex gap-4">
                <button onclick="deployModel()" class="px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors">
                    🚀 모델 배포
                </button>
                <button onclick="exportClusters()" class="px-6 py-2 bg-secondary text-secondary-foreground rounded-md hover:bg-secondary/90 transition-colors">
                    📊 클러스터 내보내기
                </button>
                <button onclick="generateInsights()" class="px-6 py-2 bg-secondary text-secondary-foreground rounded-md hover:bg-secondary/90 transition-colors">
                    💡 인사이트 생성
                </button>
                <button onclick="viewDetailedReport()" class="px-6 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors">
                    📊 상세 보고서
                </button>
            </div>
        </div>
    </main>

    <script>
        let convergenceChart, clusterVisualizationChart, clusterDistributionChart;
        let isTraining = false;
        let trainingInterval;

        function initCharts() {
            // Cluster Distribution Chart
            const distCtx = document.getElementById('clusterDistributionChart')?.getContext('2d');
            if (distCtx) {
                clusterDistributionChart = new Chart(distCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['클러스터 A', '클러스터 B', '클러스터 C', '클러스터 D', '클러스터 E', '클러스터 F', '클러스터 G', '클러스터 H'],
                        datasets: [{
                            data: [2143, 1867, 1324, 956, 789, 645, 566, 0],
                            backgroundColor: [
                                'rgba(239, 68, 68, 0.8)',
                                'rgba(59, 130, 246, 0.8)',
                                'rgba(34, 197, 94, 0.8)',
                                'rgba(147, 51, 234, 0.8)',
                                'rgba(249, 115, 22, 0.8)',
                                'rgba(6, 182, 212, 0.8)',
                                'rgba(156, 163, 175, 0.8)',
                                'rgba(245, 101, 101, 0.8)'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        animation: { duration: 0 },
                        animation: { duration: 0 }, // 크기 변경 시 애니메이션 제거
                        plugins: { legend: { display: false } }
                    }
                });
            }

            // Convergence Chart
            const convCtx = document.getElementById('convergenceChart')?.getContext('2d');
            if (convCtx) {
                convergenceChart = new Chart(convCtx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: '관성 (Inertia)',
                            data: [],
                            borderColor: 'rgb(239, 68, 68)',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            tension: 0.4
                        }, {
                            label: '실루엣 점수',
                            data: [],
                            borderColor: 'rgb(34, 197, 94)',
                            backgroundColor: 'rgba(34, 197, 94, 0.1)',
                            tension: 0.4,
                            yAxisID: 'y1'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        animation: { duration: 0 },
                        plugins: { legend: { display: true } },
                        scales: {
                            x: { title: { display: true, text: 'Iteration' } },
                            y: { type: 'linear', display: true, position: 'left', title: { display: true, text: 'Inertia' } },
                            y1: { type: 'linear', display: true, position: 'right', title: { display: true, text: 'Silhouette Score' }, grid: { drawOnChartArea: false } }
                        }
                    }
                });
            }

            // Cluster Visualization (2D PCA)
            const clusterCtx = document.getElementById('clusterVisualizationChart')?.getContext('2d');
            if (clusterCtx) {
                clusterVisualizationChart = new Chart(clusterCtx, {
                    type: 'scatter',
                    data: {
                        datasets: []
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        animation: { duration: 0 },
                        plugins: { legend: { display: true } },
                        scales: {
                            x: { title: { display: true, text: 'PCA Component 1' } },
                            y: { title: { display: true, text: 'PCA Component 2' } }
                        }
                    }
                });
            }
        }

        async function startTraining() {
            const clusterCount = parseInt(document.getElementById('clusterCount').value);
            const dataRange = document.getElementById('dataRange').value;
            const learningRate = parseFloat(document.getElementById('learningRate').value);
            const batchSize = parseInt(document.getElementById('batchSize').value);
            const epochs = parseInt(document.getElementById('epochs').value);

            // Show training progress
            document.getElementById('trainingProgress').style.display = 'block';
            document.getElementById('clusteringResults').style.display = 'none';
            
            document.getElementById('startTrainingBtn').disabled = true;
            document.getElementById('stopTrainingBtn').disabled = false;
            
            isTraining = true;


            // Generate sophisticated mock pattern data
            const trainingData = generateMockPatternData(dataRange);
            console.log(`📊 클러스터링 학습 데이터 준비 완료: ${trainingData.length}개 패턴`);

            try {
                const response = await fetch('http://localhost:3004/api/models/clustering/train', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        datasetId: `clustering_${dataRange}_${clusterCount}`,
                        hyperparameters: {
                            learningRate,
                            epochs,
                            batchSize,
                            clusterCount
                        },
                        trainingData: trainingData
                    })
                });

                if (!response.ok) {
                    throw new Error('Clustering training failed');
                }

                // Simulate training progress
                simulateTrainingProgress(epochs);

            } catch (error) {
                console.log('⚠️ AIOps API 서버 연결 실패, 모의 클러스터링 학습으로 전환:', error.message);
                console.log('🔄 클라이언트 기반 클러스터링 모델 학습 시뮬레이션을 시작합니다...');
                // Continue with enhanced mock training simulation
                simulateTrainingProgress(epochs);
            }
        }

        // Enhanced clustering training simulation with realistic convergence
        function simulateTrainingProgress(totalEpochs) {
            let currentEpoch = 0;
            const learningRate = parseFloat(document.getElementById('learningRate').value);
            const batchSize = parseInt(document.getElementById('batchSize').value);
            const clusterCount = parseInt(document.getElementById('clusterCount').value);
            
            const clusterColors = [
                'rgba(239, 68, 68, 0.6)', 'rgba(59, 130, 246, 0.6)', 'rgba(34, 197, 94, 0.6)',
                'rgba(147, 51, 234, 0.6)', 'rgba(249, 115, 22, 0.6)', 'rgba(6, 182, 212, 0.6)',
                'rgba(156, 163, 175, 0.6)', 'rgba(245, 101, 101, 0.6)'
            ];
            
            console.log(`🚀 클러스터링 모델 학습 시작: ${totalEpochs} epochs, LR=${learningRate}, Batch=${batchSize}, Clusters=${clusterCount}`);
            
            trainingInterval = setInterval(() => {
                if (!isTraining || currentEpoch >= totalEpochs) {
                    clearInterval(trainingInterval);
                    if (currentEpoch >= totalEpochs) {
                        console.log('✅ 클러스터링 모델 학습 완료!');
                        showClusteringResults();
                    }
                    return;
                }

                currentEpoch++;
                const progress = (currentEpoch / totalEpochs) * 100;
                const normalizedProgress = currentEpoch / totalEpochs;
                
                // Update progress
                document.getElementById('progressBar').style.width = progress + '%';
                document.getElementById('progressText').textContent = `${currentEpoch} / ${totalEpochs} epochs`;
                
                // Enhanced clustering metrics with realistic convergence patterns
                const initialInertia = 45.0;
                const inertia = initialInertia * Math.exp(-normalizedProgress * 2.2) + Math.random() * 2 + 3;
                
                const silhouetteBase = 0.25 + 0.55 * (1 - Math.exp(-normalizedProgress * 2.8)) + 0.03 * Math.random();
                const silhouette = Math.min(0.85, silhouetteBase);
                
                const cohesionBase = 55 + 35 * (1 - Math.exp(-normalizedProgress * 2.5)) + Math.random() * 3;
                const cohesion = Math.min(92, cohesionBase);
                
                const separationBase = 45 + 45 * (1 - Math.exp(-normalizedProgress * 2.0)) + Math.random() * 4;
                const separation = Math.min(90, separationBase);
                
                // Update metrics display
                document.getElementById('silhouetteScore').textContent = silhouette.toFixed(3);
                document.getElementById('cohesionScore').textContent = `${cohesion.toFixed(1)}%`;
                document.getElementById('separationScore').textContent = `${separation.toFixed(1)}%`;
                document.getElementById('inertiaScore').textContent = inertia.toFixed(3);
                
                // Log progress periodically
                if (currentEpoch % 10 === 0 || currentEpoch === 1) {
                    console.log(`📊 Epoch ${currentEpoch}/${totalEpochs}: Silhouette=${silhouette.toFixed(3)}, Inertia=${inertia.toFixed(2)}, Cohesion=${cohesion.toFixed(1)}%`);
                }
                
                // Update convergence chart with realistic curves
                if (convergenceChart) {
                    convergenceChart.data.labels.push(currentEpoch);
                    convergenceChart.data.datasets[0].data.push(Math.max(3, inertia)); // Inertia
                    convergenceChart.data.datasets[1].data.push(silhouette); // Silhouette
                    convergenceChart.update('none');
                }
                
                // Update cluster visualization every 5 epochs with improved clustering
                if (clusterVisualizationChart && currentEpoch % 5 === 0) {
                    const datasets = [];
                    const clusterNames = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H'];
                    
                    for (let i = 0; i < clusterCount; i++) {
                        // Generate increasingly tight clusters as training progresses
                        const clusterTightness = Math.max(0.3, 3.0 - (normalizedProgress * 2.5)); // Tighter clusters over time
                        const clusterSize = Math.floor(30 + Math.random() * 80);
                        
                        // Cluster centers positioned in a more organized pattern
                        const centerX = (i % 3) * 4 - 4 + Math.sin(i) * 2;
                        const centerY = Math.floor(i / 3) * 3 - 3 + Math.cos(i) * 1.5;
                        
                        const points = Array.from({length: clusterSize}, () => ({
                            x: centerX + (Math.random() - 0.5) * clusterTightness * 2,
                            y: centerY + (Math.random() - 0.5) * clusterTightness * 2
                        }));
                        
                        datasets.push({
                            label: `클러스터 ${clusterNames[i]}`,
                            data: points,
                            backgroundColor: clusterColors[i],
                            borderColor: clusterColors[i].replace('0.6', '1'),
                            pointRadius: Math.max(2, 4 - normalizedProgress), // Smaller points as clusters tighten
                            pointHoverRadius: 6
                        });
                    }
                    
                    clusterVisualizationChart.data.datasets = datasets;
                    clusterVisualizationChart.update('none');
                }
                
                // Variable delay for realistic training simulation
                const delay = Math.max(100, 250 - (normalizedProgress * 150));
                
            }, 250); // Slightly faster for better UX
        }

        function stopTraining() {
            isTraining = false;
            if (trainingInterval) {
                clearInterval(trainingInterval);
            }
            
            document.getElementById('startTrainingBtn').disabled = false;
            document.getElementById('stopTrainingBtn').disabled = true;
        }

        function showClusteringResults() {
            stopTraining();
            document.getElementById('clusteringResults').style.display = 'block';
        }

        // Generate sophisticated mock pattern data for clustering
        function generateMockPatternData(range) {
            const count = range === 'week' ? 800 : range === 'month' ? 2500 : range === 'quarter' ? 6000 : 10000;
            const data = [];
            
            const services = ['user-service', 'payment-service', 'order-service', 'inventory-service', 'notification-service', 'auth-service', 'analytics-service', 'gateway-service'];
            const patternTypes = {
                'high_cpu_memory': { cpu_usage: [80, 95], memory_usage: [85, 98], network_latency: [50, 200], disk_io: [30, 60] },
                'network_latency': { cpu_usage: [20, 40], memory_usage: [40, 70], network_latency: [500, 2000], disk_io: [10, 30] },
                'disk_io_bottleneck': { cpu_usage: [30, 60], memory_usage: [50, 80], network_latency: [100, 400], disk_io: [80, 100] },
                'intermittent_errors': { cpu_usage: [15, 35], memory_usage: [25, 50], network_latency: [80, 300], disk_io: [20, 40] },
                'memory_pressure': { cpu_usage: [40, 70], memory_usage: [90, 100], network_latency: [100, 500], disk_io: [40, 70] },
                'balanced_load': { cpu_usage: [30, 50], memory_usage: [40, 60], network_latency: [50, 150], disk_io: [20, 40] },
                'burst_traffic': { cpu_usage: [70, 100], memory_usage: [70, 90], network_latency: [200, 800], disk_io: [30, 60] },
                'background_processing': { cpu_usage: [20, 45], memory_usage: [30, 55], network_latency: [30, 100], disk_io: [60, 95] }
            };
            
            const timePatterns = {
                'morning_peak': { hour: [8, 11], weight: 1.3 },
                'afternoon_peak': { hour: [14, 17], weight: 1.5 },
                'evening_moderate': { hour: [18, 22], weight: 1.1 },
                'night_batch': { hour: [22, 6], weight: 0.8 },
                'weekend_low': { hour: [0, 24], weight: 0.6 }
            };
            
            for (let i = 0; i < count; i++) {
                const patternType = Object.keys(patternTypes)[Math.floor(Math.random() * Object.keys(patternTypes).length)];
                const pattern = patternTypes[patternType];
                const timePattern = Object.keys(timePatterns)[Math.floor(Math.random() * Object.keys(timePatterns).length)];
                const timeWeight = timePatterns[timePattern].weight;
                
                const timestamp = new Date(Date.now() - Math.random() * 90 * 24 * 60 * 60 * 1000);
                const hour = timestamp.getHours();
                
                // Generate correlated metrics based on pattern type
                const cpuUsage = Math.min(100, (pattern.cpu_usage[0] + Math.random() * (pattern.cpu_usage[1] - pattern.cpu_usage[0])) * timeWeight);
                const memoryUsage = Math.min(100, (pattern.memory_usage[0] + Math.random() * (pattern.memory_usage[1] - pattern.memory_usage[0])) * timeWeight);
                const networkLatency = (pattern.network_latency[0] + Math.random() * (pattern.network_latency[1] - pattern.network_latency[0])) * timeWeight;
                const diskIO = Math.min(100, (pattern.disk_io[0] + Math.random() * (pattern.disk_io[1] - pattern.disk_io[0])) * timeWeight);
                
                // Calculate derived metrics
                const responseTime = networkLatency + (cpuUsage * 10) + (memoryUsage * 5) + Math.random() * 500;
                const errorRate = Math.max(0, (cpuUsage + memoryUsage - 100) * 0.1 + Math.random() * 2);
                const throughput = Math.max(1, 1000 - (responseTime * 0.5) + Math.random() * 200);
                
                // Pre-assign to realistic clusters based on pattern characteristics
                let clusterId;
                if (patternType === 'high_cpu_memory') clusterId = 0; // Red cluster A
                else if (patternType === 'network_latency') clusterId = 1; // Blue cluster B  
                else if (patternType === 'disk_io_bottleneck') clusterId = 2; // Green cluster C
                else if (patternType === 'intermittent_errors') clusterId = 3; // Purple cluster D
                else if (patternType === 'memory_pressure') clusterId = 4; // Orange cluster E
                else if (patternType === 'balanced_load') clusterId = 5; // Teal cluster F
                else if (patternType === 'burst_traffic') clusterId = 6; // Gray cluster G
                else clusterId = 7; // Pink cluster H
                
                data.push({
                    id: `pattern_${String(i + 1).padStart(5, '0')}`,
                    timestamp: timestamp.toISOString(),
                    service: services[Math.floor(Math.random() * services.length)],
                    pattern_type: patternType,
                    time_pattern: timePattern,
                    cpu_usage: cpuUsage,
                    memory_usage: memoryUsage,
                    disk_io: diskIO,
                    network_latency: networkLatency,
                    response_time: responseTime,
                    error_rate: errorRate,
                    throughput: throughput,
                    request_count: Math.floor(throughput * (0.5 + Math.random() * 0.5)),
                    session_count: Math.floor(Math.random() * 100 * timeWeight),
                    cluster_id: clusterId,
                    hour: hour,
                    day_of_week: timestamp.getDay(),
                    // Clustering features for ML algorithms
                    feature_vector: [
                        cpuUsage / 100, memoryUsage / 100, diskIO / 100, networkLatency / 2000,
                        responseTime / 10000, errorRate / 10, throughput / 1000, hour / 24
                    ]
                });
            }
            
            console.log(`✅ 클러스터링 패턴 데이터 생성 완료: ${count}개 패턴, ${Object.keys(patternTypes).length}개 패턴 타입`);
            return data;
        }

        function optimizeClusterCount() {
            console.log('🔍 최적 클러스터 수 분석 시작...');
            
            // Simulate elbow method and silhouette analysis
            const analysisResults = [];
            for (let k = 2; k <= 12; k++) {
                const inertia = 50 - (k * 3) + Math.random() * 5;
                const silhouette = 0.3 + (k <= 8 ? k * 0.05 : (12 - k) * 0.03) + Math.random() * 0.1;
                analysisResults.push({ k, inertia, silhouette });
            }
            
            const optimal = analysisResults.reduce((best, curr) => 
                curr.silhouette > best.silhouette ? curr : best
            );
            
            console.log('📈 최적 클러스터 분석 결과:', analysisResults);
            alert(`최적 클러스터 수 분석 완료!\n\n추천 클러스터 수: ${optimal.k}개\n실루엣 점수: ${optimal.silhouette.toFixed(3)}\n\n클러스터 수를 ${optimal.k}로 설정하시겠습니까?`);
            
            if (confirm(`클러스터 수를 ${optimal.k}개로 변경하시겠습니까?`)) {
                document.getElementById('clusterCount').value = optimal.k;
                console.log(`✅ 클러스터 수가 ${optimal.k}개로 설정되었습니다.`);
            }
        }

        function deployModel() {
            if (confirm('클러스터링 모델을 프로덕션에 배포하시겠습니까?')) {
                alert('클러스터링 모델이 성공적으로 배포되었습니다.');
            }
        }

        function exportClusters() {
            alert('클러스터 결과를 CSV 파일로 내보냅니다.');
        }

        function generateInsights() {
            window.open('/clustering-insights.html', '_blank');
        }

        function viewDetailedReport() {
            window.open('/ml-training-report.html?model=clustering', '_blank');
        }

        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleString('ko-KR', {
                year: 'numeric', month: '2-digit', day: '2-digit',
                hour: '2-digit', minute: '2-digit', second: '2-digit',
                hour12: false
            });
            document.getElementById('currentTime').textContent = timeString;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initCharts();
            updateTime();
            setInterval(updateTime, 1000);
        });
    </script>
</body>
</html>